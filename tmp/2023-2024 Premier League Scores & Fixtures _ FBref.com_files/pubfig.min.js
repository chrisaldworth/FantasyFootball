(()=>{var vu=Object.create;var eo=Object.defineProperty,Ou=Object.defineProperties,Cu=Object.getOwnPropertyDescriptor,Du=Object.getOwnPropertyDescriptors,Pu=Object.getOwnPropertyNames,vd=Object.getOwnPropertySymbols,Od=Object.getPrototypeOf,Cd=Object.prototype.hasOwnProperty,Nu=Object.prototype.propertyIsEnumerable,Mu=Reflect.get;var Xn=(r,e,t)=>e in r?eo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,A=(r,e)=>{for(var t in e||(e={}))Cd.call(e,t)&&Xn(r,t,e[t]);if(vd)for(var t of vd(e))Nu.call(e,t)&&Xn(r,t,e[t]);return r},L=(r,e)=>Ou(r,Du(e));var Dd=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var qt=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var xu=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Pu(e))!Cd.call(r,s)&&s!==t&&eo(r,s,{get:()=>e[s],enumerable:!(i=Cu(e,s))||i.enumerable});return r};var Rt=(r,e,t)=>(t=r!=null?vu(Od(r)):{},xu(e||!r||!r.__esModule?eo(t,"default",{value:r,enumerable:!0}):t,r));var E=(r,e,t)=>(Xn(r,typeof e!="symbol"?e+"":e,t),t);var Ii=(r,e,t)=>Mu(Od(r),t,e);var y=(r,e,t)=>new Promise((i,s)=>{var n=d=>{try{a(t.next(d))}catch(c){s(c)}},o=d=>{try{a(t.throw(d))}catch(c){s(c)}},a=d=>d.done?i(d.value):Promise.resolve(d.value).then(n,o);a((t=t.apply(r,e)).next())});var br=qt((Jg,Kd)=>{"use strict";var Uu=function(e){return Gu(e)&&!Fu(e)};function Gu(r){return!!r&&typeof r=="object"}function Fu(r){var e=Object.prototype.toString.call(r);return e==="[object RegExp]"||e==="[object Date]"||qu(r)}var Vu=typeof Symbol=="function"&&Symbol.for,Hu=Vu?Symbol.for("react.element"):60103;function qu(r){return r.$$typeof===Hu}function zu(r){return Array.isArray(r)?[]:{}}function Oi(r,e){return e.clone!==!1&&e.isMergeableObject(r)?$t(zu(r),r,e):r}function Yu(r,e,t){return r.concat(e).map(function(i){return Oi(i,t)})}function $u(r,e){if(!e.customMerge)return $t;var t=e.customMerge(r);return typeof t=="function"?t:$t}function ju(r){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r).filter(function(e){return Object.propertyIsEnumerable.call(r,e)}):[]}function $d(r){return Object.keys(r).concat(ju(r))}function jd(r,e){try{return e in r}catch(t){return!1}}function Ku(r,e){return jd(r,e)&&!(Object.hasOwnProperty.call(r,e)&&Object.propertyIsEnumerable.call(r,e))}function Wu(r,e,t){var i={};return t.isMergeableObject(r)&&$d(r).forEach(function(s){i[s]=Oi(r[s],t)}),$d(e).forEach(function(s){Ku(r,s)||(jd(r,s)&&t.isMergeableObject(e[s])?i[s]=$u(s,t)(r[s],e[s],t):i[s]=Oi(e[s],t))}),i}function $t(r,e,t){t=t||{},t.arrayMerge=t.arrayMerge||Yu,t.isMergeableObject=t.isMergeableObject||Uu,t.cloneUnlessOtherwiseSpecified=Oi;var i=Array.isArray(e),s=Array.isArray(r),n=i===s;return n?i?t.arrayMerge(r,e,t):Wu(r,e,t):Oi(e,t)}$t.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(i,s){return $t(i,s,t)},{})};var Qu=$t;Kd.exports=Qu});var ql=qt(()=>{});var cs=qt((ls,zl)=>{(function(r,e){typeof ls=="object"?zl.exports=ls=e():typeof define=="function"&&define.amd?define([],e):r.CryptoJS=e()})(ls,function(){var r=r||function(e,t){var i;if(typeof window!="undefined"&&window.crypto&&(i=window.crypto),typeof self!="undefined"&&self.crypto&&(i=self.crypto),typeof globalThis!="undefined"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window!="undefined"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global!="undefined"&&global.crypto&&(i=global.crypto),!i&&typeof Dd=="function")try{i=ql()}catch(g){}var s=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch(g){}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function g(){}return function(_){var M;return g.prototype=_,M=new g,g.prototype=null,M}}(),o={},a=o.lib={},d=a.Base=function(){return{extend:function(g){var _=n(this);return g&&_.mixIn(g),(!_.hasOwnProperty("init")||this.init===_.init)&&(_.init=function(){_.$super.init.apply(this,arguments)}),_.init.prototype=_,_.$super=this,_},create:function(){var g=this.extend();return g.init.apply(g,arguments),g},init:function(){},mixIn:function(g){for(var _ in g)g.hasOwnProperty(_)&&(this[_]=g[_]);g.hasOwnProperty("toString")&&(this.toString=g.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),c=a.WordArray=d.extend({init:function(g,_){g=this.words=g||[],_!=t?this.sigBytes=_:this.sigBytes=g.length*4},toString:function(g){return(g||f).stringify(this)},concat:function(g){var _=this.words,M=g.words,x=this.sigBytes,q=g.sigBytes;if(this.clamp(),x%4)for(var V=0;V<q;V++){var pe=M[V>>>2]>>>24-V%4*8&255;_[x+V>>>2]|=pe<<24-(x+V)%4*8}else for(var ae=0;ae<q;ae+=4)_[x+ae>>>2]=M[ae>>>2];return this.sigBytes+=q,this},clamp:function(){var g=this.words,_=this.sigBytes;g[_>>>2]&=4294967295<<32-_%4*8,g.length=e.ceil(_/4)},clone:function(){var g=d.clone.call(this);return g.words=this.words.slice(0),g},random:function(g){for(var _=[],M=0;M<g;M+=4)_.push(s());return new c.init(_,g)}}),u=o.enc={},f=u.Hex={stringify:function(g){for(var _=g.words,M=g.sigBytes,x=[],q=0;q<M;q++){var V=_[q>>>2]>>>24-q%4*8&255;x.push((V>>>4).toString(16)),x.push((V&15).toString(16))}return x.join("")},parse:function(g){for(var _=g.length,M=[],x=0;x<_;x+=2)M[x>>>3]|=parseInt(g.substr(x,2),16)<<24-x%8*4;return new c.init(M,_/2)}},p=u.Latin1={stringify:function(g){for(var _=g.words,M=g.sigBytes,x=[],q=0;q<M;q++){var V=_[q>>>2]>>>24-q%4*8&255;x.push(String.fromCharCode(V))}return x.join("")},parse:function(g){for(var _=g.length,M=[],x=0;x<_;x++)M[x>>>2]|=(g.charCodeAt(x)&255)<<24-x%4*8;return new c.init(M,_)}},h=u.Utf8={stringify:function(g){try{return decodeURIComponent(escape(p.stringify(g)))}catch(_){throw new Error("Malformed UTF-8 data")}},parse:function(g){return p.parse(unescape(encodeURIComponent(g)))}},m=a.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(g){typeof g=="string"&&(g=h.parse(g)),this._data.concat(g),this._nDataBytes+=g.sigBytes},_process:function(g){var _,M=this._data,x=M.words,q=M.sigBytes,V=this.blockSize,pe=V*4,ae=q/pe;g?ae=e.ceil(ae):ae=e.max((ae|0)-this._minBufferSize,0);var ce=ae*V,ze=e.min(ce*4,q);if(ce){for(var ke=0;ke<ce;ke+=V)this._doProcessBlock(x,ke);_=x.splice(0,ce),M.sigBytes-=ze}return new c.init(_,ze)},clone:function(){var g=d.clone.call(this);return g._data=this._data.clone(),g},_minBufferSize:0}),S=a.Hasher=m.extend({cfg:d.extend(),init:function(g){this.cfg=this.cfg.extend(g),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(g){return this._append(g),this._process(),this},finalize:function(g){g&&this._append(g);var _=this._doFinalize();return _},blockSize:512/32,_createHelper:function(g){return function(_,M){return new g.init(M).finalize(_)}},_createHmacHelper:function(g){return function(_,M){return new b.HMAC.init(g,M).finalize(_)}}}),b=o.algo={};return o}(Math);return r})});var Uo=qt((fs,Yl)=>{(function(r,e){typeof fs=="object"?Yl.exports=fs=e(cs()):typeof define=="function"&&define.amd?define(["./core"],e):e(r.CryptoJS)})(fs,function(r){return function(e){var t=r,i=t.lib,s=i.WordArray,n=i.Hasher,o=t.algo,a=[];(function(){for(var h=0;h<64;h++)a[h]=e.abs(e.sin(h+1))*4294967296|0})();var d=o.MD5=n.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(h,m){for(var S=0;S<16;S++){var b=m+S,g=h[b];h[b]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}var _=this._hash.words,M=h[m+0],x=h[m+1],q=h[m+2],V=h[m+3],pe=h[m+4],ae=h[m+5],ce=h[m+6],ze=h[m+7],ke=h[m+8],Gt=h[m+9],Ft=h[m+10],Vt=h[m+11],wt=h[m+12],Ht=h[m+13],lr=h[m+14],cr=h[m+15],C=_[0],D=_[1],P=_[2],N=_[3];C=c(C,D,P,N,M,7,a[0]),N=c(N,C,D,P,x,12,a[1]),P=c(P,N,C,D,q,17,a[2]),D=c(D,P,N,C,V,22,a[3]),C=c(C,D,P,N,pe,7,a[4]),N=c(N,C,D,P,ae,12,a[5]),P=c(P,N,C,D,ce,17,a[6]),D=c(D,P,N,C,ze,22,a[7]),C=c(C,D,P,N,ke,7,a[8]),N=c(N,C,D,P,Gt,12,a[9]),P=c(P,N,C,D,Ft,17,a[10]),D=c(D,P,N,C,Vt,22,a[11]),C=c(C,D,P,N,wt,7,a[12]),N=c(N,C,D,P,Ht,12,a[13]),P=c(P,N,C,D,lr,17,a[14]),D=c(D,P,N,C,cr,22,a[15]),C=u(C,D,P,N,x,5,a[16]),N=u(N,C,D,P,ce,9,a[17]),P=u(P,N,C,D,Vt,14,a[18]),D=u(D,P,N,C,M,20,a[19]),C=u(C,D,P,N,ae,5,a[20]),N=u(N,C,D,P,Ft,9,a[21]),P=u(P,N,C,D,cr,14,a[22]),D=u(D,P,N,C,pe,20,a[23]),C=u(C,D,P,N,Gt,5,a[24]),N=u(N,C,D,P,lr,9,a[25]),P=u(P,N,C,D,V,14,a[26]),D=u(D,P,N,C,ke,20,a[27]),C=u(C,D,P,N,Ht,5,a[28]),N=u(N,C,D,P,q,9,a[29]),P=u(P,N,C,D,ze,14,a[30]),D=u(D,P,N,C,wt,20,a[31]),C=f(C,D,P,N,ae,4,a[32]),N=f(N,C,D,P,ke,11,a[33]),P=f(P,N,C,D,Vt,16,a[34]),D=f(D,P,N,C,lr,23,a[35]),C=f(C,D,P,N,x,4,a[36]),N=f(N,C,D,P,pe,11,a[37]),P=f(P,N,C,D,ze,16,a[38]),D=f(D,P,N,C,Ft,23,a[39]),C=f(C,D,P,N,Ht,4,a[40]),N=f(N,C,D,P,M,11,a[41]),P=f(P,N,C,D,V,16,a[42]),D=f(D,P,N,C,ce,23,a[43]),C=f(C,D,P,N,Gt,4,a[44]),N=f(N,C,D,P,wt,11,a[45]),P=f(P,N,C,D,cr,16,a[46]),D=f(D,P,N,C,q,23,a[47]),C=p(C,D,P,N,M,6,a[48]),N=p(N,C,D,P,ze,10,a[49]),P=p(P,N,C,D,lr,15,a[50]),D=p(D,P,N,C,ae,21,a[51]),C=p(C,D,P,N,wt,6,a[52]),N=p(N,C,D,P,V,10,a[53]),P=p(P,N,C,D,Ft,15,a[54]),D=p(D,P,N,C,x,21,a[55]),C=p(C,D,P,N,ke,6,a[56]),N=p(N,C,D,P,cr,10,a[57]),P=p(P,N,C,D,ce,15,a[58]),D=p(D,P,N,C,Ht,21,a[59]),C=p(C,D,P,N,pe,6,a[60]),N=p(N,C,D,P,Vt,10,a[61]),P=p(P,N,C,D,q,15,a[62]),D=p(D,P,N,C,Gt,21,a[63]),_[0]=_[0]+C|0,_[1]=_[1]+D|0,_[2]=_[2]+P|0,_[3]=_[3]+N|0},_doFinalize:function(){var h=this._data,m=h.words,S=this._nDataBytes*8,b=h.sigBytes*8;m[b>>>5]|=128<<24-b%32;var g=e.floor(S/4294967296),_=S;m[(b+64>>>9<<4)+15]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,m[(b+64>>>9<<4)+14]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,h.sigBytes=(m.length+1)*4,this._process();for(var M=this._hash,x=M.words,q=0;q<4;q++){var V=x[q];x[q]=(V<<8|V>>>24)&16711935|(V<<24|V>>>8)&4278255360}return M},clone:function(){var h=n.clone.call(this);return h._hash=this._hash.clone(),h}});function c(h,m,S,b,g,_,M){var x=h+(m&S|~m&b)+g+M;return(x<<_|x>>>32-_)+m}function u(h,m,S,b,g,_,M){var x=h+(m&b|S&~b)+g+M;return(x<<_|x>>>32-_)+m}function f(h,m,S,b,g,_,M){var x=h+(m^S^b)+g+M;return(x<<_|x>>>32-_)+m}function p(h,m,S,b,g,_,M){var x=h+(S^(m|~b))+g+M;return(x<<_|x>>>32-_)+m}t.MD5=n._createHelper(d),t.HmacMD5=n._createHmacHelper(d)}(Math),r.MD5})});var uf=qt((_n,ff)=>{(function(r,e){typeof _n=="object"?ff.exports=_n=e(cs()):typeof define=="function"&&define.amd?define(["./core"],e):e(r.CryptoJS)})(_n,function(r){return function(e){var t=r,i=t.lib,s=i.WordArray,n=i.Hasher,o=t.algo,a=[],d=[];(function(){function f(S){for(var b=e.sqrt(S),g=2;g<=b;g++)if(!(S%g))return!1;return!0}function p(S){return(S-(S|0))*4294967296|0}for(var h=2,m=0;m<64;)f(h)&&(m<8&&(a[m]=p(e.pow(h,1/2))),d[m]=p(e.pow(h,1/3)),m++),h++})();var c=[],u=o.SHA256=n.extend({_doReset:function(){this._hash=new s.init(a.slice(0))},_doProcessBlock:function(f,p){for(var h=this._hash.words,m=h[0],S=h[1],b=h[2],g=h[3],_=h[4],M=h[5],x=h[6],q=h[7],V=0;V<64;V++){if(V<16)c[V]=f[p+V]|0;else{var pe=c[V-15],ae=(pe<<25|pe>>>7)^(pe<<14|pe>>>18)^pe>>>3,ce=c[V-2],ze=(ce<<15|ce>>>17)^(ce<<13|ce>>>19)^ce>>>10;c[V]=ae+c[V-7]+ze+c[V-16]}var ke=_&M^~_&x,Gt=m&S^m&b^S&b,Ft=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),Vt=(_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25),wt=q+Vt+ke+d[V]+c[V],Ht=Ft+Gt;q=x,x=M,M=_,_=g+wt|0,g=b,b=S,S=m,m=wt+Ht|0}h[0]=h[0]+m|0,h[1]=h[1]+S|0,h[2]=h[2]+b|0,h[3]=h[3]+g|0,h[4]=h[4]+_|0,h[5]=h[5]+M|0,h[6]=h[6]+x|0,h[7]=h[7]+q|0},_doFinalize:function(){var f=this._data,p=f.words,h=this._nDataBytes*8,m=f.sigBytes*8;return p[m>>>5]|=128<<24-m%32,p[(m+64>>>9<<4)+14]=e.floor(h/4294967296),p[(m+64>>>9<<4)+15]=h,f.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var f=n.clone.call(this);return f._hash=this._hash.clone(),f}});t.SHA256=n._createHelper(u),t.HmacSHA256=n._createHmacHelper(u)}(Math),r.SHA256})});var pf=qt((En,hf)=>{(function(r,e){typeof En=="object"?hf.exports=En=e(cs()):typeof define=="function"&&define.amd?define(["./core"],e):e(r.CryptoJS)})(En,function(r){return function(){var e=r,t=e.lib,i=t.WordArray,s=t.Hasher,n=e.algo,o=[],a=n.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,c){for(var u=this._hash.words,f=u[0],p=u[1],h=u[2],m=u[3],S=u[4],b=0;b<80;b++){if(b<16)o[b]=d[c+b]|0;else{var g=o[b-3]^o[b-8]^o[b-14]^o[b-16];o[b]=g<<1|g>>>31}var _=(f<<5|f>>>27)+S+o[b];b<20?_+=(p&h|~p&m)+1518500249:b<40?_+=(p^h^m)+1859775393:b<60?_+=(p&h|p&m|h&m)-1894007588:_+=(p^h^m)-899497514,S=m,m=h,h=p<<30|p>>>2,p=f,f=_}u[0]=u[0]+f|0,u[1]=u[1]+p|0,u[2]=u[2]+h|0,u[3]=u[3]+m|0,u[4]=u[4]+S|0},_doFinalize:function(){var d=this._data,c=d.words,u=this._nDataBytes*8,f=d.sigBytes*8;return c[f>>>5]|=128<<24-f%32,c[(f+64>>>9<<4)+14]=Math.floor(u/4294967296),c[(f+64>>>9<<4)+15]=u,d.sigBytes=c.length*4,this._process(),this._hash},clone:function(){var d=s.clone.call(this);return d._hash=this._hash.clone(),d}});e.SHA1=s._createHelper(a),e.HmacSHA1=s._createHmacHelper(a)}(),r.SHA1})});var be={pubfigEngineLoadInit:"pubfig-engine-load-init",pubfigEngineSetupStart:"pubfig-engine-setup-start",pubfigEngineLoad:"pubfig-engine-load",pubfigSlotRequested:"pubfig-slotRequested",pubfigStickyFooterSlotRequested:"pubfig-sticky-footer-slotRequested",pubfigSlotRenderEnded:"pubfig-slotRenderEnded",pubfigEngineSetupEnd:"pubfig-engine-setup-end",pubfigStickyFooterSlotRenderEnded:"pubfig-sticky-footer-slotRenderEnded",pubfigPrebidFsRequestBids:"pubfig-prebid-fsRequestBids",pubfigPrebidAuctionInit:"pubfig-prebid-auctionInit",pubfigPrebidAuctionEnd:"pubfig-prebid-auctionEnd",pubfigLoaded:"pubfig-loaded",pubfigInitRequestStart:"pubfig-init-request-start",pubfigInitRequestEnd:"pubfig-init-request-end"};var B=(r,e=window)=>{var i,s;return(s=new URLSearchParams((i=e.location)==null?void 0:i.search).get(r))!=null?s:""},Pd=(r,e=window)=>new URLSearchParams(e.location.search).has(r);function Te(r){let{name:e,detail:t}=r,i=new CustomEvent(e,{detail:t});window.dispatchEvent(i)}var Nd="customEvent",fe={IMMEDIATE:"immediate",MAIN:"main",BEACON:"beacon",ERROR:"error"},Md=["fsrefresh","fsrebid","fs_uuid","floors_id","floors_hour","fs_placementName","fs_ad_product","fs_ad_optimization","fs_clientservermask","amznbid","amznp","fs-auuid","fsbid","fsitf","fs_session_id","fs_pageview_id","fs_version","user-agent","floors_user","floors_rtt","fs_testgroup","fs_carousel"],xd=["fsrefresh","fs_ad_product","fsitf","fs_ad_optimization"],Ld=["fs_clientservermask","fs_ad_product","fs_testgroup","floors_rtt","fsrefresh","floors_hour","floors_id","fsrebid","fs_ad_optimization"];var Y=class{constructor(e,t){E(this,"type","default");this._payload=this._buildPayload(e),this._topic=t}get payload(){return this._payload}get topic(){return this._topic||fe.MAIN}setTopic(e){this._topic=e}setType(e){this.type=e}_buildPayload(e){return e||{}}};var $=class extends Y{constructor(){super(...arguments);E(this,"type",Nd)}_buildPayload(t){let{eventType:i,data:s,eventName:n}=t;return{eventType:i,eventName:n,jsonValue:JSON.stringify(s)}}};var fr=r=>{let{dependencies:e,name:t}=r||{};if(e){if(!Array.isArray(e))throw new Error(`Module Definition Error: ${t}. Dependencies must be an array.`);e.forEach(i=>{let{token:s}=typeof i=="string"?{token:i}:i;if(!s)throw new Error(`Module Definition Error: ${t}. Dependency must contain a token.`);if(typeof s!="string")throw new Error(`Module Definition Error: ${t}. Token must be a string.`)})}},zt=r=>r.charAt(0).toLowerCase()+r.slice(1);var tt={SINGLETON:"singleton",FOR_FEATURE:"forFeature"};var T=class r{constructor(){this._modules=new Map}static get instance(){return this._instance||(this._instance=new r),this._instance}set(e,t){var i;if(!e)throw new Error("Token must be provided");if(this._modules.has(e))throw new Error(`Module with token ${e} already exists`);if((i=t.dependencies)!=null&&i.length&&new Set(t.dependencies).size!==t.dependencies.length)throw new Error(`Duplicated dependencies found in module ${e}.`);this._modules.set(e,t)}get(e){return this._modules.get(e)}has(e){return this._modules.has(e)}delete(e){this._modules.delete(e)}getAlias(e){let t=this.get(e);return t==null?void 0:t.defaultAlias}clear(){this._modules.clear()}static class(e,{token:t,factory:i,dependencies:s=[],injectionMode:n=tt.SINGLETON,defaultAlias:o}){if(!e)throw new Error("Class must be provided");if(!t)throw new Error("Token must be provided");fr({dependencies:s,name:e.name}),r.instance.set(t,{factory:i||(({dependencies:a})=>new e(a)),dependencies:s,injectionMode:n,defaultAlias:o||zt(t),type:"classModule"})}static object({token:e,value:t,factory:i,dependencies:s,injectionMode:n=tt.SINGLETON,defaultAlias:o}){if(!e)throw new Error("Token must be provided");if(!t&&!i)throw new Error("Value or factory must be provided");fr({dependencies:s,name:e}),r.instance.set(e,{value:t,factory:i,dependencies:s,injectionMode:n,defaultAlias:o||zt(e),type:"object"})}static function(e,{token:t,dependencies:i,defaultAlias:s}={}){if(!e)throw new Error("Function must be provided");if(!t)throw new Error("Token must be provided");fr({dependencies:i,name:t}),r.instance.set(t,{dependencies:i,defaultAlias:s||zt(t),func:e,type:"function"})}};var z=class r{constructor(e){this._moduleRegistry=e,this._moduleInstances=new Map}static get instance(){return this._instance||(this._instance=new r(T.instance)),this._instance}set(e,t){this._moduleInstances.set(e,t)}clear(){this._moduleInstances.clear()}get(e){return this._moduleInstances.get(e)}delete(e){this._moduleInstances.delete(e)}call(e,...t){return y(this,null,function*(){let i=this._moduleRegistry.get(e);if(!i)throw new Error(`Module with token "${e}" does not exist`);let{dependencies:s,type:n,func:o}=i;if(n!=="function")throw new Error(`Module with token "${e}" is not a function type`);let a=yield this._resolveDependencies({token:e,dependencies:s});return o(a,...t)})}create(i){return y(this,arguments,function*(e,{provide:t={}}={}){let s=this._moduleRegistry.get(e);if(!s)throw new Error(`Module with token "${e}" does not exist`);let{dependencies:n=[],factory:o,value:a,func:d}=s,c=n.filter(f=>{let p=this._getDependencyObject(f),m=p.alias||this._moduleRegistry.getAlias(p.token)||zt(p.token);return!t[m]});return this._resolveDependencies({token:e,dependencies:c}).then(f=>this._createInstance({token:e,dependencies:A(A({},f),t),container:this,factory:o,value:a,func:d}))})}resolve(e,t){return y(this,null,function*(){return this._resolve({token:e,optional:t})})}resolveAll(e){return y(this,null,function*(){if(!Array.isArray(e))throw new Error("Tokens must be an array");return this._resolveDependencies({dependencies:e})})}has(e){return this._moduleInstances.has(e)}_resolve(n){return y(this,arguments,function*({token:e,resolvedDeps:t=new Set,parentToken:i,optional:s}){if(!this._moduleRegistry.has(e)){if(s)return null;throw new Error(`${[...t,e].join(" -> ")}. Module with token "${e}" does not exist`)}let o=this._moduleRegistry.get(e),{dependencies:a=[],factory:d,value:c,func:u,injectionMode:f=tt.SINGLETON}=o;if(i&&f===tt.FOR_FEATURE&&(e=`${i}:${e}`),this.has(e))return this.get(e);if(t.has(e))throw new Error(`Circular dependency detected: ${Array.from(t).join(" -> ")} ->${e}`);t.add(e);let p=this._resolveDependencies({token:e,dependencies:a,resolvedDeps:t}).then(h=>this._createInstance({token:e,dependencies:h,container:this,factory:d,value:c,func:u}));return this.set(e,p),p.then&&p.then(h=>{this.set(e,h)}),p})}_resolveDependencies(s){return y(this,arguments,function*({token:e,dependencies:t,resolvedDeps:i}){let n=[];return t.length&&(n=yield Promise.all(t.map(o=>y(this,null,function*(){let{token:a,alias:d,optional:c}=this._getDependencyObject(o),u=yield this._resolve({token:a,resolvedDeps:new Set(i),parentToken:e,optional:c}),f=this._moduleRegistry.getAlias(a);return[d||f||a,u]})))),Object.fromEntries(n)})}_getDependencyObject(e){return typeof e=="string"?{token:e}:e}_createInstance({dependencies:e,container:t,factory:i,value:s,token:n,func:o}){if(s!==void 0)return s;if(o!==void 0)return o.bind(null,e);if(!(i instanceof Function))throw new Error(`Container Error: ${n}. Factory must be a function`);let a=i({dependencies:e,container:t});if(!(a instanceof Object))throw new Error(`Container Error: ${n}. Factory must return an object`);return a}};function ne(r,e){return e.reduce((t,i)=>(r[i]!==void 0&&(t[i]=r[i]),t),{})}var ur="_fs-ad-iframe-container",Bd="data-fs-ancillary";var hr=r=>{let e=document.getElementById(r);if(!e)return;let t=e.querySelector(`#${ur}`);t&&t.remove(),e.querySelectorAll('div[id*="google_ads_iframe"]').forEach(o=>o.remove());let s=['div[id="teads0"]','div[class="teads-resize'];e.querySelectorAll(s.join()).forEach(o=>o.remove())};var l={ANALYTICS:"Analytics",PERFORMANCE_LOGGER:"PerformanceLogger",DISPENSARY_DATA:"DispensaryData",AD_SLOT_SERVICE:"AdSlotService",AD_SLOTS_MANAGER:"AdSlotsManager",LOGGER:"Logger",EVENT_BUS:"EventBus",CONFIG_MANAGER:"ConfigManager",FREESTAR:"freestar",WINDOW:"window",PAGE:"Page",SESSION_STORAGE_MANAGER:"SessionStorageManager",PREBID_MANAGER:"PrebidManager",AMAZON_MANAGER:"AmazonManager",AD_QUALITY_MANAGER:"AdQualityManager",GAM_MANAGER:"GamManager",DEVICE_INFO:"deviceInfo",GEO_INFO:"geoInfo",FS_DATA:"fsdata",BID_RESPONSE_ANALYTICS_EVENT_FACTORY:"BidResponseAnalyticsEventFactory",BID_WON_ANALYTICS_EVENT_FACTORY:"BidWonAnalyticsEventFactory",BID_REQUESTED_ANALYTICS_EVENT_FACTORY:"BidRequestedAnalyticsEventFactory",DFP_RESPONSE_ANALYTICS_EVENT_FACTORY:"DfpResponseAnalyticsEventFactory",ANALYTICS_EVENT_FACTORY:"AnalyticsEventFactory",MAIN_QUEUE:"MainQueue",ERROR_QUEUE:"ErrorQueue",IMMEDIATE_QUEUE:"ImmediateQueue",BEACON_QUEUE:"BeaconQueue",ANALYTICS_MESSAGE_FACTORY:"AnalyticsMessageFactory",DATA_COLLECTOR_API:"DataCollectorAPI",IDENTITY_CONFIG:"IdentityConfig",HASHED_EMAIL_PROVIDERS:"HashedEmailProviderManager",REALTIME_PROVIDERS:"RealtimeProvidersManager",IDENTITY_MANAGER:"IdentityManager",ATS_MANAGER:"atsManager",VIDEO:"Video",STICKY_AD:"StickyAd",FOP_VIDEO_SCRIPTS:"FopVideoScripts",AUCTION_MANAGER:"AuctionManager",NATIVE_RENDER_MANAGER:"nativeRenderManager",CONFIANT:"Confiant",IN_BANNER_VIDEO_PLAYER:"InBannerVideoPlayer",OUTSTREAM_VIDEO_PLAYER:"OutstreamVideoPlayer",INCONTENT_VIDEO_AD:"InContentVideoAd",FLOATING_VIDEO_AD:"FloatingVideoAd",INCONTENT_TO_FLOATING_VIDEO_AD:"InContentToFloatingVideoAd",AD_REFRESHER:"AdRefresher",REFRESH_LIBRARY:"RefreshLibrary",STICKY_FOOTER_REFRESHER:"StickyFooterRefresher",DEFAULT_REFRESHER:"DefaultRefresher",SUPERFLEX_REFRESHER:"SuperflexRefresher",DEVICE_ORIENTATION_TRACKER:"DeviceOrientationTracker",VIRTUAL_KEYBOARD_REFRESH_CONTROL:"VirtualKeyboardRefreshControl",RENDER_BID_MIDWAY:"RenderBidMidwayManager",GLOBAL_REFRESH_USER_IDS_STATE:"GlobalRefreshUserIDsState",REBID_MANAGER:"RebidManager",MEMORY_MONITOR:"MemoryMonitor",BIDS_MANAGER:"BidsManager",OPTABLE_MANAGER:"OptableManager",ANCILLARY:"Ancillary",BRANDING:"Branding",REPORT_AD:"ReportAd",IDEAL_AD_STACK_MANAGER:"IdealAdStackManager",IIQ_MANAGER:"IntentIqManager",CONNECTID_MANAGER:"ConnectIdManager",USER_INFO_MANAGER:"UserInfoManager",AD_BLOCK:"AdBlock",URL_VALIDATOR:"UrlValidator"};function F({type:r="div",classList:e=[],id:t=!1,src:i=!1,name:s=!1,attributes:n=[],children:o=[],style:a={},innerHTML:d,textContent:c},u=document){let f=u.createElement(r);return e.length&&(f.className=e.join(" ")),i&&(f.src=i),t&&(f.id=t),s&&f.setAttribute("name",s),Array.isArray(n)?n.forEach(p=>{Object.entries(p).forEach(([h,m])=>{f.setAttribute(h,m)})}):Object.entries(n).forEach(([p,h])=>{f.setAttribute(p,h)}),Object.keys(a).length&&Lu(f,a),d&&(f.innerHTML=d),c&&(f.textContent=c),o.length&&o.forEach(p=>{p&&f.appendChild(p)}),f}var Lu=(r,e)=>(r&&Object.entries(e).forEach(([t,i])=>{r.style[t]=i}),r);function ge(r,e,t=null,i,s=!0,n=!1,o=!0,a){try{let d=F({type:"script"});r&&(d.src=r),o&&d.setAttribute("data-owner","freestar"),i&&(d.textContent=i),t&&(d.id=t),s&&(d.async=s),typeof n!="undefined"&&(d.defer=n),d.type="text/javascript";let c=null;e&&d.addEventListener("load",()=>{e(),c&&c.disconnect()},{once:!0}),a&&d.addEventListener("error",u=>{a(u),c&&c.disconnect()}),document.getElementsByTagName("head")[0].appendChild(d),"MutationObserver"in window&&(c=new MutationObserver(u=>{u.forEach(f=>{f.attributeName==="type"&&document.querySelectorAll('[type="osano/blocked"]').forEach(p=>{p===d&&(console.warn("Script was blocked by Osano:",r||t),a&&a(new Event("osano-blocked")),c.disconnect())})})}),c.observe(d,{attributes:!0,attributeFilter:["type"]}))}catch(d){z.instance.resolve(l.ANALYTICS).then(c=>{c.track(new $({eventName:"LOAD_SCRIPT_FAILED",data:{scriptSrc:r,id:t,error:d.message}}))})}}var pr=(r,e=null,t=null,i={})=>{let{defer:s=!1}=i;return new Promise((n,o)=>{ge(r,n,e,t,!0,s,!0,o)})};function Ye(r){Math.random()<.01&&freestar.analyticsQueue.push(new $({eventName:"PUBFIG_NOT_LOADED",eventType:r||"",data:{domain:window.location.hostname}}))}var Yt=(r,e)=>r[0]+r[1]<e[0]+e[1]?1:e[0]+e[1]<r[0]+r[1]?-1:0;function gr(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)r[i]=t[i]}return r}var Bu={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function to(r,e){function t(s,n,o){if(typeof document!="undefined"){o=gr({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var d in o)o[d]&&(a+="; "+d,o[d]!==!0&&(a+="="+o[d].split(";")[0]));return document.cookie=s+"="+r.write(n,s)+a}}function i(s){if(!(typeof document=="undefined"||arguments.length&&!s)){for(var n=document.cookie?document.cookie.split("; "):[],o={},a=0;a<n.length;a++){var d=n[a].split("="),c=d.slice(1).join("=");try{var u=decodeURIComponent(d[0]);if(o[u]=r.read(c,u),s===u)break}catch(f){}}return s?o[s]:o}}return Object.create({set:t,get:i,remove:function(s,n){t(s,"",gr({},n,{expires:-1}))},withAttributes:function(s){return to(this.converter,gr({},this.attributes,s))},withConverter:function(s){return to(gr({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var io=to(Bu,{path:"/"});var Si="utm_source",Ai="utm_medium",yi="utm_campaign",ro="utm_term",bi="utm_content",Ti=[Si,Ai,yi,ro,bi];function mr({name:r,value:e,expires:t=void 0,path:i=void 0,domain:s=void 0}){if(!r||!e)return!1;let n={secure:!0};return t&&(n.expires=t),i&&(n.path=i),s&&(n.domain=s),io.set(r,e,n),wi({name:r})}function wi({name:r}){return io.get(r)}function kd(){let r=wi({name:"_fs-test"});return r&&(r=JSON.parse(r),r.items.some((e,t)=>{e==r.selection&&(r.selected=t,r.testGroup=e.indexOf("ab_test")>-1?1:0)})),r}var Ri="undefined",it={playwrightTestsScriptId:"fs-playwright-tests-script",abTestsScriptId:"fs-ab-tests-script",fsAltConfigScriptId:"fsaltconfig",qaScriptId:"fs-qa"},we={fsLoadPubfigVersion:"fsLoadPubfigVersion",fsaltconfig:"fsaltconfig",fsdebug:"fsdebug"};var _r=B(we.fsdebug),so=[];_r&&_r!=="true"&&!Number.isInteger(+_r)&&(so=_r.split(",").map(r=>r.toUpperCase()));var no=()=>{if(typeof freestar.debug=="number")return freestar.debug;let r=B("fslog");if(r==="true")return 99;if(r!==""&&Number.isFinite(+r))return+r},Ud=(r,...e)=>{let t="Pubfig",i="background: #00C389; color: #fff; border-radius: 3px; padding: 3px";typeof r=="object"&&(t=r.title?r.title:t,i=r.styles?r.styles:i,r=typeof r.level!="undefined"?r.level:1),!(B("fs-log-filter")&&t!==B("fs-log-filter"))&&(no()>=r&&so.length===0||so.includes(t.toUpperCase()))&&console.info(`%c${t}: `,i,...e)};var Gd=()=>{let r=fsprebid.getBidResponses(),e=fsprebid.getAllWinningBids(),t=[];if(Object.keys(r).forEach(function(i){r[i].bids.forEach(function(n){t.push({bid:n,adunit:i,adId:n.adId,bidder:n.bidder,time:n.timeToRespond,dims:`${n.width}x${n.height}`,cpm:n.cpm,msg:n.status,rendered:!!e.find(function(o){return o.adId==n.adId})})})}),t.length&&!console.table)for(let i=0;i<t.length;i++);},ku={title:"Pubfig"},Er=class{constructor(){this.logs=[]}add(e){this.logs.push(e)}show(e=ku){if(!freestar.log||this.logs.length===0)return;let t=this.logs;this.logs=[],freestar.log(e,` ${t.join(` `)}`)}};var Ir="https://d.pub.network",Sr="https://c.pub.network",Ar="6.170.0",Fd="3edbef654199b3ee5e396793b59761d4f5d9dac8",Vd="&configId=NUMBER",Hd="&debug=true",qd="&testId=TEST_ID",zd="&variantId=VARIANT_ID",rt="fs.abtest.group",Ne="fs.abtest.id",yr="fs.abtest.type",vi="fs.abtest.variant_type",Yd="fs.abtest.pubfig_location",oo="fs.config";var Qd=Rt(br());var Ci={videoAdhesion:{prettyName:"Sticky Footer Video Adhesion",disabled:!1},stickyFooter:{prettyName:"Sticky Footer",disabled:!1,refreshDisabled:!1,refreshInterval:0},video:{prettyName:"Video",disabled:!1,refreshDisabled:!1,refreshInterval:0},standAloneVideo:{prettyName:"Stand Alone Video",disabled:!1,refreshDisabled:!1,refreshInterval:0},pushdown:{prettyName:"Pushdown",disabled:!1,refreshDisabled:!1,refreshInterval:0},dynamicAds:{prettyName:"Dynamic Ads",disabled:!1,refreshDisabled:!1,refreshInterval:0,optionsPath:"dynamicAdOptions"},dynamicAdsV2:{prettyName:"Dynamic Ads V2",disabled:!1,refreshDisabled:!1,refreshInterval:0,optionsPath:"dynamicAdOptionsV2"},footerBidding:{prettyName:"Footer Bidding",disabled:!1,refreshDisabled:!1,refreshInterval:0},superflex:{prettyName:"Superflex",disabled:!1,refreshDisabled:!1,refreshInterval:0},slidingUnit:{prettyName:"Sliding Unit",disabled:!1,refreshDisabled:!1,refreshInterval:0},sideWall:{prettyName:"Sidewall",disabled:!1,refreshDisabled:!1,refreshInterval:0},pageGrabber:{prettyName:"Page Grabber",disabled:!1,refreshDisabled:!1,refreshInterval:0},interstitial:{prettyName:"Interstitial",disabled:!1,refreshDisabled:!1,refreshInterval:0},googleInterstitial:{prettyName:"Google Interstitial",disabled:!1,refreshDisabled:!1,refreshInterval:0},dianomiContentRec:{prettyName:"Dianomi Content Recommendation",disabled:!1,refreshDisabled:!1,refreshInterval:0},lazyLoad:{prettyName:"Lazy Loaded Ads",disabled:!1,refreshDisabled:!1,refreshInterval:0},iai:{prettyName:"Intelligent Ad Insert",disabled:!1,refreshDisabled:!1,refreshInterval:0},stickyRail:{prettyName:"Sticky Rail",disabled:!1,refreshDisabled:!1,refreshInterval:0}};var Q={SILENT:0,CORE:5,MODULE:50,VERBOSE:99};var Wd=()=>{var o;let r=B("fslog"),e=Number(r);if(String(r).trim()==="true")return Q.VERBOSE;if(e)return Math.max(e,0);let t=B("fsdebug"),i=(o=window==null?void 0:window.freestar)==null?void 0:o.debug;if(t||i)return Q.VERBOSE;let s=Number(t),n=Number(i);return Number.isInteger(n)?Math.max(n,0):Number.isInteger(s)?Math.max(s,0):Q.SILENT};var Tr=class{constructor(e={}){let{config:t={}}=e;Object.assign(this,t),this.enabled_slots=t.enabled_slots||[],this.products=t.products?(0,Qd.default)(Ci,t.products):Ci,this.logLevel=Wd()}resetEnabledSlots(){this.enabled_slots=[]}setOriginalChanel(e){e&&(this.orignalChannel=e)}};function Jd(r){if(["null","nullblank","nullsrcdoc"].includes(r.trim()))return!0;try{let e=new URL(r).origin;return!(e.startsWith("file://")||e==="null")}catch(e){return!1}}var wr="freestar.com",Ju="undefined",am=`${Ju}pubfig.min.js`,Rr=[[640,360],[552,334]],vr=[[300,169],[400,225]],ao="https://a.pub.network/core",Zu="undefined",Zd=`${Zu}prebid.js`,Xd="prod",el=[{siteId:285,restrictedCountries:["IN","VN","NP","DZ","IQ","MA","AF","TR","EG","PK","ID","MA","BD","RS","PH","TN","BG"]}],tl=["triplelift"];var il=[[468,60],[728,90],[970,90],[970,250],[300,50],[300,100],[320,50],[320,100],[120,600],[160,600],[300,250],[300,600],[336,280],[1,1],[0,0]];var lo={v1:[{precision:2,min:0,max:20,increment:.01},{precision:2,min:20,max:40,increment:.5},{precision:2,min:40,max:100,increment:1},{precision:2,min:100,max:150,increment:2.5},{precision:2,min:150,max:250,increment:5},{precision:2,min:250,max:400,increment:10},{precision:2,min:400,max:800,increment:50}],v2:[{precision:2,min:0,max:2,increment:.01},{precision:2,min:2,max:10,increment:.05},{precision:2,min:10,max:20,increment:.5},{precision:2,min:20,max:100,increment:5}]};var co=["AT","BE","BG","HR","CY","CZ","DK","EE","EL","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB","NO","IS","LI","CH"],fo=["CA","CO","CT","VA","UT"];var rl=["sortable"],vt="FREESTAR",Me="NONE",Or={FREESTAR:"FREESTAR",NONE:"PUBLISHER"},Cr="00000000-0000-0000-0000-000000000000";var sl="fs.config",nl="amazon";function xe(r,e,t){if(!e)return;let s=(Array.isArray(e)?e:e.match(/([^[.\]])+/g)).reduce((n,o)=>n&&n[o],r);return s===void 0?t:s}function Pr({value:r}){return r&&Array.isArray(r)&&r.length>0}function al(r){return r===!!r}function Nr(r){return typeof r=="number"}function dl(r,e,t){return r.split(e).join(t)}function Mr(r){return typeof r=="string"}function uo(r,e){let t=typeof e=="function"?e:i=>i[e];return[...r.reduce((i,s)=>{let n=s==null?s:t(s);return i.has(n)||i.set(n,s),i},new Map).values()]}var ll=xe;function Di(r,e){let t=Math.max(...r.map(e));return r.find(i=>e(i)===t)}function cl(r){return[...new Set(r)]}function ol(r){return Object.prototype.toString.call(r).slice(8,-1).toLowerCase()}function Xu(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!xr(r[t],e[t]))return!1;return!0}function eh(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&!xr(r[t],e[t]))return!1;return!0}function th(r,e){return r.toString()===e.toString()}function ih(r,e){return r===e}function xr(r,e){let t=ol(r);return t!==ol(e)?!1:t==="array"?Xu(r,e):t==="object"?eh(r,e):t==="function"?th(r,e):ih(r,e)}function Dr(r){return r instanceof Object}function rh(r){return typeof r=="symbol"}function st(r){let e=/^\s+|\s+$/g,t=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,s=/^0o[0-7]+$/i;if(typeof r=="number")return r;if(rh(r))return NaN;if(Dr(r)){let o=typeof r.valueOf=="function"?r.valueOf():r;r=Dr(o)?o+"":o}if(typeof r!="string")return r===0?r:+r;r=r.replace(e,"");let n=i.test(r);return n||s.test(r)?parseInt(r.slice(2),n?2:8):t.test(r)?NaN:+r}function ho(r){return[...new Set(r.map(e=>JSON.stringify(e)))].map(e=>JSON.parse(e))}function Pi(r=window.freestar.locData){var t,i;let e=((i=(t=window==null?void 0:window.freestar)==null?void 0:t.fsdata)==null?void 0:i.mspaStates)||fo;return r?r.iso==="US"&&e.includes(r.state):!1}function po(r,e){let t=e&&e[r]||"";try{return JSON.parse(t)}catch(i){return t||""}}function nt(r){return r==null}var go=({placement:r,sizesAllowed:e=!1})=>{let{sizes:t}=r;return t=t.filter(i=>Array.isArray(i)),Array.isArray(e)&&(t=t.filter(i=>e.indexOf(i.join("x"))!==-1)),go(t)},fl=()=>{let r=B("quartile");return r!=null&&r!==""&&!Number.isNaN(Number(r))?Number(r):null},ul=()=>B("disableFC")==="true";function Lr(r,e){let t=null;return function(...i){let s=this;clearTimeout(t),t=setTimeout(()=>r.apply(s,i),e)}}function hl(r,e){let t=!1;return function(){t||(t=!0,setTimeout(()=>{t=!1},e),r())}}var k={string:{type:"string",default:""},array:{type:"array",default:[]},object:{type:"object",default:{}},number:{type:"number",default:void 0}};function G({key:r,type:e=k.string.type}){let t=sessionStorage.getItem(r);if(e===k.object.type){if(t){let i=JSON.parse(t);if(Dr(i))return i}return k.object.default}if(e===k.array.type){if(t){let i=JSON.parse(t);if(Array.isArray(i))return i}return k.array.default}if(e===k.number.type){let i=Number(t);return Number.isInteger(i)?i:k.number.default}return t}function ee({key:r,type:e=k.string,value:t}){t&&((e===k.object||e===k.array)&&(t=JSON.stringify(t)),sessionStorage.setItem(r,t))}function Br({key:r}){sessionStorage.removeItem(r)}var kr="pubfig.min.js",ml="https://a.pub.network/",pl="freestar-com",gl="fs.sitePath",sh=(r=window.document)=>{let e=r.querySelectorAll(`script[src*="${kr}"]`);return Array.from(e||[]).find(t=>!t.src.includes("/core/"))},nh=r=>{var e,t;return(t=(e=r==null?void 0:r.src)==null?void 0:e.split(ml)[1])==null?void 0:t.split("/")[0]},Ur=r=>{let e=G({key:gl});if(e&&e!==pl)return e;let t=sh(),i=nh(t||r)||pl;return ee({key:gl,value:i,type:k.string}),i},_l=(r=window,e)=>{var s,n,o;if(Ri.includes("localhost"))return Ri;let t=r.document.querySelectorAll(`script[src*="${kr}"]`),i=null;return e&&(i=Array.from(t).find(({id:a})=>a===e)),i||(i=Array.from(t).pop()),(o=i==null?void 0:i.src.substring(0,(i==null?void 0:i.src.lastIndexOf("/"))+1))!=null?o:`${ml}${(n=(s=r.freestar)==null?void 0:s.fsdata)==null?void 0:n.path}/`};var El="Video,Superflex,StickyFooter";function oh(){return El.includes("MODULES")?[]:El.split(",").map(r=>r.trim())}function Il(){if(B("fsdisable"))throw new Error("pubfig disabled.");if(!Jd(window.location.href))throw new Error("Pubfig disabled: Invalid page URL detected. Please ensure you are loading from a valid origin.")}function Sl(){if(freestar.performanceLogger.logMark({markerName:be.pubfigEngineLoadInit}),freestar.modulesLoaded.engine)return freestar.log(0,"========== ENGINE ALREADY LOADED =========="),!1;let r=window.fsprebid||{};if(window.fsprebid=r,r.que=r.que||[],r.retries=0,freestar.fsdata.disallowedGeos&&freestar.fsdata.disallowedGeos.length&&freestar.fsdata.disallowedGeos.includes(freestar.locData.iso))freestar.log(0,"Ad serving is blocked in "+freestar.locData.iso);else{if(freestar.modulesLoaded.engine)return freestar.log(0,"========== ENGINE ALREADY LOADED =========="),!1;ah(),freestar.pubfigState.configReady=!0,Te({name:"pubfigRunEngine",detail:!0})}}var ah=()=>y(void 0,null,function*(){let r=["engineMobile","engineDesktop","engineFallback"];for(let e of r)try{yield freestar.scriptsManager.loadScript(e);return}catch(t){}});function Al(){let r=window.freestar||{};window.freestar=r,r.log=Ud,r.disableAutoTrackPageviews=r.disableAutoTrackPageviews||!1,r.version=Ar,r.gitHash=Fd,r.hitTime=r.hitTime||Date.now(),r.queue=r.queue||[],r.pubfigState={configReady:!1};let e=new Tr(r);r.config=r.config||{},r.configManager=e,r.config.products=e.products,r.config.enabled_slots=e.enabled_slots,r.modulesLoaded=r.modulesLoaded||{engine:!1,messaging:!1,pubfig:!1,prebid:!1},r.msg={},r.msg.dispensaryURL=window.dispensaryUrl||Ir,r.consentManagement={consentData:{}},r.analyticsQueue=[],r.featuresIncluded=oh(),r.sitePath=r.sitePath||Ur(),r.newAdSlots=function(t,i=null){r.loaded||Ye("newAdSlots"),r.queue.push(function(){r.newAdSlots(t,i)})},r.deleteAdSlots=function(t){r.loaded||Ye("deleteAdSlots"),r.queue.push(function(){r.deleteAdSlots(t)})},r.newStickyFooter=function(t){r.loaded||Ye("newStickyFooter"),r.queue.push(function(){r.newStickyFooter(t)})},r.newSidewall=function(t){r.loaded||Ye("newSidewall"),r.queue.push(function(){r.newSidewall(t)})},r.newVideo=function(t){r.loaded||Ye("newVideo"),r.queue.push(function(){r.newVideo(t)})},r.newPushdown=function(t){r.loaded||Ye("newPushdown"),r.queue.push(function(){r.newPushdown(t)})},r.newStandAlonePlayer=function(t){r.loaded||Ye("newStandAlonePlayer"),r.queue.push(function(){r.newStandAlonePlayer(t)})},r.deleteStandAlonePlayer=function(t){r.loaded||Ye("deleteStandAlonePlayer"),r.queue.push(function(){r.deleteStandAlonePlayer(t)})}}function yl(){return y(this,null,function*(){let r=["prebid","prebidFallback"];for(let e of r)try{yield freestar.scriptsManager.loadScript(e);return}catch(t){}})}var Gr=class{constructor({freestar:e}){this._freestar=e,this._analytics=null,this.isReportingActive=G({key:Ne})||Math.random()*100<1,e.performanceMarksData=e.performanceMarksData||{pendingMarks:[],processedMarks:[]},this.isFirstLoad=this.getIsFirstLoad()}get performanceMarksData(){return this._freestar.performanceMarksData}set performanceMarksData(e){this._freestar.performanceMarksData=e}setAnalytics(e){this._analytics=e}resetPerformanceLogger(){sessionStorage.removeItem("hasLoadedBefore"),this.performanceMarksData={pendingMarks:[],processedMarks:[]}}fetchPerformanceMarkDetails({markerName:e,compareToData:t}){let i=performance==null?void 0:performance.getEntriesByName(e,"mark");if(i.length===0)return null;let s;t&&(s=performance==null?void 0:performance.getEntriesByName(t,"mark"));let n=i[0];return A({marker_name:n.name,absolute_time:n.startTime.toFixed(2)},this.compareMarks({mark:n,compareToPerformanceMarkData:s}))}compareMarks({mark:e,compareToPerformanceMarkData:t}){if(!t)return{};let i=(e.startTime-t[0].startTime).toFixed(2);return{compared_to:t[0].name,relative_Time:i}}fetchUserDetails(){let{deviceInfo:e,locData:t}=this._freestar,{browser:i,os:s,device:n}=e;return L(A({},t),{browser_name:i.name,browser_version:i.version,os_name:s.name,os_version:s.version,device_type:n.type})}getIsFirstLoad(){return sessionStorage.getItem("hasLoadedBefore")===null?(sessionStorage.setItem("hasLoadedBefore","true"),!0):!1}sendPerformanceMarkerToQueue({markerName:e,compareTo:t}){if(!(!this.isReportingActive||this.performanceMarksData.processedMarks.includes(e)))if(this.performanceMarksData.processedMarks.push(e),t.length===0){let i=this.fetchPerformanceMarkDetails({markerName:e}),s=this.fetchUserDetails(),n=new $({eventType:"PERFORMANCE",eventName:e.toUpperCase(),data:L(A(A({},i),s),{is_first_load:this.isFirstLoad,pubfig_version:this._freestar.version})});if(this._analytics){this._analytics.track(n);return}this._freestar.analyticsQueue.push(n)}else t.forEach(i=>{let s=this.fetchPerformanceMarkDetails({markerName:e,compareToData:i}),n=this.fetchUserDetails(),o=new $({eventType:"PERFORMANCE",eventName:e.toUpperCase(),data:L(A(A({},s),n),{is_first_load:this.isFirstLoad,pubfig_version:this._freestar.version})});if(this._analytics){this._analytics.track(o);return}this._freestar.analyticsQueue.push(o)})}pushAllPendingMarksToMsgQue(){this.performanceMarksData.pendingMarks.forEach(e=>{this.sendPerformanceMarkerToQueue(e)})}logMark({markerName:e,compareTo:t=[],isFreestarDataCollectorInitialized:i=!0}){if(performance.mark(e),!i||!this._freestar.deviceInfo||!this._freestar.locData){this.performanceMarksData.pendingMarks.push({markerName:e,compareTo:t});return}this.sendPerformanceMarkerToQueue({markerName:e,compareTo:t})}logPerformanceMarkers(){let e=performance.getEntriesByType("mark");for(let t of e)console.log(`Mark [${t.name}]: ${t.startTime.toFixed(2)}ms`)}};var dh="2.0.2",Ro=500,bl="user-agent",Jt="",Tl="?",qr="function",lt="undefined",Zt="object",vo="string",me="browser",$e="cpu",Ge="device",Le="engine",Re="os",Wt="result",R="name",I="type",v="vendor",O="version",_e="architecture",Vi="major",w="model",Gi="console",H="mobile",J="tablet",oe="smarttv",Ue="wearable",mo="xr",Fi="embedded",Ni="inapp",Do="brands",Ct="formFactors",Po="fullVersionList",Qt="platform",No="platformVersion",Yr="bitness",ct="sec-ch-ua",lh=ct+"-full-version-list",ch=ct+"-arch",fh=ct+"-"+Yr,uh=ct+"-form-factors",hh=ct+"-"+H,ph=ct+"-"+w,Fl=ct+"-"+Qt,gh=Fl+"-version",Vl=[Do,Po,H,w,Qt,No,_e,Ct,Yr],Fr="Amazon",jt="Apple",wl="ASUS",Rl="BlackBerry",Ot="Google",vl="Huawei",Ol="Lenovo",Cl="Honor",Vr="LG",_o="Microsoft",Eo="Motorola",Io="Nvidia",Dl="OnePlus",So="OPPO",Mi="Samsung",Pl="Sharp",xi="Sony",Ao="Xiaomi",yo="Zebra",Nl="Chrome",Ml="Chromium",ot="Chromecast",mh="Edge",Li="Firefox",Bi="Opera",xl="Facebook",Ll="Sogou",Kt="Mobile ",ki=" Browser",Oo="Windows",_h=typeof window!==lt,Ee=_h&&window.navigator?window.navigator:void 0,at=Ee&&Ee.userAgentData?Ee.userAgentData:void 0,Eh=function(r,e){var t={},i=e;if(!zr(e)){i={};for(var s in e)for(var n in e[s])i[n]=e[s][n].concat(i[n]?i[n]:[])}for(var o in r)t[o]=i[o]&&i[o].length%2===0?i[o].concat(r[o]):r[o];return t},$r=function(r){for(var e={},t=0;t<r.length;t++)e[r[t].toUpperCase()]=r[t];return e},Co=function(r,e){if(typeof r===Zt&&r.length>0){for(var t in r)if(je(r[t])==je(e))return!0;return!1}return ei(r)?je(e).indexOf(je(r))!==-1:!1},zr=function(r,e){for(var t in r)return/^(browser|cpu|device|engine|os)$/.test(t)||(e?zr(r[t]):!1)},ei=function(r){return typeof r===vo},bo=function(r){if(r){for(var e=[],t=Xt(/\\?\"/g,r).split(","),i=0;i<t.length;i++)if(t[i].indexOf(";")>-1){var s=Hi(t[i]).split(";v=");e[i]={brand:s[0],version:s[1]}}else e[i]=Hi(t[i]);return e}},je=function(r){return ei(r)?r.toLowerCase():r},To=function(r){return ei(r)?Xt(/[^\d\.]/g,r).split(".")[0]:void 0},Ke=function(r){for(var e in r){var t=r[e];typeof t==Zt&&t.length==2?this[t[0]]=t[1]:this[t]=void 0}return this},Xt=function(r,e){return ei(e)?e.replace(r,Jt):e},Ui=function(r){return Xt(/\\?\"/g,r)},Hi=function(r,e){if(ei(r))return r=Xt(/^\s\s*/,r),typeof e===lt?r:r.substring(0,Ro)},wo=function(r,e){if(!(!r||!e))for(var t=0,i,s,n,o,a,d;t<e.length&&!a;){var c=e[t],u=e[t+1];for(i=s=0;i<c.length&&!a&&c[i];)if(a=c[i++].exec(r),a)for(n=0;n<u.length;n++)d=a[++s],o=u[n],typeof o===Zt&&o.length>0?o.length===2?typeof o[1]==qr?this[o[0]]=o[1].call(this,d):this[o[0]]=o[1]:o.length===3?typeof o[1]===qr&&!(o[1].exec&&o[1].test)?this[o[0]]=d?o[1].call(this,d,o[2]):void 0:this[o[0]]=d?d.replace(o[1],o[2]):void 0:o.length===4&&(this[o[0]]=d?o[3].call(this,d.replace(o[1],o[2])):void 0):this[o]=d||void 0;t+=2}},dt=function(r,e){for(var t in e)if(typeof e[t]===Zt&&e[t].length>0){for(var i=0;i<e[t].length;i++)if(Co(e[t][i],r))return t===Tl?void 0:t}else if(Co(e[t],r))return t===Tl?void 0:t;return e.hasOwnProperty("*")?e["*"]:r},Bl={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},kl={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},Ul={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[O,[R,Kt+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[O,[R,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[R,O],[/opios[\/ ]+([\w\.]+)/i],[O,[R,Bi+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[O,[R,Bi+" GX"]],[/\bopr\/([\w\.]+)/i],[O,[R,Bi]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[O,[R,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[O,[R,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[R,O],[/quark(?:pc)?\/([-\w\.]+)/i],[O,[R,"Quark"]],[/\bddg\/([\w\.]+)/i],[O,[R,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[O,[R,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[O,[R,"WeChat"]],[/konqueror\/([\w\.]+)/i],[O,[R,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[O,[R,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[O,[R,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[O,[R,"Smart "+Ol+ki]],[/(avast|avg)\/([\w\.]+)/i],[[R,/(.+)/,"$1 Secure"+ki],O],[/\bfocus\/([\w\.]+)/i],[O,[R,Li+" Focus"]],[/\bopt\/([\w\.]+)/i],[O,[R,Bi+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[O,[R,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[O,[R,"Dolphin"]],[/coast\/([\w\.]+)/i],[O,[R,Bi+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[O,[R,"MIUI"+ki]],[/fxios\/([\w\.-]+)/i],[O,[R,Kt+Li]],[/\bqihoobrowser\/?([\w\.]*)/i],[O,[R,"360"]],[/\b(qq)\/([\w\.]+)/i],[[R,/(.+)/,"$1Browser"],O],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[R,/(.+)/,"$1"+ki],O],[/samsungbrowser\/([\w\.]+)/i],[O,[R,Mi+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[O,[R,Ll+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[R,Ll+" Mobile"],O],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[R,O],[/(lbbrowser|rekonq)/i],[R],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[O,R],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[R,xl],O,[I,Ni]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[R,O,[I,Ni]],[/\bgsa\/([\w\.]+) .*safari\//i],[O,[R,"GSA"],[I,Ni]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[O,[R,"TikTok"],[I,Ni]],[/\[(linkedin)app\]/i],[R,[I,Ni]],[/(chromium)[\/ ]([-\w\.]+)/i],[R,O],[/headlesschrome(?:\/([\w\.]+)| )/i],[O,[R,Nl+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[R,Nl+" WebView"],O],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[O,[R,"Android"+ki]],[/chrome\/([\w\.]+) mobile/i],[O,[R,Kt+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[R,O],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[O,[R,Kt+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[R,Kt+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[O,R],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[R,[O,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[R,O],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[R,Kt+Li],O],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[R,"Netscape"],O],[/(wolvic|librewolf)\/([\w\.]+)/i],[R,O],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[O,[R,Li+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[R,[O,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[R,[O,/[^\d\.]+./,Jt]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[_e,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[_e,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[_e,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[_e,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[_e,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[_e,/ower/,Jt,je]],[/ sun4\w[;\)]/i],[[_e,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[_e,je]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[w,[v,Mi],[I,J]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[w,[v,Mi],[I,H]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[w,[v,jt],[I,H]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[w,[v,jt],[I,J]],[/(macintosh);/i],[w,[v,jt]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[w,[v,Pl],[I,H]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[w,[v,Cl],[I,J]],[/honor([-\w ]+)[;\)]/i],[w,[v,Cl],[I,H]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[w,[v,vl],[I,J]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[w,[v,vl],[I,H]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[w,/_/g," "],[v,Ao],[I,J]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[w,/_/g," "],[v,Ao],[I,H]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[w,[v,So],[I,H]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[w,[v,dt,{OnePlus:["304","403","203"],"*":So}],[I,J]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[w,[v,"Vivo"],[I,H]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[w,[v,"Realme"],[I,H]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[w,[v,Eo],[I,H]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[w,[v,Eo],[I,J]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[w,[v,Vr],[I,J]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[w,[v,Vr],[I,H]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[w,[v,Ol],[I,J]],[/(nokia) (t[12][01])/i],[v,w,[I,J]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[w,/_/g," "],[I,H],[v,"Nokia"]],[/(pixel (c|tablet))\b/i],[w,[v,Ot],[I,J]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[w,[v,Ot],[I,H]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[w,[v,xi],[I,H]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[w,"Xperia Tablet"],[v,xi],[I,J]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[w,[v,Dl],[I,H]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[w,[v,Fr],[I,J]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[w,/(.+)/g,"Fire Phone $1"],[v,Fr],[I,H]],[/(playbook);[-\w\),; ]+(rim)/i],[w,v,[I,J]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[w,[v,Rl],[I,H]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[w,[v,wl],[I,J]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[w,[v,wl],[I,H]],[/(nexus 9)/i],[w,[v,"HTC"],[I,J]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[w,/_/g," "],[I,H]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[w,[v,"TCL"],[I,J]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[w,[v,"TCL"],[I,H]],[/(itel) ((\w+))/i],[[v,je],w,[I,dt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[w,[v,"Acer"],[I,J]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[w,[v,"Meizu"],[I,H]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[w,[v,"Ulefone"],[I,H]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[w,[v,"Energizer"],[I,H]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[w,[v,"Cat"],[I,H]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[w,[v,"Smartfren"],[I,H]],[/droid.+; (a(?:015|06[35]|142p?))/i],[w,[v,"Nothing"],[I,H]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[v,w,[I,J]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[v,w,[I,H]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[v,w,[I,J]],[/(surface duo)/i],[w,[v,_o],[I,J]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[w,[v,"Fairphone"],[I,H]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[w,[v,Io],[I,J]],[/(sprint) (\w+)/i],[v,w,[I,H]],[/(kin\.[onetw]{3})/i],[[w,/\./g," "],[v,_o],[I,H]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[w,[v,yo],[I,J]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[w,[v,yo],[I,H]],[/smart-tv.+(samsung)/i],[v,[I,oe]],[/hbbtv.+maple;(\d+)/i],[[w,/^/,"SmartTV"],[v,Mi],[I,oe]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Vr],[I,oe]],[/(apple) ?tv/i],[v,[w,jt+" TV"],[I,oe]],[/crkey.*devicetype\/chromecast/i],[[w,ot+" Third Generation"],[v,Ot],[I,oe]],[/crkey.*devicetype\/([^/]*)/i],[[w,/^/,"Chromecast "],[v,Ot],[I,oe]],[/fuchsia.*crkey/i],[[w,ot+" Nest Hub"],[v,Ot],[I,oe]],[/crkey/i],[[w,ot],[v,Ot],[I,oe]],[/droid.+aft(\w+)( bui|\))/i],[w,[v,Fr],[I,oe]],[/(shield \w+ tv)/i],[w,[v,Io],[I,oe]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[w,[v,Pl],[I,oe]],[/(bravia[\w ]+)( bui|\))/i],[w,[v,xi],[I,oe]],[/(mi(tv|box)-?\w+) bui/i],[w,[v,Ao],[I,oe]],[/Hbbtv.*(technisat) (.*);/i],[v,w,[I,oe]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,Hi],[w,Hi],[I,oe]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[w,[I,oe]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[I,oe]],[/(ouya)/i,/(nintendo) (\w+)/i],[v,w,[I,Gi]],[/droid.+; (shield)( bui|\))/i],[w,[v,Io],[I,Gi]],[/(playstation \w+)/i],[w,[v,xi],[I,Gi]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[w,[v,_o],[I,Gi]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[w,[v,Mi],[I,Ue]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[v,w,[I,Ue]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[w,[v,So],[I,Ue]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[w,[v,jt],[I,Ue]],[/(opwwe\d{3})/i],[w,[v,Dl],[I,Ue]],[/(moto 360)/i],[w,[v,Eo],[I,Ue]],[/(smartwatch 3)/i],[w,[v,xi],[I,Ue]],[/(g watch r)/i],[w,[v,Vr],[I,Ue]],[/droid.+; (wt63?0{2,3})\)/i],[w,[v,yo],[I,Ue]],[/droid.+; (glass) \d/i],[w,[v,Ot],[I,mo]],[/(pico) (4|neo3(?: link|pro)?)/i],[v,w,[I,mo]],[/; (quest( \d| pro)?)/i],[w,[v,xl],[I,mo]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[I,Fi]],[/(aeobc)\b/i],[w,[v,Fr],[I,Fi]],[/(homepod).+mac os/i],[w,[v,jt],[I,Fi]],[/windows iot/i],[[I,Fi]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[w,[I,dt,{mobile:"Mobile",xr:"VR","*":J}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[I,J]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[I,H]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[w,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[O,[R,mh+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[R,O],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[O,[R,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[R,O],[/ladybird\//i],[[R,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[O,R]],os:[[/microsoft (windows) (vista|xp)/i],[R,O],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[R,[O,dt,Bl]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[O,dt,Bl],[R,Oo]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[O,/_/g,"."],[R,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[R,"macOS"],[O,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[O,[R,ot+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[O,[R,ot+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[O,[R,ot+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[O,[R,ot+" Linux"]],[/crkey\/([\d\.]+)/i],[O,[R,ot]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[O,R],[/(ubuntu) ([\w\.]+) like android/i],[[R,/(.+)/,"$1 Touch"],O],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[R,O],[/\(bb(10);/i],[O,[R,Rl]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[O,[R,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[O,[R,Li+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[O,[R,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[O,[R,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[R,"Chrome OS"],O],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[R,O],[/(sunos) ?([\w\.\d]*)/i],[[R,"Solaris"],O],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[R,O]]},Hr=function(){var r={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Ke.call(r.init,[[me,[R,O,Vi,I]],[$e,[_e]],[Ge,[I,w,v]],[Le,[R,O]],[Re,[R,O]]]),Ke.call(r.isIgnore,[[me,[O,Vi]],[Le,[O]],[Re,[O]]]),Ke.call(r.isIgnoreRgx,[[me,/ ?browser$/i],[Re,/ ?os$/i]]),Ke.call(r.toString,[[me,[R,O]],[$e,[_e]],[Ge,[v,w]],[Le,[R,O]],[Re,[R,O]]]),r}(),Ih=function(r,e){var t=Hr.init[e],i=Hr.isIgnore[e]||0,s=Hr.isIgnoreRgx[e]||0,n=Hr.toString[e]||0;function o(){Ke.call(this,t)}return o.prototype.getItem=function(){return r},o.prototype.withClientHints=function(){return at?at.getHighEntropyValues(Vl).then(function(a){return r.setCH(new Hl(a,!1)).parseCH().get()}):r.parseCH().get()},o.prototype.withFeatureCheck=function(){return r.detectFeature().get()},e!=Wt&&(o.prototype.is=function(a){var d=!1;for(var c in this)if(this.hasOwnProperty(c)&&!Co(i,c)&&je(s?Xt(s,this[c]):this[c])==je(s?Xt(s,a):a)){if(d=!0,a!=lt)break}else if(a==lt&&d){d=!d;break}return d},o.prototype.toString=function(){var a=Jt;for(var d in n)typeof this[n[d]]!==lt&&(a+=(a?" ":Jt)+this[n[d]]);return a||lt}),at||(o.prototype.then=function(a){var d=this,c=function(){for(var f in d)d.hasOwnProperty(f)&&(this[f]=d[f])};c.prototype={is:o.prototype.is,toString:o.prototype.toString};var u=new c;return a(u),u}),new o};function Hl(r,e){if(r=r||{},Ke.call(this,Vl),e)Ke.call(this,[[Do,bo(r[ct])],[Po,bo(r[lh])],[H,/\?1/.test(r[hh])],[w,Ui(r[ph])],[Qt,Ui(r[Fl])],[No,Ui(r[gh])],[_e,Ui(r[ch])],[Ct,bo(r[uh])],[Yr,Ui(r[fh])]]);else for(var t in r)this.hasOwnProperty(t)&&typeof r[t]!==lt&&(this[t]=r[t])}function Gl(r,e,t,i){return this.get=function(s){return s?this.data.hasOwnProperty(s)?this.data[s]:void 0:this.data},this.set=function(s,n){return this.data[s]=n,this},this.setCH=function(s){return this.uaCH=s,this},this.detectFeature=function(){if(Ee&&Ee.userAgent==this.ua)switch(this.itemType){case me:Ee.brave&&typeof Ee.brave.isBrave==qr&&this.set(R,"Brave");break;case Ge:!this.get(I)&&at&&at[H]&&this.set(I,H),this.get(w)=="Macintosh"&&Ee&&typeof Ee.standalone!==lt&&Ee.maxTouchPoints&&Ee.maxTouchPoints>2&&this.set(w,"iPad").set(I,J);break;case Re:!this.get(R)&&at&&at[Qt]&&this.set(R,at[Qt]);break;case Wt:var s=this.data,n=function(o){return s[o].getItem().detectFeature().get()};this.set(me,n(me)).set($e,n($e)).set(Ge,n(Ge)).set(Le,n(Le)).set(Re,n(Re))}return this},this.parseUA=function(){return this.itemType!=Wt&&wo.call(this.data,this.ua,this.rgxMap),this.itemType==me&&this.set(Vi,To(this.get(O))),this},this.parseCH=function(){var s=this.uaCH,n=this.rgxMap;switch(this.itemType){case me:case Le:var o=s[Po]||s[Do],a;if(o)for(var d in o){var c=o[d].brand||o[d],u=o[d].version;this.itemType==me&&!/not.a.brand/i.test(c)&&(!a||/chrom/i.test(a)&&c!=Ml)&&(c=dt(c,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome"}),this.set(R,c).set(O,u).set(Vi,To(u)),a=c),this.itemType==Le&&c==Ml&&this.set(O,u)}break;case $e:var f=s[_e];f&&(f&&s[Yr]=="64"&&(f+="64"),wo.call(this.data,f+";",n));break;case Ge:if(s[H]&&this.set(I,H),s[w]&&(this.set(w,s[w]),!this.get(I)||!this.get(v))){var p={};wo.call(p,"droid 9; "+s[w]+")",n),!this.get(I)&&p.type&&this.set(I,p.type),!this.get(v)&&p.vendor&&this.set(v,p.vendor)}if(s[Ct]){var h;if(typeof s[Ct]!="string")for(var m=0;!h&&m<s[Ct].length;)h=dt(s[Ct][m++],kl);else h=dt(s[Ct],kl);this.set(I,h)}break;case Re:var S=s[Qt];if(S){var b=s[No];S==Oo&&(b=parseInt(To(b),10)>=13?"11":"10"),this.set(R,S).set(O,b)}this.get(R)==Oo&&s[w]=="Xbox"&&this.set(R,"Xbox").set(O,void 0);break;case Wt:var g=this.data,_=function(M){return g[M].getItem().setCH(s).parseCH().get()};this.set(me,_(me)).set($e,_($e)).set(Ge,_(Ge)).set(Le,_(Le)).set(Re,_(Re))}return this},Ke.call(this,[["itemType",r],["ua",e],["uaCH",i],["rgxMap",t],["data",Ih(this,r)]]),this}function Fe(r,e,t){if(typeof r===Zt?(zr(r,!0)?(typeof e===Zt&&(t=e),e=r):(t=r,e=void 0),r=void 0):typeof r===vo&&!zr(e,!0)&&(t=e,e=void 0),t&&typeof t.append===qr){var i={};t.forEach(function(d,c){i[c]=d}),t=i}if(!(this instanceof Fe))return new Fe(r,e,t).getResult();var s=typeof r===vo?r:t&&t[bl]?t[bl]:Ee&&Ee.userAgent?Ee.userAgent:Jt,n=new Hl(t,!0),o=e?Eh(Ul,e):Ul,a=function(d){return d==Wt?function(){return new Gl(d,s,o,n).set("ua",s).set(me,this.getBrowser()).set($e,this.getCPU()).set(Ge,this.getDevice()).set(Le,this.getEngine()).set(Re,this.getOS()).get()}:function(){return new Gl(d,s,o[d],n).parseUA().get()}};return Ke.call(this,[["getBrowser",a(me)],["getCPU",a($e)],["getDevice",a(Ge)],["getEngine",a(Le)],["getOS",a(Re)],["getResult",a(Wt)],["getUA",function(){return s}],["setUA",function(d){return ei(d)&&(s=d.length>Ro?Hi(d,Ro):d),this}]]).setUA(s),this}Fe.VERSION=dh;Fe.BROWSER=$r([R,O,Vi,I]);Fe.CPU=$r([_e]);Fe.DEVICE=$r([w,v,I,Gi,H,oe,J,Ue,Fi]);Fe.ENGINE=Fe.OS=$r([R,O]);var qi="desktop",Ve="mobile",jr="tablet";var Mo="fs.session",Kr=class{constructor({freestar:e,window:t}){E(this,"deviceInfo",{});var s;this._freestar=e,this._window=t,this.cdep=!!this._freestar.cdep;let i=JSON.parse(G({key:Mo}));this.known=Number((s=i==null?void 0:i.known)!=null?s:0)}initManager(){this._window.freestar=this._window.freestar||{},this._setDeviceType()}_setDeviceType(){this.deviceInfo=Fe(),this._window.freestar.deviceInfo=this.deviceInfo,this.deviceInfo.device.type||(this.deviceInfo.device={type:qi})}get userAgent(){let e=this.deviceInfo.browser.name,t=this.deviceInfo.os.name;return t==="Mac OS"&&e==="Safari"?"Safari":t==="iOS"?"iOS":e}_update(e){this.known=e;let t=JSON.parse(G({key:Mo}));if((t==null?void 0:t.known)!==this.known){let i=L(A({},t),{known:this.known});ee({key:Mo,type:k.object,value:i})}}get isKnownByPrebidUser(){var e;return!!((e=window.fsprebid)!=null&&e.getUserIds&&Object.keys(window.fsprebid.getUserIds()).length)}get isCDEPUser(){return this.cdep}get _isKnown(){return Number(!this.isCDEPUser&&this.isKnownByPrebidUser)}get isKnown(){return this._update(this._isKnown),this.known}};var Dt="fs.altConfig";var Wr=" exiting after creating new instance...",Lo=class{constructor({win:e=window}={}){this._window=e,this._window._pubfigInstanceManagerConfig=this._window._pubfigInstanceManagerConfig||{},this.config=this._window._pubfigInstanceManagerConfig,this.fsLoadPubfigVersionUrlParams=B(we.fsLoadPubfigVersion,e),this.fsLoadPubfigVersionUrlParams&&(this._window.freestar.pubfigVersionToLoad=this.fsLoadPubfigVersionUrlParams),this.fsAltConfigUrlParams=this._getAltConfigVersion(),this.isQA=B(we.fsdebug,e),this._currentSitePath=this._window.freestar.sitePath}_getAltConfigVersion(){let e=B(we.fsaltconfig,this._window),t=G({key:Dt});return e||t}setPubfigMinCurrentId(e){Object.values(it).includes(e)&&(this.config.pubfigMinCurrentId=e)}get sourcesPath(){return!0?_l(this._window,this.config.pubfigMinCurrentId):this.config.pubfigMinCurrentId===it.playwrightTestsScriptId?`https://a.pub.network/core/pubfig/${this.fsLoadPubfigVersionUrlParams}/`:Ri}loadAlternativeInstance({src:e,errorString:t}){let i=F({type:"script",id:this.config.pubfigMinCurrentId,src:e},this._window.document);throw this._window.document.head.appendChild(i),new Error(t)}checkForAlternativeInstances({isTest:e,onAlternativeInstanceFound:t}={isTest:"",onAlternativeInstanceFound:()=>{}}){this.fsLoadPubfigVersionUrlParams&&!this.config.loadPubfigVersionRedirect&&(this.config.loadPubfigVersionRedirect=!0,this.setPubfigMinCurrentId(it.playwrightTestsScriptId),t(),this.loadAlternativeInstance({src:`https://a.pub.network/core/pubfig/${this.fsLoadPubfigVersionUrlParams}/pubfig.min.js`,errorString:`PLAYWRIGHTS TEST FOUND -${Wr}`})),e&&e.length&&(t(),this.setPubfigMinCurrentId(it.abTestsScriptId),this._window.freestar.redirected=!0,this.loadAlternativeInstance({src:e,errorString:`AB TEST FOUND -${Wr}`}));let i=Array.from(document.querySelectorAll(`script#${it.fsAltConfigScriptId}`));if(this.fsAltConfigUrlParams&&i.length===0&&(ee({key:Dt,value:this.fsAltConfigUrlParams}),t(),this.setPubfigMinCurrentId(it.fsAltConfigScriptId),this.loadAlternativeInstance({src:`https://a.pub.network/${this._currentSitePath}/test/${this.fsAltConfigUrlParams}/pubfig.min.js?bypass=true`,errorString:`Alternate Configuration - found alt version,${Wr}`})),this.isQA&&!this.config.fsQaRedirect){this.config.fsQaRedirect=!0;let s;document.querySelectorAll("script").forEach(n=>{if(n.innerText.includes("qa/pubfig")){s=!0;return}}),s||(t(),this.setPubfigMinCurrentId(it.qaScriptId),this.loadAlternativeInstance({src:`https://a.pub.network/${this._currentSitePath}/qa/pubfig.min.js`,errorString:`QA version called via params -${Wr}`}))}}},xo=null;function He(){return xo||(xo=new Lo),xo}function Qr({freestar:r=window.freestar,network:e}){return!e.deviceExclusive||e.deviceExclusive.toLowerCase()===r.deviceInfo.device.type}var Sh={emxdigital:"emx_digital",synacor:"synacormedia"},Jr=class{constructor({freestar:e}){this._freestar=e}_normalizeLocation(e){let i=xe(e,"location");if(i)return{iso:i.countryCode,city:i.cityName,state:i.state}}networkSlugModification(e=""){return Sh[e]||e}_processNetworkMap(e){return xe(e,"networkMap.networks")}_adaptFsDataSettings(e){var i,s,n,o;let t=xe(e,"pubfigSettings.fsdata");return t&&(t.timeout=(i=t.timeout)!=null?i:3e3,t.mobileTimeout=(s=t.mobileTimeout)!=null?s:3e3),(n=t==null?void 0:t.placements)!=null&&n.length&&(t.placements=this._filterOutArchivedPlacements(t.placements),t.placements.forEach(a=>{a.sizeMappings.sort(function(d,c){return d.viewport.size[0]===c.viewport.size[0]?0:d.viewport.size[0]>c.viewport.size[0]?-1:1})})),(o=t==null?void 0:t.networks)!=null&&o.length&&(t.networks=this._getDeviceExclusiveNetworks(t.networks)),t}_getDeviceExclusiveNetworks(e){return e.filter(t=>Qr({freestar:this._freestar,network:t}))}_filterOutArchivedPlacements(e){return e.filter(t=>!t.archived)}_getFpc(e){return e.fsuid}_getAbTest(e){var t;return(t=xe(e,"pubfigSettings.abTest"))!=null?t:{}}_getPubfigLocation(e){return xe(e,"pubfigSettings.pubfigLocation")}adapt(e){return!e||Object.keys(e).length===0?(console.error("Empty data provided to DispensaryDataAdapter"),{}):{fpc:this._getFpc(e),location:this._normalizeLocation(e),networkMap:this._processNetworkMap(e),fsdata:this._adaptFsDataSettings(e,e.adRefresh),abTest:this._getAbTest(e),pubfigLocation:this._getPubfigLocation(e)}}};var Zr=class{constructor({freestar:e}){this.adapters={dispensaryData:new Jr({freestar:e})}}adapt(e,t){if(!this.adapters[e])throw new Error(`No adapter found for data type ${e}`);return this.adapters[e].adapt(t)}};var Xr=class{constructor({freestar:e}){E(this,"_isLoaded",!1);this._freestar=e,this.fpc,this.locData,this.networkMap,this.fsdata,this.config={},this.envAndConfig,this.cdep,this.dataAdapter=new Zr({freestar:e})}load(){return y(this,null,function*(){this._isLoaded||(this._setEnvironmentAndConfig(),yield this._fetchDispensaryData(),this.cdep=yield this._getCookieDeprecationLabel(),this._isLoaded=!0)})}_setEnvironmentAndConfig(){let e=Pd(we.fsdebug),t=B(we.fsaltconfig),i=G({key:Dt}),s=t||i,n=B("fstesturl");this.envAndConfig={env:"PROD",version:!1,altUrl:n},e?this.envAndConfig.env="QA":s&&s>0&&(this.envAndConfig.env="TEST",this.envAndConfig.version=s)}_getCookieDeprecationLabel(){return y(this,null,function*(){return"cookieDeprecationLabel"in navigator?navigator.cookieDeprecationLabel.getValue():null})}_getInitUrl(){let e=`${Ir}/v2/sites/${this._freestar.sitePath}/configs?env=${this.envAndConfig.env}`;this.envAndConfig.env==="TEST"&&(e+=Vd.replace("NUMBER",this.envAndConfig.version.toString())),this.envAndConfig.env!=="PROD"&&(e+=Hd);let t=G({key:Ne}),i=G({key:vi});return t&&(e+=qd.replace("TEST_ID",t)),i&&(e+=zd.replace("VARIANT_ID",i)),e}_fallBackFetch(){return y(this,null,function*(){let e=yield fetch(`https://a.pub.network/${this._freestar.sitePath}/fsdata.json`);if(!e.ok){let i=`No data returned from fsdata fallback endpoint: ${e.status}`;throw new Error(i)}let t=yield e.json();t?(this.fsdata=t,this.locData=null,this.networkMap=null):console.error("DispensaryData: No data returned from dispensary endpoint")})}_reportEmptyData(){freestar.analyticsQueue.push(new $({eventName:"INIT_ENDPOINT_FAILED",eventType:"EMPTY_FSDATA",data:freestar.fsdata})),console.error("DispensaryData: Empty data returned")}abTestDataFetchAndSet({pubfigSettings:{abTest:e,pubfigLocation:t}}){if(e&&!this._freestar.redirected){let{testGroup:i,testId:s,testType:n,testVariantId:o}=e;if(`${i}`.length&&ee({key:rt,value:`${i}`,type:k.string}),s&&ee({key:Ne,value:s,type:k.string}),o&&ee({key:vi,value:o,type:k.string}),n&&(ee({key:yr,value:n,type:k.string}),t))return ee({key:Yd,value:t,type:k.string}),t}return!1}_getLocationData(e,t){let i=xe(e,t);if(i)return{iso:i.countryCode,city:i.cityName,state:i.state}}_processData(e){let t=this.dataAdapter.adapt("dispensaryData",e);He().checkForAlternativeInstances({isTest:this.abTestDataFetchAndSet(e),onAlternativeInstanceFound:()=>{this._freestar.performanceLogger.resetPerformanceLogger(),this._freestar.modulesLoaded.pubfig=!1}}),this.fpc=t.fpc,this.locData=t.location,this.networkMap=t.networkMap,this.fsdata=t.fsdata,this.abTest=t.abTest,this.pubfigLocation=t.pubfigLocation}_fetchDispensaryData(){return y(this,null,function*(){let e=G({key:oo});if(e&&(e=JSON.parse(e),e.timestamp&&(Date.now()-e.timestamp)/1e3/60>=3*60&&(e=null)),(this.envAndConfig.env!=="PROD"||this.envAndConfig.env==="PROD"&&e&&e.altconfig)&&(e=null),!e)try{let t=yield fetch(this._getInitUrl(),{credentials:"include"});if(!t.ok)throw console.log(`DispensaryData: No data returned from initURL fetching fsdata endpoint: ${t.status}`),new Error("Fetching dispensary data failed");if(e=yield t.json(),!e||Object.keys(e).length===0)throw this._reportEmptyData(),new Error("Empty data returned");e.timestamp=Date.now(),this.envAndConfig.env==="TEST"&&!e.altconfig&&(e.altconfig=!0),ee({key:oo,value:e,type:k.object})}catch(t){yield this._fallBackFetch();return}this._processData(e)})}getValue(e){return xe(this.fsdata,e)}};var es=class{constructor({win:e,scripts:t=[]}={}){this._win=e,this._scripts=new Map(t.map(i=>[i.id,i]))}addScripts(e){e.forEach(t=>this._scripts.set(t.id,t))}getScript(e){return this._scripts.get(e)}loadScript(e){return y(this,null,function*(){let t=this.getScript(e);if(!t)throw new Error(`Script ${e} not found`);return t.load()})}loadScripts(){return y(this,arguments,function*({id:e=[]}={}){let t=e.flatMap(i=>this.getScript(i)||[]);return Promise.all(t.map(i=>i.load()))})}};var Pt={IDLE:"idle",PENDING:"pending",READY:"ready",SKIPPED:"skipped",ERROR:"error"},Ie=class{constructor({id:e,location:t}){this.status=Pt.IDLE,this.id=e,this.location=t,this._onLoad=[]}onLoad(e){if(this.status===Pt.READY){e();return}this._onLoad.push(e)}beforeLoad(){return!0}afterLoad(){}load(){return y(this,null,function*(){if(this.status!==Pt.IDLE)return;if(this.status=Pt.PENDING,!this.beforeLoad()){this.status=Pt.SKIPPED;return}try{yield pr(this.location,null,null),this.afterLoad(),this._onLoad.forEach(t=>t()),this._onLoad=[],this.status=Pt.READY}catch(t){throw this.status=Pt.ERROR,t}})}};var ts=class extends Ie{constructor({freestar:e=window.freestar,instanceManager:t=He()}={}){super({id:"engineMobile",location:`${t.sourcesPath}pubfig.engine.mobile.js`}),this._freestar=e}load(){var t,i,s;let e=(s=(i=(t=this._freestar.deviceInfo)==null?void 0:t.device)==null?void 0:i.type)!=null?s:"desktop";if(!(!0&&e.toLowerCase()==="mobile"))throw new Error("device type not supported");return super.load()}afterLoad(){this._restoreGlobalUnderscore()}_restoreGlobalUnderscore(){this._freestar.globalUnderscore&&(window._=this._freestar.globalUnderscore)}};var is=class extends Ie{constructor({freestar:e=window.freestar,instanceManager:t=He()}={}){super({id:"engineDesktop",location:`${t.sourcesPath}pubfig.engine.js`}),this._freestar=e}afterLoad(){this._restoreGlobalUnderscore()}_restoreGlobalUnderscore(){this._freestar.globalUnderscore&&(window._=this._freestar.globalUnderscore)}};var rs="https://a.pub.network/core/pubfig";var ss=class extends Ie{constructor({freestar:e=window.freestar}={}){super({id:"engineFallback",location:`${rs}/${e.version}/pubfig.engine.js`}),this._freestar=e}afterLoad(){this._restoreGlobalUnderscore()}_restoreGlobalUnderscore(){this._freestar.globalUnderscore&&(window._=this._freestar.globalUnderscore)}};var Ah="https://securepubads.g.doubleclick.net/tag/js/gpt.js",ns=class extends Ie{constructor({win:e=window,dispensaryData:t}={}){super({id:"gam",location:""}),this._win=e,this._dispensaryData=t,this._setLocation()}beforeLoad(){return this._win.googletag=this._win.googletag||{},this._win.googletag.cmd=this._win.googletag.cmd||[],!0}_getGamNetworkCode(){var s,n,o;let e=(s=this._dispensaryData.fsdata)==null?void 0:s.placements,t=e==null?void 0:e[0],i=(n=t==null?void 0:t.dfpId)==null?void 0:n.split("/");return!i||i.length<2?null:((o=i[1])==null?void 0:o.split(",")[0])||null}_setLocation(){this.location=Ah}};var os=class extends Ie{constructor({instanceManager:e=He()}={}){let i=Xd==="dev"?Zd:`${e.sourcesPath}prebid.js`;super({id:"prebid",location:i})}};var as=class extends Ie{constructor({freestar:e=window.freestar}={}){super({id:"prebidFallback",location:`${rs}/${e.version}/prebid.js`})}};var ti=({getIsFound:r,getElement:e=()=>null,callback:t,timeout:i=5e3,frequency:s=300})=>{let n=0,o=r(),a=e();if(o){t(o,a);return}let d=setInterval(()=>{n=n+1;let c=r(),u=e();(c||n>=i/s)&&(t(c,u),clearInterval(d))},s)};var ko=({elementSelector:r,callback:e,timeout:t=5e3,frequency:i=300,doc:s=document})=>{ti({getIsFound:()=>!!s.querySelector(r),getElement:()=>s.querySelector(r),callback:(n,o)=>{e(n,o)},timeout:t,frequency:i})},ds=(...e)=>y(void 0,[...e],function*(r={}){return new Promise(t=>{ko(L(A({},r),{callback:(i,s)=>{t({isFound:i,element:s})}}))})});var tc=Rt(Uo());function us({key:r}){let e=G({key:r,type:k.object.type});if(e){let{value:t,expiry:i}=e;if(!i||i<Date.now())Br({key:r});else return t}return null}function Go({key:r,value:e,expiry:t}){ee({key:r,type:k.object,value:{value:e,expiry:t}})}function $l({key:r,value:e}){Go({key:r,value:e,expiry:Date.now()+1e3*60*60})}function jl({key:r,value:e}){Go({key:r,value:e,expiry:Date.now()+1e3*60*15})}function Kl({key:r,value:e}){Go({key:r,value:e,expiry:Date.now()+1e3*60*5})}var ft=class{constructor(){this.slug="fsxs2s"}addToPlacementAsBidder(){return{bidder:this.slug,params:{}}}getSlug(){return this.slug}hasTopLevelStoredRequest(){let{topLevelStoredRequestId:e}=window.freestar.fsdata;return e&&e.length}hasImpLevelStoredRequests(){let{placements:e}=window.freestar.fsdata;return e.filter(t=>t.storedRequestId&&t.storedRequestId.length).length}hasValidStoredRequests(){return this.hasImpLevelStoredRequests()||this.hasTopLevelStoredRequest()}};var Fo=class{static createInstance({ClassConstructor:e,instanceName:t,params:i=[]}){if(window.freestar=window.freestar||{},window.freestar.instances=window.freestar.instances||{},window.freestar.instances[t])return window.freestar.instances[t];let s=new e(...i);return window.freestar.instances[t]=s,s}static getInstanceFn({ClassConstructor:e,instanceName:t,params:i=[]}){return()=>this.createInstance({ClassConstructor:e,instanceName:t,params:i})}},ut=Fo;var Vo=class{constructor(){this.results={},this.ongoingRequests=new Map}clearClassCachedData({requestId:e}){Object.prototype.hasOwnProperty.call(this.results,e)&&delete this.results[e]}fetch(n){return y(this,arguments,function*({fetchFn:e,requestId:t,onError:i,onSuccess:s}){if(this.results[t])return this.results[t];if(!this.ongoingRequests.has(t)){let o=e().then(a=>{let d={data:a,error:null};return this.results[t]=d,s&&s(a),d},a=>{let d={data:null,error:a};return this.results[t]=d,i&&i(a),d});this.ongoingRequests.set(t,o)}return this.ongoingRequests.get(t).finally(()=>{this.ongoingRequests.delete(t)})})}get({requestId:e}){return this.results[e]}},We=ut.getInstanceFn({ClassConstructor:Vo,instanceName:"requestHandler"});var hs="4e799501-b8b6-4ef1-bad5-225b3dd1aa8d",Wl="https://api.floors.dev/sgw/v1/floors";var Ql="https://optimise.net/",Nt="fs.idealadstack.config",ps="session storage",Mt="network request",W=Object.freeze({OFF:"off",CLIENT:"client",SERVER:"server",BOTH:"both"}),ve="default",Jl="refinement";function ii(){return window.freestar.fsdata.domain||location.host}function gs(r){return r.interstitialOptions&&r.interstitialOptions.active&&r.interstitialOptions.type==="GOOGLE_INTERSTITIAL"}var yh=new Set([6010,5958,5891,6125,1498,2109,1825,6214]),bh=new Set([533]);function xt({siteId:r,placement:e}){var t;return(t=e==null?void 0:e.cubeOptions)!=null&&t.active?!0:Lt({siteId:r})||bh.has(r)&&gs(e)}function Lt({siteId:r}){return yh.has(r)}function Th(){return y(this,null,function*(){let r=new URLSearchParams,t=(yield z.instance.resolve(l.USER_INFO_MANAGER)).isKnown;return r.set("k",t),r.set("d",ii()),r.set("t",wh()),freestar.locData&&r.set("c",freestar.locData.iso),B("fsiasdebug")&&r.set("g","experiment"),r.set("r",20),r.toString()})}var Ho=()=>y(void 0,null,function*(){var S,b,g;let e=((b=(S=window.freestar)==null?void 0:S.fsdata)==null?void 0:b.isTriple13Enabled)?"0":"1",t=G({key:rt,type:k.number.type})||0,i=G({key:Ne}),s=G({key:yr}),n=G({key:Dt}),o=n!==null&&!Number.isNaN(Number(n)),a=((g=G({key:sl,type:k.object.type}))==null?void 0:g.altconfig)||!1,d={};Lt({siteId:freestar.fsdata.siteId})||(d["x-api-key"]=hs,d["x-lm"]=e),t===1&&s==="PUBFIG_SETTINGS"?d["x-ab-test-id"]=i:o&&a&&(d["x-test-config-id"]=n),d["timeouts-active"]="true";let c=yield fetch(`${Ql}?${yield Th()}`,{method:"GET",credentials:"include",headers:d}),u=c.headers;c=yield c.text(),c=JSON.parse(c);let{testGroup:f,knownUser:p}=c;return{data:A({testGroup:f,knownUser:p,roundTripTime:u.get("fs-client-rtt")},c.config),source:Mt}}),ms=()=>y(void 0,null,function*(){let r,e=us({key:Nt});return e?r={data:e,source:ps}:r=yield Ho(),r}),wh=()=>{if(window.freestar)return window.freestar.deviceInfo.device.vendor==="Apple"?"smartphone-ios":window.freestar.deviceInfo.device.type};var _s="auctionInit",ri="auctionEnd",Bt="bidResponse",Zl="bidRequested",Es="bidWon";var Xl="bidTimeout",ec="bidRejected";var Rh={title:"IDEAL AD STACK v3.0"};window.freestar=window.freestar||{};var Oe=class Oe{constructor(){this.active=!0,this.config=null,this.configByRtt=null,this.refreshCallback=()=>this.refreshData(),this.refreshingInProgress=!0,this.logs=new Er,this.debugOrTestSession=null,this.allowedBothBidders=null,this.s2sBidders=null,this.bidderSummary=null,this.productToConfig=null,this.rttValue=null,this.isRefinementValue=null}init(){return y(this,null,function*(){let e,t,i,s=We().get({requestId:"getIdealData"});if(s)({config:e,source:t,errors:i}=this.parseRequestHandlerResult(s));else{let n=us({key:Nt});n?(e=n,i=[],t=ps):(e={},i=["data not yet available"],t=Mt)}this.logs.add(`Got config from ${t}`),i.length>0&&(this.sendErrorMessage(i),this.logs.add("Config invalid!",JSON.stringify(e))),this.setConfig(e),this.setGlobalTimeout(),this.logs.show(Rh),yield this.asyncInit()})}setConfig(e){this.config=e,this.debugOrTestSession=null,this.allowedBothBidders=null,this.s2sBidders=null,this.bidderSummary=null,this.productToConfig=null,this.rttValue=null,this.isRefinementValue=null}sendErrorMessage(e){z.instance.resolve(l.ANALYTICS).then(t=>{t.track(new $({eventName:"DYNAMIC_AUCTION_TIMEOUT_TEST",eventType:"ERRORS",data:{errors:e.join(", ")}}))})}sessionStoreConfig({config:e}){let t=e==null?void 0:e.floors,i=!Lt({siteId:freestar.fsdata.siteId}),s=e==null?void 0:e.testGroup;i&&(!t&&s!=="experiment"||t!=null&&t.error)?jl({key:Nt,value:e}):i&&(t==null?void 0:t.length)===0?Kl({key:Nt,value:e}):$l({key:Nt,value:e})}asyncInit(){return y(this,null,function*(){let e=yield We().fetch({requestId:"getIdealData",fetchFn:ms}),{config:t,source:i,errors:s}=this.parseRequestHandlerResult(e);i===Mt&&s.length===0&&this.sessionStoreConfig({config:t}),t.knownUser||this.bindEvents(),this.refreshingInProgress=!1})}refreshData(){return y(this,null,function*(){if(this.refreshingInProgress)return;this.refreshingInProgress=!0;let e=yield We().fetch({requestId:"getIdealData",fetchFn:ms}),i=(yield z.instance.resolve(l.USER_INFO_MANAGER)).isKnown;if(!this.parseRequestHandlerResult(e).config.knownUser&&i){We().clearClassCachedData({requestId:"getIdealData"});let s=yield We().fetch({requestId:"getIdealData",fetchFn:Ho}),{config:n,source:o,errors:a}=this.parseRequestHandlerResult(s);o===Mt&&a.length===0&&(this.sessionStoreConfig({config:n}),window.freestar.queue.push(()=>{window.fsprebid.offEvent(ri,this.refreshCallback)}))}this.refreshingInProgress=!1})}bindEvents(){!window.freestar||!window.freestar.queue||window.freestar.queue.push(()=>{window.fsprebid.onEvent(ri,this.refreshCallback)})}parseRequestHandlerResult(e){let t,i,s,{data:n,error:o}=e;return o?(t={},s=[o.toString()]):({data:t,source:i}=n,i===Mt?s=this.getErrors(t):s=[]),{config:t,source:i,errors:s}}getAllowedBothBidderOverrides({clientServer:e={}}){let t=[],i=this.getAllowedBothBidders();return Object.entries(e).forEach(([s,n])=>{n===W.BOTH&&!i.includes(s)&&t.push(s)}),t}getConfig(e){e=e||"display";let t=A({},this.getConfigForProduct(e));t.clientServer||(t.clientServer={}),t.clientServer=A({},this.applyTestSessionOverride(t.clientServer));let i=this.getAllowedBothBidderOverrides({clientServer:t.clientServer});return i.length>0&&(delete t.clientServerMask,i.forEach(s=>{delete t.clientServer[s]})),t}getAllowedBothBidders(){return this.allowedBothBidders||(this.allowedBothBidders=this._buildAllowedBothBidders()),this.allowedBothBidders}_buildAllowedBothBidders(){var e;return(((e=freestar.fsdata)==null?void 0:e.networks)||[]).filter(t=>t.allowConcurrent&&(!t.distinctParamsRequired||t.sizes.some(i=>i.serverParams))).map(t=>t.slug)}applyTestSessionOverride(e){if(!this.isDebugOrTestSession())return e;let t=A({},e);return Object.keys(t).forEach(i=>{var n,o,a;let s=((a=(o=(n=window==null?void 0:window.freestar)==null?void 0:n.fsdata)==null?void 0:o.networks)==null?void 0:a.find(d=>d.slug===i))||null;s&&t[i]!==W.OFF&&(s.isClient?t[i]=W.CLIENT:s.isPrebidServer?t[i]=W.SERVER:s.isClientAndServer&&(t[i]=W.BOTH))}),t}getServerToServerDetails(){if(!this.active)return{};let{testGroup:e}=this.config,{clientServerMask:t}=this.getConfig();return{clientServerMask:t,testGroup:e}}getDynamicAuctionTimeoutDetails(){let{maxTimeout:e=window.freestar.fsdata.timeout,roundTripTime:t=null}=this.config;return{maxTimeout:e,roundTripTime:t}}getMaxAuctionTimeout(){let{maxTimeout:e}=this.getDynamicAuctionTimeoutDetails();return e}setGlobalTimeout(){let e=this.getMaxAuctionTimeout()||3e3;window.freestar.fsdata.timeout=e,window.freestar.fsdata.mobileTimeout=e}getErrors(e){let t=[];return Object.keys(e).length===0?t.push("no params"):typeof e.maxTimeout=="undefined"&&t.push("no maxTimeout"),t}getFloorsData(){return y(this,null,function*(){let e=yield We().fetch({requestId:"getIdealData",fetchFn:ms}),{config:t}=this.parseRequestHandlerResult(e);return t&&t.floors})}getBypassFirstAuction(){var e;return((e=this==null?void 0:this.config)==null?void 0:e.preGAMAuction)==="off"}getFeatureConfig(){return this.config&&this.config.features||{}}allowBrowsi(){return this.getFeatureConfig().browsi!=="off"}allowConfiant(){return this.getFeatureConfig().confiant!=="off"}allowBlockthrough(){return this.getFeatureConfig().blockthrough!=="off"}isRebidAllowed(){return this.getFeatureConfig().rebid!=="off"}isGAMEnabled(){return this.getFeatureConfig().gam!=="off"}getS2sBidders(e){return this.s2sBidders||(this.s2sBidders=this._buildS2sBidders(e)),this.s2sBidders}_buildS2sBidders(e=new ft){let t=this.getBidderSummary(),i=Object.keys(t).filter(s=>["server","both"].includes(t[s]));return!i.length&&(e!=null&&e.hasValidStoredRequests())&&i.push(e.getSlug()),i}static networkBidderBehaviour(e){var t,i,s;return e!=null&&e.isPrebidServer?W.SERVER:e!=null&&e.isClientAndServer?W.BOTH:(t=freestar.networkMap[e==null?void 0:e.id])!=null&&t.prebidServerEnabled&&(!((i=freestar.networkMap[e==null?void 0:e.id])!=null&&i.prebidClientEnabled)||(s=freestar.networkMap[e==null?void 0:e.id])!=null&&s.prebidServerDefault)?W.SERVER:W.CLIENT}static addBidderBehaviour(e,t){let i=Oe.bitWiseBidderBehaviourMask.indexOf(e||W.OFF),s=Oe.bitWiseBidderBehaviourMask.indexOf(t||W.OFF);return Oe.bitWiseBidderBehaviourMask[i|s]}static addClientServer(e,t){let i=A({},e);return Object.entries(t).forEach(([s,n])=>{i[s]?i[s]=Oe.addBidderBehaviour(i[s],n):i[s]=n}),i}getBidderSummary(){return this.bidderSummary||(this.bidderSummary=this._buildBidderSummary()),this.bidderSummary}_buildBidderSummary(){let e=this.getSiteBidderSummary();return Object.values(this.getProductToConfigMap()).map(s=>s.clientServer).reduce(Oe.addClientServer,e)}getSiteBidderSummary(){return Object.fromEntries(window.freestar.fsdata.networks.map(t=>[t.slug,Oe.networkBidderBehaviour(t)]))}getConfigForProduct(e){let t=this.getProductToConfigMap();return t[e]||t[ve]}getProductToConfigMap(){return this.productToConfig==null&&(this.productToConfig=this._buildProductToConfigMap()),this.productToConfig}getRtt(){if(this.rttValue==null&&(this.rttValue=1/0,this.config.roundTripTime!=null)){let e=Number(this.config.roundTripTime);!Number.isNaN(e)&&e!=null&&(this.rttValue=e)}return this.rttValue}isRefinement(){var e,t;return this.isRefinementValue==null&&(this.isRefinementValue=((t=(e=this.config)==null?void 0:e.testGroup)==null?void 0:t.startsWith(Jl))||!1),this.isRefinementValue}addRefinementTargeting(e,t,i){if(!this.isRefinement())return e;let s=Oe.makeTargetingString(t,i);return L(A({},e),{targeting:s})}_buildProductToConfigMap(){if(!Array.isArray(this.config.clientServer))return this._buildProductToConfigMapExperiment();let t={};this.config.clientServer.forEach(n=>{let[[o,{config:a}]]=Object.entries(n);t[o]=this.addRefinementTargeting(a,o)});let i={},s=this.getRtt();return this.config.clientServerRTT.forEach(n=>{let[[o,a]]=Object.entries(n),d=Oe.selectConfigByRtt(a,s);d&&(i[o]=this.addRefinementTargeting(d.config,o,d.rttRange))}),A(A({},t),i)}_buildProductToConfigMapExperiment(){let e=this.getRtt();if(this.config.clientServerRTT&&Array.isArray(this.config.clientServerRTT)){let i=Oe.selectConfigByRtt(this.config.clientServerRTT,e);if(i){let s=this.addRefinementTargeting(i.config,ve,i.rttRange);return{[ve]:s}}}let t=this.addRefinementTargeting(this.config,ve);return{[ve]:t}}static makeTargetingString(e=ve,t=ve){let i=t===ve?ve:t[0];return`ad=${e};rttRange=${i}`}static selectConfigByRtt(e,t){let i;return e.forEach(s=>{let{rttRange:n}=s;(n===ve||t>=n[0]&&t<=n[1])&&(i==null||i.rttRange===ve)&&(i=s)}),i}isS2SDisabled(){return this.getS2sBidders().length===0}allowRefresh(){return this.getFeatureConfig().refresh!=="off"}determineAdRefreshBehavior(){var n,o;let e=!!((o=(n=window.freestar)==null?void 0:n.fsdata)!=null&&o.adRefreshDisabled),t=!this.isGAMEnabled()&&this.isS2SDisabled(),i=this.allowRefresh();return{isRefreshAllowed:!e&&(t||i)}}_getDebugOrTestSession(){let e=B(we.fsdebug),t=B(we.fsaltconfig);return!!(e||t)}isDebugOrTestSession(){return this.debugOrTestSession===null&&(this.debugOrTestSession=this._getDebugOrTestSession()),this.debugOrTestSession}};E(Oe,"bitWiseBidderBehaviourMask",[W.OFF,W.CLIENT,W.SERVER,W.BOTH]);var zi=Oe,j=ut.getInstanceFn({ClassConstructor:zi,instanceName:"idealAdstackManager"});T.object({token:l.WINDOW,value:window});T.object({token:l.FREESTAR,dependencies:[l.WINDOW],factory:({dependencies:{window:r}})=>{var e;return(e=r.freestar)!=null?e:{}}});T.object({token:l.FS_DATA,dependencies:[l.FREESTAR],factory:({dependencies:r})=>{var e,t;return(t=(e=r.freestar)==null?void 0:e.fsdata)!=null?t:{}}});T.object({token:l.DEVICE_INFO,dependencies:[l.FREESTAR],factory:({dependencies:r})=>{var e,t;return(t=(e=r.freestar)==null?void 0:e.deviceInfo)!=null?t:{}}});T.object({token:l.GEO_INFO,dependencies:[l.FREESTAR],factory:({dependencies:r})=>{var e,t;return(t=(e=r.freestar)==null?void 0:e.locData)!=null?t:{}}});T.object({token:l.PAGE,defaultAlias:"page",dependencies:[l.FREESTAR,l.DISPENSARY_DATA],factory:({dependencies:r})=>{let{freestar:e,dispensaryData:t}=r;return{_pageId:null,get pageId(){return this._pageId||this.refreshId(),this._pageId},refreshId(){this._pageId=(0,tc.default)(window.location.href+e.hitTime+(t.fpc||"")).toString()},get url(){if(!e.url)return"";let i=new URL(e.url);return`${i.origin}${i.pathname}`},get pageViewCount(){return Number(sessionStorage.getItem("pageviews")||0)},set pageViewCount(i){sessionStorage.setItem("pageviews",i)}}}});T.object({token:l.PERFORMANCE_LOGGER,dependencies:[l.FREESTAR],factory:({dependencies:r})=>{let{freestar:e}=r;return e.performanceLogger}});T.object({token:l.PREBID_MANAGER,dependencies:[{token:l.WINDOW,alias:"win"}],factory:({dependencies:r})=>{var i,s;let e,t=new Promise(n=>{e=n});return r.win.fsprebid=(i=r.win.fsprebid)!=null?i:{},r.win.fsprebid.que=(s=r.win.fsprebid.que)!=null?s:[],r.win.fsprebid.que.push(()=>{e()}),{get instance(){return r.win.fsprebid},get ready(){return t}}}});T.object({token:l.IDEAL_AD_STACK_MANAGER,defaultAlias:"idealAdStackManager",factory:()=>j()});T.object({token:l.USER_INFO_MANAGER,dependencies:[l.FREESTAR,l.WINDOW],factory:({dependencies:r})=>{let{freestar:e}=r,t=e.userInfoManager;return delete e.userInfoManager,t}});var Is=class{constructor({context:e,events:t=[]}){E(this,"_events",[]);this._context=e,t.forEach(i=>this.addEvent(i))}addEvent(e){this._events.push(e)}getJSON(){let e=this._events.reduce((t,i)=>{var s;return t[i.type]=(s=t[i.type])!=null?s:[],t[i.type].push(i.payload),t},{});return A(A({},this._context),e)}get size(){return this._events.length}};function ic({placementName:r,slotId:e}){!r||!e||(freestar.dynamicSlotLibrary||(freestar.dynamicSlotLibrary={}),freestar.dynamicSlotLibrary[e]=r)}function Ss({slotId:r}){function e(){let t=Z({name:r});return t&&t.name?t.name:"unknown"}return r?freestar.dynamicSlotLibrary&&freestar.dynamicSlotLibrary[r]?freestar.dynamicSlotLibrary[r]:(freestar.dynamicSlotLibrary&&!freestar.dynamicSlotLibrary[r],e()):"unknown"}function rc({placementName:r,path:e}){!r||!e||(window.freestar.dynamicPathLibrary||(freestar.dynamicPathLibrary=[]),window.freestar.dynamicPathLibrary.push({placementName:r,path:e}))}function As({path:r}){return r?window.freestar.dynamicPathLibrary.find(e=>e.path===r):"unknown"}function Yi({placementName:r,slotId:e,path:t}){e&&ic({placementName:r,slotId:e}),t&&rc({placementName:r,path:t})}function ie({slotId:r=null,path:e=null}){return r?Ss({slotId:r}):e?As({path:e}):!1}var qo=({bidder:r,adUnitCode:e,testData:t},i)=>{t&&(freestar=t.freestar);let s=a(e),n=Nr(s)?s:void 0;function o(){let d=Z({name:ie({slotId:e})});return!d&&freestar.dynamicSlotLibrary[e]&&fsdata.placements[freestar.dynamicSlotLibrary[e]]&&(d=freestar.fsdata.placements[freestar.dynamicSlotLibrary[e]]),d}function a(){let d=o(e);return d&&d.outOfPage==!0?-1:d&&d.adRefreshRate&&d.adRefreshRate>0?d.adRefreshRate:freestar.fsdata.adRefreshRate&&freestar.fsdata.adRefreshRate>0?freestar.fsdata.adRefreshRate:0}return s&&n&&i&&n>0&&i.time>n&&(freestar.refreshLibrary[e]||(freestar.refreshLibrary[e]={}),freestar.refreshLibrary[e].refreshTime=i.time,n=i.time,freestar.log(10,`Set Refresh Rate: ${r} won. Changing refresh rate to ${i.time} due to ${i.rule}`)),n};var vh=Function.prototype.toString,zo=Object.create,Oh=Object.prototype.toString,Ch=function(){function r(){this._keys=[],this._values=[]}return r.prototype.has=function(e){return!!~this._keys.indexOf(e)},r.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},r.prototype.set=function(e,t){this._keys.push(e),this._values.push(t)},r}();function Dh(){return new Ch}function Ph(){return new WeakMap}var Nh=typeof WeakMap!="undefined"?Ph:Dh;function $o(r){if(!r)return zo(null);var e=r.constructor;if(e===Object)return r===Object.prototype?{}:zo(r);if(e&&~vh.call(e).indexOf("[native code]"))try{return new e}catch(t){}return zo(r)}function Mh(r){var e="";return r.global&&(e+="g"),r.ignoreCase&&(e+="i"),r.multiline&&(e+="m"),r.unicode&&(e+="u"),r.sticky&&(e+="y"),e}function xh(r){return r.flags}var Lh=/test/g.flags==="g"?xh:Mh;function sc(r){var e=Oh.call(r);return e.substring(8,e.length-1)}function Bh(r){return r[Symbol.toStringTag]||sc(r)}var kh=typeof Symbol!="undefined"?Bh:sc,Uh=Object.defineProperty,Gh=Object.getOwnPropertyDescriptor,nc=Object.getOwnPropertyNames,jo=Object.getOwnPropertySymbols,oc=Object.prototype,ac=oc.hasOwnProperty,Fh=oc.propertyIsEnumerable,dc=typeof jo=="function";function Vh(r){return nc(r).concat(jo(r))}var Hh=dc?Vh:nc;function bs(r,e,t){for(var i=Hh(r),s=0,n=i.length,o=void 0,a=void 0;s<n;++s)if(o=i[s],!(o==="callee"||o==="caller")){if(a=Gh(r,o),!a){e[o]=t.copier(r[o],t);continue}!a.get&&!a.set&&(a.value=t.copier(a.value,t));try{Uh(e,o,a)}catch(d){e[o]=a.value}}return e}function qh(r,e){var t=new e.Constructor;e.cache.set(r,t);for(var i=0,s=r.length;i<s;++i)t[i]=e.copier(r[i],e);return t}function zh(r,e){var t=new e.Constructor;return e.cache.set(r,t),bs(r,t,e)}function lc(r,e){return r.slice(0)}function Yh(r,e){return r.slice(0,r.size,r.type)}function $h(r,e){return new e.Constructor(lc(r.buffer))}function jh(r,e){return new e.Constructor(r.getTime())}function cc(r,e){var t=new e.Constructor;return e.cache.set(r,t),r.forEach(function(i,s){t.set(s,e.copier(i,e))}),t}function Kh(r,e){return bs(r,cc(r,e),e)}function Wh(r,e){var t=$o(e.prototype);e.cache.set(r,t);for(var i in r)ac.call(r,i)&&(t[i]=e.copier(r[i],e));return t}function Qh(r,e){var t=$o(e.prototype);e.cache.set(r,t);for(var i in r)ac.call(r,i)&&(t[i]=e.copier(r[i],e));for(var s=jo(r),n=0,o=s.length,a=void 0;n<o;++n)a=s[n],Fh.call(r,a)&&(t[a]=e.copier(r[a],e));return t}var Jh=dc?Qh:Wh;function Zh(r,e){var t=$o(e.prototype);return e.cache.set(r,t),bs(r,t,e)}function Yo(r,e){return new e.Constructor(r.valueOf())}function Xh(r,e){var t=new e.Constructor(r.source,Lh(r));return t.lastIndex=r.lastIndex,t}function ys(r,e){return r}function fc(r,e){var t=new e.Constructor;return e.cache.set(r,t),r.forEach(function(i){t.add(e.copier(i,e))}),t}function ep(r,e){return bs(r,fc(r,e),e)}var tp=Array.isArray,Ko=Object.assign,ip=Object.getPrototypeOf||function(r){return r.__proto__},uc={array:qh,arrayBuffer:lc,blob:Yh,dataView:$h,date:jh,error:ys,map:cc,object:Jh,regExp:Xh,set:fc},rp=Ko({},uc,{array:zh,map:Kh,object:Zh,set:ep});function sp(r){return{Arguments:r.object,Array:r.array,ArrayBuffer:r.arrayBuffer,Blob:r.blob,Boolean:Yo,DataView:r.dataView,Date:r.date,Error:r.error,Float32Array:r.arrayBuffer,Float64Array:r.arrayBuffer,Int8Array:r.arrayBuffer,Int16Array:r.arrayBuffer,Int32Array:r.arrayBuffer,Map:r.map,Number:Yo,Object:r.object,Promise:ys,RegExp:r.regExp,Set:r.set,String:Yo,WeakMap:ys,WeakSet:ys,Uint8Array:r.arrayBuffer,Uint8ClampedArray:r.arrayBuffer,Uint16Array:r.arrayBuffer,Uint32Array:r.arrayBuffer,Uint64Array:r.arrayBuffer}}function hc(r){var e=Ko({},uc,r),t=sp(e),i=t.Array,s=t.Object;function n(o,a){if(a.prototype=a.Constructor=void 0,!o||typeof o!="object")return o;if(a.cache.has(o))return a.cache.get(o);if(a.prototype=ip(o),a.Constructor=a.prototype&&a.prototype.constructor,!a.Constructor||a.Constructor===Object)return s(o,a);if(tp(o))return i(o,a);var d=t[kh(o)];return d?d(o,a):typeof o.then=="function"?o:s(o,a)}return function(a){return n(a,{Constructor:void 0,cache:Nh(),copier:n,prototype:void 0})}}function np(r){return hc(Ko({},rp,r))}var hI=np({}),Qe=hc({});var re={DYNAMIC_AD_OPTIONS:"dynamicAdOptions",DYNAMIC_AD_OPTIONS_V2:"dynamicAdOptionsV2",PUSHDOWN_OPTIONS:"pushdownOptions",SIDE_WALL_OPTIONS:"sideWallOptions",CUBE_OPTIONS:"cubeOptions",CAROUSEL_OPTIONS:"carouselOptions",SLIDING_UNIT_OPTIONS:"slidingUnitOptions",STICKY_AD_OPTIONS:"stickyAdOptions",STICKY_FOOTER_OPTIONS:"stickyFooterOptions"};var kt=({placement:r,type:e})=>{let t=r==null?void 0:r[e];if(!t)return!1;if(t.active!=null&&t.active!==!1)return!0;switch(e){case re.DYNAMIC_AD_OPTIONS_V2:return!!t.dynamicAd2;case re.PUSHDOWN_OPTIONS:return!!t.isPushdownUnit;case re.SIDE_WALL_OPTIONS:return t.type!==0;case re.STICKY_AD_OPTIONS:return!!t.stickyAdEnabled;case re.STICKY_FOOTER_OPTIONS:return Object.keys(t).length>0&&t.active!==!1;default:return!1}},pc=({placement:r,type:e})=>kt({placement:r,type:e})?r[e]:{};var Ts=(r=window.freestar.config,e=window.freestar.fsdata)=>typeof r.pageSpeedOptimized!="undefined"?r.pageSpeedOptimized:e.pageSpeedOptimized;var Wo="fs.exclude.bidders",ws={key:Wo,type:k.array.type};function gc(){var r,e;if(freestar.fsdata.adQualityOptions.vendor)return freestar.deviceInfo.device.type===qi&&((r=freestar.fsdata.adQualityOptions)!=null&&r.desktopEnabled)||(e=freestar.fsdata.adQualityOptions)!=null&&e.mobileEnabled?freestar.fsdata.adQualityOptions.vendor:null;switch(freestar.deviceInfo.device.type){case qi:return freestar.fsdata.adQualityDesktopVendor;case Ve:return freestar.fsdata.adQualityMobileVendor;default:return null}}function Rs(){return G(ws)}function vs({network:r,adQualityBlockList:e}){return Pr({value:e})?!e.includes(r.slug):!0}var op="FsClientAux",Qo={},mc={},ap={appnexus:32,openx:69,pulsepoint:81,sonobi:104,gumgum:61,rubicon:52,pubmatic:76,sharethrough:80,criteo:91,justpremium:62,smaato:82,telaria:202,adtelligent:410,ix:10,triplelift:28,quantcast:11,medianet:142,unruly:36,undertone:677,nativo:263,teads:132,kargo:972,connectad:138,oftmedia:32,blockthrough:815,yieldmo:173,connatix:143,smartadserver:45,yahoossp:25,grid:686,tappx:628,spotx:165,dianomi:885,onetag:241,amx:737,liveintent:148,ttd:21,vidazoo:744,ogury:31,rise:1043,adform:50,aniview:780,insticator:910,seedtag:157,OperaAds:1135,minutemedia:918,cadent:183,yahooAds:25};function dp(r){return{gvlid:ap[r],useBaseGvlid:!0}}function Os(r){let e=X(r);if(!Qo[e]){let t=`${e}${op}`;Qo[e]=t,mc[t]=e,fsprebid.que.push(()=>void fsprebid.aliasBidder(e,t,dp(e)))}return Qo[e]}function X(r){return mc[r]||r}var Zo=class r{constructor(){this.slotMaxBids={},this.slotToPlacement={},this.placementToSlots={}}initiateWatcher(e){e.que.push(()=>{e.onEvent(Bt,this.handleBidResponse.bind(this))})}handleBidResponse(e){this.addSlotPlacementAssociation(e.adUnitCode),this.addBidResponse(e)}addSlotPlacementAssociation(e){if(e&&!this.slotToPlacement[e]){let t=ie({slotId:e});t&&(this.slotToPlacement[e]=t,this.placementToSlots[t]||(this.placementToSlots[t]=[]),this.placementToSlots[t].push(e))}}addBidResponse(e){let{adUnitCode:t,cpm:i}=e;t&&i&&(!this.slotMaxBids[t]||this.slotMaxBids[t]<i)&&(this.slotMaxBids[t]=i)}getSlotMaxBid(e){return r.validateMaxBid(this.slotMaxBids[e])}getPlacementMaxBidBySlot(e){let t=this.slotToPlacement[e];return this.getPlacementMaxBid(t)}getPlacementMaxBid(e){let t=this.placementToSlots[e]||[];return r.validateMaxBid(Math.max(...t.map(i=>this.getSlotMaxBid(i))))}static validateMaxBid(e){return!Number.isNaN(e)&&e!=null&&e>0?e:null}},Jo=null;function _c(){return Jo==null&&(Jo=new Zo),Jo}function Xo(o){return y(this,arguments,function*({deviceVendor:r,deviceType:e,refreshNumber:t,placement:i,maxBid:s,isFloorsActive:n}){let a=ii(),d=r==="Apple"?"smartphone-ios":e,u=(yield z.instance.resolve(l.USER_INFO_MANAGER)).isKnown,f=i&&s!=null?`&mb=${s}&au=${encodeURIComponent(i)}`:"",p=freestar.locData?freestar.locData.iso:"",h=n?"0":"1",m=`d=${a}&t=${d}&k=${u}&r=${t}${f}&c=${p}`,S=`${Wl}?${m}`,g=yield fetch(S,{headers:{"x-api-key":hs,"x-lm":h}});if(!g.ok)throw new Error(`Request failed with status ${g.status}`);return g.json()})}var ht=class ht{constructor(e,t){this.idealAdStackManager=e,this.maxBidTracker=t,this.initialData=null,this.requests=[],this.maxBidRequests={},this.failedRequestCount=0,this.throttleRequests=!1,this.throttleExpiry=0}getInitialFloorsData(){return y(this,null,function*(){if(Lt({siteId:freestar.fsdata.siteId}))return this.initialData={timestamp:new Date,floors:[]};let e=0,{timestamp:t,floors:i}=this.getRequest(e);return this.initialData?yield i:this.initialData={timestamp:t,floors:yield i},this.initialData})}getRequest(e,t,i){if(this.shouldThrottleRequests()){let n=t&&i!=null?`, placement ${t}, maxBid ${i}`:"";return freestar.log({level:20,title:"Floors"},`Floors throttled: fetch skipped for refresh ${e}${n}`),{timestamp:new Date,floors:Promise.resolve([])}}if((pt()?t==null?void 0:t.customTargetingPlacementName:t)&&i!=null){if(this.maxBidRequests[t.name]||(this.maxBidRequests[t.name]=[null]),this.maxBidRequests[t.name][e]||(this.maxBidRequests[t.name][e]={}),!this.maxBidRequests[t.name][e][i]){let n=pt()?t.customTargetingPlacementName:t.dfpId;this.maxBidRequests[t.name][e][i]={timestamp:new Date,floors:this.fetchData(e,n,i)}}return this.maxBidRequests[t.name][e][i]}return this.requests[e]||(this.requests[e]={timestamp:new Date,floors:this.fetchData(e)}),this.requests[e]}reportError(e){freestar.log({level:40,title:"Floors"},"Floors error",e),z.instance.resolve(l.ANALYTICS).then(t=>{t.track(new $({eventName:"FLOORS_ERROR",eventType:"FETCH_RESPONSE",data:{message:e}}))})}fetchInitialData(){return y(this,null,function*(){let t=yield this.idealAdStackManager().getFloorsData();if(t)return!t.error&&t.length>0?t:(t!=null&&t.error&&(t!=null&&t.message)&&this.reportError(t.message),this.startThrottle(),[]);let{data:i,error:s}=yield We().fetch({requestId:"getFloorsData",fetchFn:()=>{var n,o;return Xo({deviceVendor:window.freestar.deviceInfo.device.vendor,deviceType:window.freestar.deviceInfo.device.type,refreshNumber:0,isFloorsActive:(o=(n=window.freestar)==null?void 0:n.fsdata)==null?void 0:o.isTriple13Enabled})}});if(s)this.reportError(s.toString());else{if(i&&!i.error&&i.length>0)return i;i!=null&&i.error&&(i!=null&&i.message)&&this.reportError(i.message)}return this.startThrottle(),[]})}countRequestFailed(){this.failedRequestCount+=1,this.failedRequestCount>=ht.MAX_FAILED_REQUESTS&&this.startThrottle()}startThrottle(){this.throttleRequests=!0,this.throttleExpiry=Date.now()+ht.FAILED_REQUEST_TIMEOUT}countRequestSucceeded(){this.failedRequestCount=0,this.throttleRequests=!1}shouldThrottleRequests(){return this.throttleRequests&&Date.now()>this.throttleExpiry?(this.startThrottle(),!1):this.throttleRequests}fetchData(e,t,i){return y(this,null,function*(){var o,a;if(e===0)return yield this.fetchInitialData();let s,n;try{s=yield Xo({deviceVendor:window.freestar.deviceInfo.device.vendor,deviceType:window.freestar.deviceInfo.device.type,refreshNumber:e,placement:t,maxBid:i,isFloorsActive:(a=(o=window.freestar)==null?void 0:o.fsdata)==null?void 0:a.isTriple13Enabled})}catch(d){n=d}if(n)this.reportError(n.toString());else{if(s&&!s.error&&s.length>0)return this.countRequestSucceeded(),s;s!=null&&s.error&&(s!=null&&s.message)&&this.reportError(s.message)}return this.countRequestFailed(),[]})}getFloor(e,t,i){let s=pt()?i.customTargetingPlacementName:i.dfpId,n=t.find(c=>s===c.adUnit),o=n?n.upr:"timeout",a=n?new Date(n.lastUpdated):e,d=String(a.getUTCHours());return{floors_id:o,floors_hour:d}}getInitialFloorKVP({placement:e,keyMap:t}){t||(t={});let s=(pt()?e==null?void 0:e.customTargetingPlacementName:e)?this.getFloor(this.initialData.timestamp,this.initialData.floors,e):{};return Object.assign(t,s)}getFloorsData(n){return y(this,arguments,function*({placement:e,slotId:t,callback:i,isRebid:s=!1}){let o,a;if(xt({siteId:freestar.fsdata.siteId,placement:e})||Ut(e))return o=null,a="inactive",void i({result:o,reason:a});let c=(yield z.instance.resolve(l.REFRESH_LIBRARY)).getRefreshLibraryItem({slotId:t}),u=((c==null?void 0:c.timesRefreshed)||0)+(s?1:0),f,p;if(u===0||s)({timestamp:f,floors:p}=this.getRequest(u));else{let h=this.maxBidTracker.getSlotMaxBid(t),m=ht.formatMaxBid(h);({timestamp:f,floors:p}=this.getRequest(u,e,m))}o=this.getFloor(f,yield p,e),a=null,i&&i({result:o,reason:a})})}prefetchFloorsData({placement:e,slotId:t,timesRefreshed:i}){let s=this.maxBidTracker.getSlotMaxBid(t),n=ht.formatMaxBid(s);this.getRequest(i,e,n)}static formatMaxBid(e){if(e!=null){let t=e.toString();if(t){if(t.includes("e-"))return"0";if(t.includes("e"))return e.toPrecision(3);let i=e.toString().match(/^-?\d*(?:\.\d{0,2})?/);if(i){let s=i[0];for(;s.includes(".")&&(s.endsWith("0")||s.endsWith("."));)s=s.slice(0,-1);return s}}}return null}};E(ht,"MAX_FAILED_REQUESTS",2),E(ht,"FAILED_REQUEST_TIMEOUT",1e3*60*15);var ea=ht,gt=ut.getInstanceFn({ClassConstructor:ea,instanceName:"floorsManager",params:[j,_c()]});function lp(r,e){let t={};return window.freestar.config.targeting&&Array.isArray(window.freestar.config.targeting)&&(t=window.freestar.config.targeting.find(function(i){return Object.keys(i).includes(e)})),t&&(r=A(A({},r),t[e])),r}function $i(r,e=null,t=null){try{let i=lp(t,e);if(i)for(let s in i)r.setTargeting(s,i[s])}catch(i){freestar.log(49,"ERROR:","slotTargeting",...arguments),freestar.log(49,"ERROR:","slotTargeting",i)}}var cp=function({name:r,win:e=window}){var t;return(t=e.freestar.config.products[r])!=null&&t.disabled?(e.freestar.log(1,`${Ci[r].prettyName} Disabled via freestar.config.products.${r}.disabled`),!0):!1},Cs=cp;var fp=(r,e)=>!!(r!=null&&r[e])&&kt({placement:r,type:e}),ue=({type:r,getName:e,isActive:t})=>{if(!r&&typeof t!="function")throw new Error("[createProductStrategy] Either 'type' or 'isActive' function must be provided.");return{type:r,getName:e,isActive:i=>typeof t=="function"?t(i):fp(i,r)}};var Ec=[ue({type:re.PUSHDOWN_OPTIONS,getName:()=>Ds(re.PUSHDOWN_OPTIONS)}),ue({type:re.SIDE_WALL_OPTIONS,getName:()=>Ds(re.SIDE_WALL_OPTIONS)}),ue({type:re.CUBE_OPTIONS,getName:()=>Ds(re.CUBE_OPTIONS)}),ue({type:re.STICKY_FOOTER_OPTIONS,getName:r=>{var e;return(e=r==null?void 0:r.stickyFooterOptions)!=null&&e.video?"stickyFooterVideo":"stickyFooter"}}),ue({type:re.CAROUSEL_OPTIONS,getName:r=>Sc(r)}),L(A({},ue({getName:()=>"video",isActive:r=>{var e,t,i;return!!((e=r==null?void 0:r.standAloneVideoOptions)!=null&&e.active||(t=r==null?void 0:r.connatixOptions)!=null&&t.active||(i=r==null?void 0:r.primisOptions)!=null&&i.active)}})),{disabledCheckNames:["standAloneVideo","primis","connatix"]}),ue({getName:r=>Ac(r)?"IAI-FC":"flyingCarpet",isActive:r=>ta(r)})],Ic=[ue({type:re.DYNAMIC_AD_OPTIONS_V2,getName:()=>"EAI"}),ue({type:re.SLIDING_UNIT_OPTIONS,getName:()=>"slidingStickyAds"}),ue({getName:()=>"slidewall",isActive:r=>!!(r!=null&&r.sideWallOptions&&r.sideWallOptions.type!==0&&r.sideWallOptions.slidewallEnabled)}),ue({getName:()=>"IAI",isActive:r=>{var e,t;return!!((t=(e=r.selectedSize)==null?void 0:e.intelligentAdInsertConfig)!=null&&t.active)}}),ue({getName:()=>"stickyRail",isActive:r=>{var e;return(e=r==null?void 0:r.stickyRailOptions)==null?void 0:e.active}}),ue({getName:()=>"superflex",isActive:r=>!!(r!=null&&r.superflex||r!=null&&r.superflexV2)}),ue({getName:()=>"lazy",isActive:r=>r==null?void 0:r.lazyAd})];function he(r,e=window){if(!r)return"";for(let{isActive:t,getName:i,disabledCheckNames:s}of Ec)if(t(r)){let n=i(r);if((Array.isArray(s)?s:[n]).some(d=>!Cs({name:d,win:e})))return n}return"display"}function Je(r){if(!r)return"";let e=[];for(let{isActive:t,getName:i}of Ic)t(r)&&e.push(i(r));return e.join(", ")||null}function Sc(r){var t;let e=(t=r==null?void 0:r.name)==null?void 0:t.match(/carousel_([a-z])/i);return e?e[0].toLowerCase():""}function Ds(r){return r.replace(/Options.*$/i,"")}var mt="slotRenderEnded",si="slotRequested";var _t="15184186",ia="1966186",K={UUID:"fs_uuid",REFRESH:"fsrefresh",BID:"fsbid",PLACEMENT_NAME:"fs_placementName",REBID:"fsrebid",PRODUCT:"fs_ad_product",PRODUCT_OPTIMIZATION:"fs_ad_optimization",FLOORS_ID:"floors_id",FLOORS_HOUR:"floors_hour",ITF:"fsitf",CDEP:"cdep",FS_SESSION_ID:"fs_session_id",FS_PAGEVIEW_ID:"fs_pageview_id",FS_OPTIMIZATION:"fs_optimization",FS_VERSION:"fs_version",TEST:"test",TEST_GROUP:"tg",BLOCK:"block",REFERRER:"referrer",USER_AGENT:"user-agent",BROWSI_PP:"browsiPP",FLOORS_USER:"floors_user",FLOORS_RTT:"floors_rtt",DAS_TEST_GROUP:"fs_testgroup",DAS_CS_MASK:"fs_clientservermask"};var Ps="NATIVE_RENDER_ENDED",yc="BEFORE_NATIVE_RENDER",Ns="GAM_SLOT_DESTROYED",ni="GAM_SLOT_CREATED",Ms="GAM_ALL_SLOTS_DESTROYED",bc="DEVICE_ORIENTATION_CHANGED",xs="LAZY_AD_INTERSECTED",Tc="AD_INTERSECTED",wc="AD_REFRESH",Rc="AUCTION_START";var Ce=class Ce{constructor(e){var i,s;let t=nt(e==null?void 0:e.defaultLevel)?Q.VERBOSE:e.defaultLevel;this._defaultLevel=Math.max(t||0,Q.SILENT),this._context=(i=e==null?void 0:e.context)!=null?i:"Pubfig",this.id=(s=e==null?void 0:e.id)!=null?s:Ce._instancesCount,Ce._instancesCount+=1,nt(e==null?void 0:e.maxLogsLevel)||Ce.setMaxLogsLevel(Math.max((e==null?void 0:e.maxLogsLevel)||0,Q.SILENT))}static setMaxLogsLevel(e){Ce.maxLogsLevel=e}log(e,t){if(this.maxLogsLevel===Q.SILENT)return;let{level:i=this._defaultLevel}=t!=null?t:{};this.maxLogsLevel>=i&&console.info(...this._getLogArguments(e,t))}error(e,t){console.error(...this._getArguments(e,t==null?void 0:t.context))}warning(e,t){console.warn(...this._getArguments(e,t==null?void 0:t.context))}info(e,t){console.info(...this._getArguments(e,t==null?void 0:t.context))}table(e,t,i){if(this.maxLogsLevel===Q.SILENT)return;let{level:s=this._defaultLevel}=i!=null?i:{};this.maxLogsLevel>=s&&(this.log(e,i),console.table(t))}groupCollapsed(e,t){if(this.maxLogsLevel===Q.SILENT)return;let{level:i=this._defaultLevel}=t!=null?t:{};this.maxLogsLevel>=i&&console.groupCollapsed(...this._getLogArguments(e,t==null?void 0:t.context))}groupEnd(){this.maxLogsLevel!==Q.SILENT&&console.groupEnd()}setLevel(e){this._defaultLevel=e}get maxLogsLevel(){return Ce.maxLogsLevel}setContext(e){this._context=e}createLogger(e,t=this._defaultLevel){return Ce._instancesCount+=1,new Ce({defaultLevel:t,context:e,id:Ce._instancesCount})}_getLogArguments(e,{context:t,styles:i}={}){return[`%c${t!=null?t:this._context}:`,this._getStyles(i),...this._getMessages(e)]}_getStyles(e){return e||`background: hsl(${(150+this.id*30)%360}, 40%, 50%); color: #fff; border-radius: 3px; padding: 3px`}_getMessages(e){return Array.isArray(e)?e:[e]}_getArguments(e,t){let i=Array.isArray(e)?e:[e];return[`${t!=null?t:this._context}: `,...i]}};E(Ce,"_instancesCount",0),E(Ce,"maxLogsLevel",Q.SILENT);var Ls=Ce;T.class(Ls,{token:l.LOGGER,defaultAlias:"logger",injectionMode:tt.FOR_FEATURE,dependencies:[l.CONFIG_MANAGER],factory:({dependencies:{config:r}={}})=>new Ls({maxLogsLevel:r.logLevel})});var oi={INIT:"Init",INIT_COMPLETE:"Init complete",INIT_FAILED:"Init failed"};function ra(){return window.googletag.pubads&&window.googletag.pubads().getSlots()}function sa({elementId:r}){if(r)return ra().filter(e=>e.getSlotElementId()===r)[0]}var na=class{constructor({placement:e=null,prebid:t=null,slot:i=null}){this.placement=e,this.prebid=t,this.slot=i,this.trackedAdIds=new Set,this.states=[],this.renderMap=new Map}update({prebid:e=null,slot:t=null}){e&&(this.prebid=e),t&&(this.slot=t)}getKVPs(){if(!this.slot)return null;let e=this.slot.getTargetingMap(),t=Object.entries(e).flatMap(([s,n])=>n.map(o=>[s,o])),i=googletag.pubads().getTargetingKeys().flatMap(s=>googletag.pubads().getTargeting(s).map(o=>[s,o]));return[...t,...i]}getWinningBid(){if(!this.prebid)return null;let e=fsprebid.getAllWinningBids().find(t=>this.prebid&&t.adUnitCode===this.prebid.code&&!this.trackedAdIds.has(t.adId));return e?(this.trackedAdIds.add(e.adId),e.adId):null}setAUUID({fsAuctionId:e}){var t,i;(i=(t=this.slot)==null?void 0:t.setTargeting)==null||i.call(t,"fs-auuid",e)}getStateByFsAuctionId({fsAuctionId:e}){return this.states.find(t=>t.fsAuctionId===e)||!1}saveState({fsAuctionId:e,auctionType:t,prebidAuctionId:i=null,rebid:s}){this.setAUUID({fsAuctionId:e}),this.states.push({fsAuctionId:e,prebidAuctionId:i,auctionType:t,rebid:s})}isDisplayAd(){return!["stickyFooter","sideWall","pushdown","stickyRail"].some(t=>kt({placement:this.placement,type:`${t}Options`}))}getSlotId(){var e,t,i;return((e=this.prebid)==null?void 0:e.code)||((t=this.slot)==null?void 0:t.getSlotElementId())||((i=this.placement)==null?void 0:i.name)}},oa=class{constructor(){this.adUnits=new Map}add({placement:e=null,prebid:t=null,slot:i=null}){let s=(i==null?void 0:i.getSlotElementId())||(t==null?void 0:t.code);if(s){if(this.adUnits.has(s))this.adUnits.get(s).update({prebid:t,slot:i});else if(e||(e=t?Z({name:Ss({slotId:t.code})}):i?Z({name:As({path:i.getAdUnitPath()}).placementName}):null),e){i=i!=null?i:sa({elementId:s});let n=new na({placement:e,prebid:t,slot:i});this.adUnits.set(s,n)}}}getAdUnitByPlacementName(e){return[...this.adUnits.values()].find(t=>{var i;return((i=t.placement)==null?void 0:i.name)===e})||!1}getAdUnitByPrebidCode(e){return this.adUnits.get(e)||!1}getAdUnitBySlotElementId(e){return Array.from(this.adUnits.values()).find(t=>t.slot&&t.slot.getSlotElementId()===e)||!1}getAdUnitBySlotAdUnitPath(e){return[...this.adUnits.values()].find(t=>{var i;return((i=t.slot)==null?void 0:i.getAdUnitPath())===e})||!1}},te=new oa;window.freestar&&window.freestar.queue&&window.freestar.queue.push(()=>{window.freestar.adUnitManager=te});var Bs=class{constructor(e){this.adSlotId=e.getSlotElementId(),this.size=e.getSizes().map(t=>t==="fluid"?[1,1]:[t.getWidth(),t.getHeight()]),this.adUnitPath=e.getAdUnitPath()}};function vc({slotArray:r}){window.__iasPET.queue=window.__iasPET.queue||[],window.__iasPET.queue.push({adSlots:r,dataHandler:function(){window.__iasPET.setTargetingForGPT()}})}function up(){let r=[];ra().forEach(e=>r.push(new Bs(e))),r.length&&vc({slotArray:r})}function Oc({slot:r=null}){typeof window.__iasPET!="undefined"&&(freestar.log(1,"Publisher SlotOperations IAS: iasPETTargeting found"),r?vc({slotArray:[new Bs(r)]}):up())}function Cc({slot:r=null}){window.moatPrebidApi&&(typeof window.moatPrebidApi.slotDataAvailable=="function"&&window.moatPrebidApi.slotDataAvailable()||typeof window.moatPrebidApi.pageDataAvailable=="function"&&window.moatPrebidApi.pageDataAvailable())&&(freestar.log(1,"Publisher SlotOperations Moat: moatSlotTargetingReady"),r?window.top.moatPrebidApi.setMoatTargetingForSlot(r):window.moatPrebidApi.setMoatTargetingForAllSlots())}function Dc({slot:r=null}){Oc({slot:r}),Cc({slot:r})}var ks=class{constructor({logger:e,dispensaryData:t,eventBus:i,sessionStorageManager:s,adUnitManager:n,floorsManager:o,idealAdStackManager:a,freestar:d,userInfoManager:c,page:u,win:f=window}){this._window=f,this._logger=e,this._dispensaryData=t,this._eventBus=i,this._page=u,this._adUnitManager=n,this._floorsManager=o,this._idealAdStackManager=a,this._userInfoManager=c,this._freestar=d,this._sessionStorageManager=s,this._instance=null,this.googletagCorrelatorUpdate=!0,this.gamMap={},this._logger.setContext("GamManager"),this._logger.setLevel(Q.CORE)}init(){return new Promise(e=>{this._logger.log(oi.INIT),this._window.googletag=this._window.googletag||{},this._window.googletag.cmd=this._window.googletag.cmd||[],this._window.googletag.cmd.push(()=>{var a,d,c;this._instance=this._window.googletag,this.instance.pubads().disableInitialLoad();let{altUrl:t}=(a=this._dispensaryData.envAndConfig)!=null?a:{},{collapseEmptyDivs:i,disableSingleRequest:s}=this._dispensaryData.fsdata;t&&this.instance.pubads().set("page_url",t),i&&(this._logger.log("GAM Option set to collapseEmptyDivs(true)"),this.instance.pubads().collapseEmptyDivs(!0)),s||this.instance.pubads().enableSingleRequest(),this._setInitialTargeting();let{ppid:n=(d=freestar==null?void 0:freestar.msg)==null?void 0:d.fpc,setNonPersonalizedAds:o}=(c=this._freestar.config)!=null?c:{};o&&this.instance.pubads().setRequestNonPersonalizedAds(1),n&&(typeof n=="string"?this.instance.pubads().setPublisherProvidedId(n):this._logger.warning("freestar.config.ppid is not a string and will not be set")),this.instance.enableServices(),this._logger.log(oi.INIT_COMPLETE),e(this)})})}get instance(){if(!this._instance)throw new Error("GamManager must be initiated first.");return this._instance}setGlobalTargeting(e,t){var i,s;(s=(i=this.instance)==null?void 0:i.pubads())==null||s.setTargeting(e,t)}setTargeting({slot:e,key:t,value:i}){e!=null&&e.setTargeting&&t&&i&&e.setTargeting(t,i)}getSlots(){var e,t;return(t=(e=this.instance)==null?void 0:e.pubads())==null?void 0:t.getSlots()}getSlot({elementId:e}={}){return e?this.getSlots().find(t=>t.getSlotElementId()===e):null}destroySlot({elementId:e}){let t=this.getSlot({elementId:e});t&&(this.instance.destroySlots([t]),this._eventBus.emit(Ns,{elementId:e}))}isValidDfPId({specialDfpId:e,dfpId:t}){return!!e||!t.includes("{{channel}}")}defineOutOfPageSlot({dfpId:e,elementId:t}){return this.instance.defineOutOfPageSlot(e,t).addService(this.instance.pubads())}get isFsGam(){let{placements:e=[]}=this._dispensaryData.fsdata;return e.some(t=>t.dfpId.includes(_t))}get isFsDevGam(){let{placements:e}=this._dispensaryData.fsdata;return e.some(t=>t.dfpId.includes(ia))}setGamMapping({id:e,placement:t}){!e||!t||this.gamMap[e]||(this.gamMap[e]=t.dfpId.includes(`/${_t}/`))}createSlot({placement:e,sizes:t,id:i=null,specialDfpId:s=null,slotConfig:n}){if(!e)return this._logger.log("No placement provided. Aborting."),null;if(!t&&(t=aa(e,this._window),!t))return this._logger.log("No sizes found at this resolution. Aborting."),null;i||(i=e.name);let{outOfPage:o,dfpId:a,fluidAd:d}=e,c=this.getSlot({elementId:i}),u=this.isValidDfPId({specialDfpId:s,dfpId:a});if(u||console.warn(`Ad slot ${a} requires a channel variable but no channel is defined`),c||(o?u&&i&&(c=this.defineOutOfPageSlot({dfpId:s||a,elementId:i})):(d&&!t.includes("fluid")&&t.push("fluid"),u&&(c=this.instance.defineSlot(s||a,t,i).addService(this.instance.pubads())))),c){let{siteId:f}=this._dispensaryData.fsdata;this.instance.enableServices(),this.setGamMapping({id:i,placement:e});let p=[],h={[K.REFRESH]:"0",[K.REBID]:"0",[K.UUID]:de()};!xt({siteId:f,placement:e})&&!Ut(e,this._dispensaryData.fsdata)&&(h=this._floorsManager.getInitialFloorKVP({placement:e,keyMap:h})),Object.entries(h).forEach(([g,_])=>{p.push({key:g,value:_})});let m=pt()?e==null?void 0:e.customTargetingPlacementName:e==null?void 0:e.name;m&&p.push({key:K.PLACEMENT_NAME,value:m});let S=he(e,this._window);if(p.push({key:K.PRODUCT,value:S}),!this._idealAdStackManager.isDebugOrTestSession()){let g=this._idealAdStackManager.getConfig(S);g!=null&&g.clientServerMask&&p.push({key:K.DAS_CS_MASK,value:g.clientServerMask});let{testGroup:_}=this._idealAdStackManager.getServerToServerDetails();if(_){let M=this._idealAdStackManager.isRefinement()?`${_}${g.targeting}`:_;p.push({key:K.DAS_TEST_GROUP,value:M})}}if(p.push({key:K.PRODUCT_OPTIMIZATION,value:Je(e)}),n!=null&&n.targeting)for(let g in n.targeting)Object.prototype.hasOwnProperty.call(n.targeting,g)&&p.push({key:g,value:n.targeting[g]});p.forEach(({key:g,value:_})=>{g&&!nt(_)&&c.setTargeting(g,_)});let b=localStorage.getItem("brw.prf");return b&&c.setTargeting(K.BROWSI_PP,b),Dc({slot:c}),Yi({placementName:e.name,slotId:i,path:s||a}),this._adUnitManager.add({placement:e,slot:c}),this._eventBus.emit(ni,{elementId:i}),c}return null}refreshWithCorrelatorControl(e){this.googletagCorrelatorUpdate?(this.instance.pubads().refresh(e),this.googletagCorrelatorUpdate=!1):this.instance.pubads().refresh(e,{changeCorrelator:!1})}logTargeting(e){if(this._logger.maxLogsLevel<50)return;this._logger.groupCollapsed("GPT Targeting");let t=25,i=this.instance.pubads().getTargetingKeys(),s=[];for(let n of i){let o=this.instance.pubads().getTargeting(n);s.push({Key:n,Value:o.join()})}s.length>0&&this._logger.table("GPT Site Level Targeting",s,{level:t}),e?Array.isArray(e)||(e=[e]):e=this.getSlots();for(let n of e){let o=[],a=n.getSlotElementId();i=n.getTargetingKeys();for(let d of i){let c=n.getTargeting(d);o.push({Key:d,Value:c.join()})}o.length>0&&this._logger.table(`GPT Slot (${a}) Targeting`,o,{level:t})}this._logger.groupEnd()}setCoppa(e){this.instance.pubads().setPrivacySettings({childDirectedTreatment:e})}_setInitialTargeting(){let e=G({key:rt});e&&this.setGlobalTargeting(K.TEST_GROUP,e);let t=this._sessionStorageManager.getSessionId(),{pageId:i}=this._page,{cdep:s}=this._dispensaryData;s&&this.setGlobalTargeting(K.CDEP,s),this.setGlobalTargeting(K.FS_SESSION_ID,t),this.setGlobalTargeting(K.FS_PAGEVIEW_ID,i),this.setGlobalTargeting(K.FS_VERSION,Ar),Ts(this._freestar.config,this._dispensaryData.fsdata)&&this.setGlobalTargeting(K.FS_OPTIMIZATION,"true");let n=B("dfpkey",this._window);n&&this.setGlobalTargeting(K.TEST,n),B("block",this._window)==="fsdirect"&&this.setGlobalTargeting(K.BLOCK,"fsdirect"),this._window.document.referrer.search(/facebook/i)>=0?this.setGlobalTargeting(K.REFERRER,"facebook"):(this._window.document.referrer.search(/twitter/i)>=0||this._window.document.referrer.search(/t.co/i)>=0)&&this.setGlobalTargeting(K.REFERRER,"twitter");let a={facebook:[/facebook/i,/facebot/i,/FB_IAB/i,/FBAN/i,/FBAV/i],twitter:[/Twitter/i],[this._userInfoManager.userAgent]:null};for(let[d,c]of Object.entries(a))if(!c||c.some(u=>this._window.navigator.userAgent.search(u)>=0)){this.setGlobalTargeting(K.USER_AGENT,d);break}Ti.forEach(d=>{let c=B(d,this._window);c&&this.setGlobalTargeting(d,c)}),this._setDasSiteLevelTargeting()}_setDasSiteLevelTargeting(){this.setGlobalTargeting(K.FLOORS_USER,String(this._userInfoManager.isKnown));let{roundTripTime:e}=this._idealAdStackManager.getDynamicAuctionTimeoutDetails();e&&this.setGlobalTargeting(K.FLOORS_RTT,String(e))}};T.class(ks,{token:l.GAM_MANAGER,defaultAlias:"gamManager",dependencies:[l.FREESTAR,l.EVENT_BUS,l.DISPENSARY_DATA,l.LOGGER,l.SESSION_STORAGE_MANAGER,l.PAGE,l.USER_INFO_MANAGER],factory:({dependencies:r})=>new ks(L(A({},r),{adUnitManager:te,floorsManager:gt(),idealAdStackManager:j()})).init()});var se={NO_BRANDING:"NO_BRANDING",GREEN:"GREEN",GRAYSCALE:"GRAYSCALE",GREEN_FOOTER_ONLY:"GREEN_FOOTER_ONLY",GRAYSCALE_FOOTER_ONLY:"GRAYSCALE_FOOTER_ONLY"},Pc=`${ao}/imgs/fslogo-green.svg`,Nc=`${ao}/imgs/fslogo-grayscale.svg`,Mc={[se.GREEN]:Pc,[se.GRAYSCALE]:Nc,[se.GREEN_FOOTER_ONLY]:Pc,[se.GRAYSCALE_FOOTER_ONLY]:Nc};var ji=r=>!r||r===se.NO_BRANDING?null:Mc[r];var hp=700,pp=60,gp=`Invalid branding value. Expected one of: ${Object.values(se).join(", ")}`,mp="Missing mandatory parameter: slotId",Us=class{constructor({background:e="linear-gradient(to bottom, #00c389 10%, black 100%)",height:t="175vh",branding:i="GREEN",showPoweredBy:s=!0,slotId:n,styleVersion:o="parallax"}){E(this,"_elementToggle",(e=!0)=>{if(this.flyingCarpetElement)if(e){let t=this.styleVersion==="new"?"flex":"block";this.flyingCarpetElement.style.setProperty("display",t),this.flyingCarpetElement.style.setProperty("visibility","visible")}else this.flyingCarpetElement.style.setProperty("visibility","hidden")});if(!n)throw new Error(mp);this.background=e,this.height=t,this.branding=i,this.showPoweredBy=s,this.slotId=n,this.styleVersion=o,this.flyingCarpetElement=null,this.flyingCarpetEffectCallback=null,this.hangtimeWaiter=null,this._bindEvents()}_bindEvents(){z.instance.resolve(l.GAM_MANAGER).then(e=>{e.instance.pubads().addEventListener(mt,({isEmpty:t,slot:i})=>{i.getSlotElementId()===this.slotId&&this.flyingCarpetElement&&(t?this._elementToggle(!1):(this._elementToggle(!0),this.waitForHangtime()))})}),z.instance.resolve(l.EVENT_BUS).then(e=>{e.subscribe(Ps,({payload:{elementId:t}})=>{t===this.slotId&&this.flyingCarpetElement&&(this._elementToggle(!0),this.waitForHangtime())})})}_didHangtimeServe(){var n,o,a;let e="xyz-clipping",t=(o=(n=this==null?void 0:this.flyingCarpetElement)==null?void 0:n.classList)==null?void 0:o.contains(e),i=(a=this==null?void 0:this.flyingCarpetElement)==null?void 0:a.querySelector(`.${e}`);return t||i}waitForHangtime(){if(!this.hangtimeWaiter){let e=()=>this._didHangtimeServe(),t=(i,s)=>{i&&this._handleGumgumWin()};this.hangtimeWaiter=hl(()=>ti({getIsFound:e,callback:t}),5e3)}this.hangtimeWaiter()}_handleGumgumWin(){this.unstyle(),this.stopRefresh()}_createLogo(){let e=ji(this.branding);return F({type:"img",attributes:{src:e,alt:"fs-logo",width:30}})}generateHTML(){let e={original:this._generateOriginalStyleHTML.bind(this),new:this._generateStyleV2HTML.bind(this),parallax:this._generateParallaxStyle.bind(this)};if(!e[this.styleVersion])throw new Error(`Unsupported fc style version: ${this.styleVersion}`);return this.flyingCarpetElement=e[this.styleVersion](),this.flyingCarpetElement}_generateOriginalStyleHTML(){if(![se.GREEN,se.GRAYSCALE,se.NO_BRANDING].includes(this.branding))throw new Error(gp);let e=F({classList:["fs-flying-carpet"],style:{background:this.background,height:this.height}}),t=F({classList:["fs-flying-carpet-ad-container"]});if(e.appendChild(t),this.showPoweredBy&&this.branding!==se.NO_BRANDING){let n=F({classList:["fs-powered-by"]});n.appendChild(this._createLogo()),e.appendChild(n)}let i=F({classList:["fs-flying-carpet-header"]});i.textContent="Advertisement",e.appendChild(i);let s=F({id:this.slotId});return t.appendChild(s),e}_generateStyleV2HTML(){let e=F({classList:["fs-flying-carpet-v2"]}),t=F({classList:["fs-flying-carpet-v2-text-border"]});t.textContent="ADVERTISEMENT",e.appendChild(t);let i=F({classList:["fs-flying-carpet-v2-ad-container"]});e.appendChild(i);let s=F({id:this.slotId});i.appendChild(s);let n=F({classList:["fs-flying-carpet-v2-text-border"]});return n.textContent="SCROLL TO CONTINUE READING",e.appendChild(n),e}_generateParallaxStyle(){let e=F({classList:["fs-flying-carpet-v3"]}),t=F({classList:["fs-flying-carpet-v3-text-border"]});t.textContent="ADVERTISEMENT",e.appendChild(t);let i=F({classList:["fs-flying-carpet-v3-container"]}),s=F({classList:["fs-flying-carpet-v3-content"]}),n=F({classList:["fs-flying-carpet-v3-slot-wrapper"]}),o=F({id:this.slotId,classList:["fs-flying-carpet-v3-slot"]});n.appendChild(o),s.appendChild(n),i.appendChild(s),e.appendChild(i);let a=F({classList:["fs-flying-carpet-v3-text-border"]});return a.textContent="SCROLL TO CONTINUE READING",e.appendChild(a),this._setupFlyingCarpetEffect(i,o),e}_parallaxUnstyle(){this.flyingCarpetElement.classList.remove("fs-flying-carpet-v3"),this.flyingCarpetElement.querySelectorAll(".fs-flying-carpet-v3-text-border").forEach(s=>{s.style.display="none"});let e=["fs-flying-carpet-v3-container","fs-flying-carpet-v3-content","fs-flying-carpet-v3-slot-wrapper","fs-flying-carpet-v3-slot"],t=e.map(s=>`.${s}`).join(",");this.flyingCarpetElement.querySelectorAll(t).forEach(s=>{s.classList.remove(...e)}),this._teardownFlyingCarpetEffect();let i=this.flyingCarpetElement.querySelector(`#${this.slotId}`);i.style.transform="none",i.style.webkitTransform="none"}unstyle(){let e={parallax:this._parallaxUnstyle.bind(this)};e[this.styleVersion]&&e[this.styleVersion]()}stopRefresh(){let e=this.slotId;freestar.disableRefreshOn({slotId:e})}_setupFlyingCarpetEffect(e,t){if(this.flyingCarpetEffectCallback)return window.addEventListener("scroll",this.flyingCarpetEffectCallback);let i=window.innerHeight<=hp,s=()=>{let n=e.getBoundingClientRect(),o=window.innerHeight,a=o/2;if(n.top<o&&n.bottom>0){let d=Math.min(Math.max((o-n.top)/o,0),1),c=i?o*.4:o*.1,u=n.top>a?c*(.5-d):c*(d-.5);i&&(u-=pp);let f=`translate(-50%, calc(-50% + ${u}px))`;t.style.transform=f,t.style.webkitTransform=f}};this.flyingCarpetEffectCallback=()=>{requestAnimationFrame(s)},window.addEventListener("scroll",this.flyingCarpetEffectCallback)}_teardownFlyingCarpetEffect(){this.flyingCarpetEffectCallback&&window.removeEventListener("scroll",this.flyingCarpetEffectCallback)}};var Gs=class Gs extends Y{constructor(){super(...arguments);E(this,"type","auctionStart")}_buildPayload(t){return ne(t,Gs.payloadProperties)}};E(Gs,"payloadProperties",["placementId","DfpId","fsAuctionId","auctionId","auctionType","location","userIds","kvps"]);var ai=Gs;var Vs=class Vs extends Y{constructor(){super(...arguments);E(this,"type","auctionEnd")}_buildPayload(t){return ne(t,Vs.payloadProperties)}};E(Vs,"payloadProperties",[...ai.payloadProperties,"fsAuctionId","winningBid","advertiserId","campaignId","isEmpty","lineItemId","serviceName","size","sourceAgnosticCreativeId","sourceAgnosticLineItemId","isNativeRender","isGamBypass","isS2SDisabled","unfilled"]);var Fs=Vs;var di=class{create(){return new Y}};var Et=class extends di{constructor({win:e,freestar:t,dispensaryData:i,rebidManager:s}){super(),this._win=e,this._freestar=t,this._dispensaryData=i,this._rebidManager=s,this._googletag=this._win.googletag}_getCpm(e){let{cpm:t=0}=e;return{cpm:Math.trunc(t*1e4),bidCpm:t,originalCpm:t}}_getAuctionTimeout(){let{fsdata:e}=this._dispensaryData;return this._freestar.deviceInfo.device.type=="desktop"?e.timeout:e.mobileTimeout}};function xc({prebid:r,placementId:e}){var n,o;if(!e)return 0;let t=(n=r==null?void 0:r.getBidResponsesForAdUnitCode)==null?void 0:n.call(r,e);if(!((o=t==null?void 0:t.bids)!=null&&o.length))return 0;let i=t.bids.sort((a,d)=>d.cpm-a.cpm),[s]=i;return Number(s.cpm)}function li({bid:r,placementId:e,rebidManager:t,fsAuctionId:i,auctionManager:s}){let n={isRebid:!1,rebidType:"NONE",rebidAttempt:0};try{let{adUnitCode:o,slotId:a}=r||{},d=e||o||a;if(t){let c=t.getStatus({adUnitCode:d});if(c)return n.isRebid=c.count>0,n.rebidType=c.type||"NONE",n.rebidAttempt=c.count,n}if(i){let c=s.getAuctionByFsAuctionId(i);if(c){let u=Array.from(c.adUnits).find(f=>{var p,h;return f.placement.name===d||((p=f.prebid)==null?void 0:p.code)===d||((h=f.slot)==null?void 0:h.getSlotElementId())===d});if(u){let f=u.getStateByFsAuctionId({fsAuctionId:i});f&&f.rebid&&(n.isRebid=f.rebid.count>0,n.rebidType=f.rebid.type||"NONE",n.rebidAttempt=f.rebid.count)}}}}catch(o){console.error("Error in getRebid function:",o),console.error("Context:",{bid:r,placementId:e,fsAuctionId:i})}return n}function Hs({adUnitCode:r,dynamicSlotLibrary:e}){return(e==null?void 0:e[r])||r}function It({slotId:r,slot:e,googletag:t}){if(!r&&!e)return;let i=t.pubads().getSlots().find(n=>[r,e].includes(n.getSlotElementId()));return i?i.getTargeting("fs_uuid").toString():void 0}var qs=class qs extends Y{constructor(){super(...arguments);E(this,"type","bidResponse")}_buildPayload(t){return ne(t,qs.payloadProperties)}};E(qs,"payloadProperties",["bidderCode","width","height","statusMessage","adId","cpm","bidCpm","creativeId","pubapiId","currencyCode","requestId","responseTimestamp","requestTimestamp","bidder","adUnitCode","timeToRespond","adjustment","ttl","format","placementId","source","auctionTimeout","fsRebidCount","auctionId","fsuuid","bidderResponseCode","fsAuctionId","bidCpm","kvps"]);var da=qs,la=class extends Et{constructor({win:e,freestar:t,dispensaryData:i,auctionManager:s,rebidManager:n}){super({win:e,freestar:t,dispensaryData:i}),this._auctionManager=s,this._dispensaryData=i,this._rebidManager=n,this._adUnitManager=te}create(e){var u;let{mediaType:t,currency:i,auctionId:s}=e,n=this._auctionManager.getAuctionByPrebidAuctionId(s),o=n?n.fsAuctionId:null,a=Hs({adUnitCode:e.adUnitCode,dynamicSlotLibrary:this._freestar.dynamicSlotLibrary}),{rebidAttempt:d}=li({bid:e,placementId:a,rebidManager:this._rebidManager,auctionManager:this._auctionManager}),c=this._adUnitManager.getAdUnitByPrebidCode(e.adUnitCode)||this._adUnitManager.getAdUnitBySlotElementId(a);return new da(L(A(A({},e),this._getCpm(e)),{fsRebidCount:d,currencyCode:i,fsuuid:It({slotId:e.slotId,slot:e.slot,googletag:this._win.googletag}),placementId:a,fsAuctionId:o,auctionTimeout:this._getAuctionTimeout(),format:t.length?t:"unknown",kvps:(u=c==null?void 0:c.getKVPs())==null?void 0:u.filter(([f])=>Ld.includes(f))}))}};T.class(la,{token:"BidResponseAnalyticsEventFactory",defaultAlias:"bidResponseAnalyticsEventFactory",dependencies:[l.FREESTAR,{token:l.WINDOW,alias:"win"},l.DISPENSARY_DATA,l.AUCTION_MANAGER,l.REBID_MANAGER]});var zs=class zs extends Y{constructor(){super(...arguments);E(this,"type","bidWon")}_buildPayload(t){return ne(t,zs.payloadProperties)}};E(zs,"payloadProperties",["bidderCode","width","height","statusMessage","adId","creativeId","cpm","rawCpm","bidCpm","adUrl","requestId","responseTimestamp","requestTimestamp","bidder","adUnitCode","timeToRespond","pbLg","pbMg","pbHg","pbAg","pbDg","pbCg","size","alwaysUseBid","bidderRefresh","isRebid","format","placementId","source","rebidType","prebidAuctionStrategy","dropped","fsRebidCount","dealId","adomain","networkCode","impressionId","countryCode","fsAdProduct","auctionId","originalCpm","fsuuid","cdep","isGamBypass","isS2SDisabled","isNativeRender","fsAuctionId","auctionTimeout","paymentRelationship","kvps"]);var ca=zs,fa=class extends Et{constructor({win:e,freestar:t,dispensaryData:i,auctionManager:s,rebidManager:n}){super({win:e,freestar:t,dispensaryData:i}),this._auctionManager=s,this._dispensaryData=i,this._rebidManager=n,this._adUnitManager=te}create(e){var S;let{mediaType:t,currency:i,adUnitCode:s,auctionId:n}=e,o=this._auctionManager.getAuctionByPrebidAuctionId(n),a=o?o.fsAuctionId:null,d=e.creative_id||e.creativeId,c=Hs({adUnitCode:e.adUnitCode,dynamicSlotLibrary:this._freestar.dynamicSlotLibrary}),u=this._adUnitManager.getAdUnitByPrebidCode(s)||this._adUnitManager.getAdUnitBySlotElementId(c),{isRebid:f,rebidType:p,rebidAttempt:h}=li({bid:e,placementId:c,rebidManager:this._rebidManager,fsAuctionId:a,auctionManager:this._auctionManager}),m=Z({name:ie({slotId:s})});return new ca(L(A(A(A({},e),this._getMeta(e)),this._getCpm(e)),{isRebid:f,rebidType:p,fsRebidCount:h,isGamBypass:this._getIsGamBypass(),currencyCode:i,fsuuid:It({slotId:e.slotId,slot:e.slot,googletag:this._win.googletag}),placementId:c,auctionTimeout:this._getAuctionTimeout(),format:t.length?t:"unknown",fsAdProduct:he(m),networkCode:Number(m.dfpId.split("/")[1]),impressionId:de(),isS2SDisabled:j().isS2SDisabled(),adomain:this._getAdomain(e),creativeId:d&&String(d),cdep:this._dispensaryData.cdep||"",fsAuctionId:a,auctionId:n,paymentRelationship:this._getPaymentRelationship(e),kvps:(S=u==null?void 0:u.getKVPs())==null?void 0:S.filter(([b])=>xd.includes(b))}),fe.IMMEDIATE)}_getIsGamBypass(){return!j().isGAMEnabled()}_getMeta(e){let{meta:t={}}=e;return Object.entries(t).reduce((i,[s,n])=>(i[s]=Array.isArray(n)?n.join(","):n,i),{})}_getAdomain(e){let{meta:t={},advertiserDomains:i}=e,s=i||(t==null?void 0:t.advertiserDomains)||[];return Array.isArray(s)?s.join(","):s}_getPaymentRelationship(e){var s,n,o,a,d,c;let t=(o=(n=(s=window.freestar)==null?void 0:s.fsdata)==null?void 0:n.schain)==null?void 0:o.type,i=(c=(d=(a=window.freestar)==null?void 0:a.fsdata)==null?void 0:d.schain)==null?void 0:c.bidderOverrides;if(i&&i.length){if(t===vt&&i.includes(X(e.bidder)))return Or[Me];if(t===Me&&i.includes(X(e.bidder)))return Or[vt]}return Or[t]}};T.class(fa,{token:"BidWonAnalyticsEventFactory",defaultAlias:"bidWonAnalyticsEventFactory",dependencies:[l.FREESTAR,{token:l.WINDOW,alias:"win"},l.DISPENSARY_DATA,l.AUCTION_MANAGER,l.REBID_MANAGER]});var Ys=class Ys extends Y{constructor(){super(...arguments);E(this,"type","bidRequested")}_buildPayload(t){return ne(t,Ys.payloadProperties)}};E(Ys,"payloadProperties",["bidderCode","auctionId","bidderRequestId","start","timeout","bids","auctionStart","src"]);var ua=Ys,ha=class extends Et{constructor({win:e,freestar:t,dispensaryData:i,auctionManager:s}){super({win:e,freestar:t,dispensaryData:i}),this._auctionManager=s,this._dispensaryData=i}create(e){let t=e.bids.map(s=>({bidder:s.bidder,placementCode:s.adUnitCode,bidId:s.bidId,params:JSON.stringify(s.params)}));return new ua(L(A({},e),{bids:t}))}};T.class(ha,{token:"BidRequestedAnalyticsEventFactory",defaultAlias:"bidRequestedAnalyticsEventFactory",dependencies:[l.FREESTAR,{token:l.WINDOW,alias:"win"},l.DISPENSARY_DATA,l.AUCTION_MANAGER]});var js=class js extends Y{constructor(){super(...arguments);E(this,"type","bidTimeout")}_buildPayload(t){return ne(t,js.payloadProperties)}};E(js,"payloadProperties",["auctionId","bidderRequestId","bidId","bidder","adUnitCode","src","timeout"]);var $s=js;var Ws=class Ws extends Y{constructor(){super(...arguments);E(this,"type","dfpResponse")}_buildPayload(t){return ne(t,Ws.payloadProperties)}};E(Ws,"payloadProperties",["placementId","DfpId","advertiserId","campaignId","isEmpty","lineItemId","serviceName","size","sourceAgnosticCreativeId","sourceAgnosticLineItemId","complete","auctionId","dfpRefresh","maxBid","fsRebidCount","fstrU","networkCode","impressionId","countryCode","fsAdProduct","fsuuid","itfTargetingValue","fsAuctionId"]);var pa=Ws,Ks=class extends di{constructor({win:e,freestar:t,prebidManager:i,auctionManager:s,rebidManager:n,refreshLibrary:o}){super(),this._window=e,this._freestar=t,this._prebidManager=i,this._auctionManager=s,this._rebidManager=n,this._refreshLibrary=o}create(e){var b,g;let{parentDiv:t,advertiserId:i=0,campaignId:s=0,lineItemId:n=0,sourceAgnosticCreativeId:o=0,sourceAgnosticLineItemId:a=0,placementId:d,fsAuctionId:c,slotId:u}=e,f=this._window.document.getElementById(t),p=(b=this._refreshLibrary.getRefreshLibraryItem({slotId:t}))==null?void 0:b.dataRefreshId,h=!1;if(f&&p){let _,M=RegExp(p,"g");(g=this._freestar.refreshSlots)==null||g.forEach((x,q)=>{M.test(x.refreshId)&&(_=q,h=!0)}),this._freestar.refreshSlots.splice(_,1)}let{rebidAttempt:m}=li({bid:{fsAuctionId:c,slotId:u},placementId:d,rebidManager:this._rebidManager,fsAuctionId:c,auctionManager:this._auctionManager}),S=xc({placementId:d,prebid:this._prebidManager.instance});return new pa(L(A({},e),{maxBid:Math.trunc(S*1e4),advertiserId:i,campaignId:s,lineItemId:n,dfpRefresh:h,fsRebidCount:m,sourceAgnosticCreativeId:o,sourceAgnosticLineItemId:a,itfTargetingValue:this._freestar.identity.targeting,fsuuid:It({slotId:u,googletag:this._window.googletag})}))}};T.class(Ks,{token:l.DFP_RESPONSE_ANALYTICS_EVENT_FACTORY,dependencies:[l.FREESTAR,{token:l.WINDOW,alias:"win"},l.AUCTION_MANAGER,l.REBID_MANAGER,l.REFRESH_LIBRARY],factory:({dependencies:r})=>new Ks(L(A({},r),{prebidManager:{get instance(){return r.win.fsprebid}}}))});var Qs=class extends Y{constructor(){super(...arguments);E(this,"type","iaiHighImpactTrackings")}};var Js=class extends Y{constructor(){super(...arguments);E(this,"type","iaiHighImpactAdRequests")}};var Zs=class extends Y{constructor(){super(...arguments);E(this,"type","iaiHighImpactInteractions")}};var Ki=class extends Y{constructor(){super(...arguments);E(this,"type","adBlocked")}};var en=class en extends Y{constructor(){super(...arguments);E(this,"type","amazonBidStream")}_buildPayload(t){return ne(t,en.payloadProperties)}};E(en,"payloadProperties",["bidder","adUnitCode","isRefresh","countryCode","auctionId","fsuuid","bidFloor","hashedCpm","requestTimestamp","responseTimestamp"]);var Xs=en;var Lc={level:20,title:"UserScrollTracker"},tn=class r{constructor(){E(this,"_handleScrollData",Lr(()=>{this.scrollHeight=this._getScrollHeight();let e=window.scrollY,t=this.scrollHeight-window.innerHeight,i=e/t*100;this.interactionsLastPercentile=i,this.interactionsMaxPercentile=Math.max(this.interactionsMaxPercentile,i),this.interactionsMsgCount+=1,freestar.log(Lc,`Updated - Last: ${this.interactionsLastPercentile.toFixed(2)}%, Max: ${this.interactionsMaxPercentile.toFixed(2)}%, Height: ${this.scrollHeight}px, MsgCount: ${this.interactionsMsgCount}`)},250));if(r.instance)return r.instance;this.interactionsMsgCount=0,this.interactionsLastPercentile=0,this.interactionsMaxPercentile=0,this.scrollHeight=this._getScrollHeight(),this._initScrollListener(),this._initMutationObserver(),r.instance=this,freestar.log(Lc,"initialized")}_initScrollListener(){window.addEventListener("scroll",this._handleScrollData)}_getScrollHeight(){return document.documentElement.scrollHeight}_initMutationObserver(){new MutationObserver(()=>{this.scrollHeight=this._getScrollHeight()}).observe(document.body,{childList:!0,subtree:!0})}getLastPercentile(){return this.interactionsLastPercentile}getMaxPercentile(){return this.interactionsMaxPercentile}getScrollHeight(){return this.scrollHeight}getMsgCount(){return this.interactionsMsgCount}};var rn=class r{constructor(e){E(this,"_handleTermination",()=>{this._handleTerminationCalled||(this._handleTerminationCalled=!0,this._onTerminateCallback&&this._onTerminateCallback(),setTimeout(()=>{this._handleTerminationCalled=!1},this._throttlePeriod))});if(r.instance)return r.instance;this._onTerminateCallback=e,this._handleTerminationCalled=!1,this._throttlePeriod=2e3,this._initTerminationListeners(),r.instance=this}_initTerminationListeners(){window.addEventListener("beforeunload",this._handleTermination),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this._handleTermination()})}};var Bc={flyingCarpet:"FLYING_CARPET",video:"PRIMIS_VIDEO"},ga=[l.ANALYTICS,l.PAGE];function _p(r){return Bc[r]||Object.values(Bc).find(e=>e===r)||"UNKNOWN"}var sn=class{constructor({percentilePlacement:e,highImpactType:t,slotId:i}){this.percentilePlacement=e,this.highImpactType=t,this.slotId=i,this.id=de(),this.sendInit(),this.scrollTracker=new tn,this.highImpactType==="flyingCarpet"&&this.initializePageviewTerminationService()}sendInit(){z.instance.resolveAll(ga).then(({analytics:e,page:t})=>{e.track(new Qs({sessionId:freestar.msg.sessionId,pageviewId:t.pageId,highImpactUnitSessionId:this.id,percentilePlacement:this.percentilePlacement,sessionDepth:t.pageviewCount,highImpactType:_p(this.highImpactType)}))})}sendRequest({auctionId:e,refreshCount:t}){z.instance.resolveAll(ga).then(({analytics:i,page:s})=>{i.track(new Js({sessionId:freestar.msg.sessionId,pageviewId:s.pageId,auctionId:e,highImpactUnitSessionId:this.id,refreshCount:t}))})}createInteractionsMessage(){z.instance.resolveAll(ga).then(({analytics:e,page:t})=>{let i=new Zs({sessionId:freestar.msg.sessionId,pageviewId:t.pageId,highImpactUnitSessionId:this.id,interactionsMsgCount:this.scrollTracker.getMsgCount(),interactionsLastPercentile:this.scrollTracker.getLastPercentile(),interactionsMaxPercentile:this.scrollTracker.getMaxPercentile(),scrollHeight:this.scrollTracker.getScrollHeight()});i.setTopic(fe.BEACON),e.track(i)})}initializePageviewTerminationService(){this.pageviewTerminationService=new rn(this.createInteractionsMessage.bind(this))}};var ma=class{constructor(){E(this,"sendRequestMessageAuction",e=>{e.getAdUnits().forEach(t=>{this.sendRequestMessage({slotId:t.getSlotId(),auctionId:e.fsAuctionId})})});this.instances={},this.setupRequestMessageListener()}setupRequestMessageListener(){z.instance.resolve(l.AUCTION_MANAGER).then(e=>{e.addEventListener("auctionInit",this.sendRequestMessageAuction)})}newHighImpactTracking({percentilePlacement:e,highImpactType:t,slotId:i}){if(this.instances[i])freestar.log({level:1,title:"HighImpactTrackingManager"},`Already tracking a high impact ad in slot "${i}"!`);else return this.instances[i]=new sn({percentilePlacement:e,highImpactType:t,slotId:i})}sendRequestMessage({slotId:e,auctionId:t}){let i=this.instances[e];i&&z.instance.resolve(l.REFRESH_LIBRARY).then(s=>{var o;let n=((o=s.getRefreshLibraryItem({slotId:e}))==null?void 0:o.timesRefreshed)||0;i.sendRequest({auctionId:t,refreshCount:n})})}},kc=ut.getInstanceFn({ClassConstructor:ma,instanceName:"HighImpactTrackingManager"});var Gc={level:20,title:"IAI"},_a=300,Ea=20,Fc=6e4,Vc=4e4,Uc={VIDEO:"video",FLYING_CARPET:"flyingCarpet"},Ze={PRIMIS_VIDEO:"PRIMIS_VIDEO",FLYING_CARPET:"FLYING_CARPET"},$b={[Ze.PRIMIS_VIDEO]:Uc.VIDEO,[Ze.FLYING_CARPET]:Uc.FLYING_CARPET},Hc=0,qc=1e3;var nn=class{constructor({name:e,placement:t,intelligentAdInsertConfig:i,parentElement:s,debugIndex:n,lazy:o=!1,logger:a,dispensaryData:d,freestar:c,onRemove:u,videoManager:f}){this.name=e,this.placement=t,this.config=i,this.parentElement=s,this.debugIndex=n!=null?n:0,this.lazy=o,this._logger=a,this._dispensaryData=d,this._freestar=c,this._onRemove=u,this._videoManager=f,this.childElements=[],this.resizeObserver=null,this.parentSize=null,this.mutationObserver=null,this.nextChildIndex=0,this.blockedChildren=0,this.ads=[],this.adsInsertedCount=0,this.blocklistSelector=(this.config.blocklist||[]).join(", "),this.debugTimeout=null,this.insertTimeout=null,this.intersectionObserver=null,this.currentRootMargin=null,this.slotsAwaitingIntersection={},this.isFlyingCarpetAdded=!1,this.isVideoAdAdded=!1,this.adLastVisible=new Map,this.cleanupTimeout=null,this.timeouts=new Set,this._isDestroyed=!1,this.highImpactTracking=null,this.highImpactPlacementConfig=null,o||this.init()}info(...e){this._logger.log(Gc,this.debugIndex,...e)}init(){this.childElements=this.getValidChildElements(),this.monitorParentMutation(),this.checkForInsertOpportunities(),this.debug(),this.schedulePeriodicCleanup()}schedulePeriodicCleanup(){this._isDestroyed||(this.cleanupTimeout=setTimeout(()=>{if(!this._isDestroyed)try{this.cleanupInvisibleAds(),this.pruneArrays()}finally{this.schedulePeriodicCleanup()}},Vc),this.timeouts.add(this.cleanupTimeout))}cleanupInvisibleAds(){if(this._isDestroyed)return;let e=Date.now(),t=[];for(let i=0;i<this.ads.length;i++){let s=this.ads[i];if(!document.body.contains(s)){t.push(i);continue}let n=s.getBoundingClientRect();if(n.top<(window.innerHeight||document.documentElement.clientHeight)&&n.bottom>0)this.adLastVisible.set(s,e);else{let a=this.adLastVisible.get(s)||0;e-a>Fc&&t.push(i)}}for(let i=t.length-1;i>=0;i--){let s=t[i],n=this.ads[s];this.ads.splice(s,1),this.adLastVisible.delete(n)}}pruneArrays(){if(!this._isDestroyed){if(this.childElements.length>_a){let e=Math.max(this.nextChildIndex+50,_a);if(this.childElements.length>e){let t=this.childElements.length-e;this.childElements=this.childElements.slice(t),this.nextChildIndex=Math.max(0,this.nextChildIndex-t)}}if(this.ads.length>Ea){let e=this.ads.length-Ea;this.ads.splice(0,e)}}}destroy(){var e,t;this._isDestroyed||(this._isDestroyed=!0,this.info("Destroying IAI instance"),this.mutationObserver&&this.mutationObserver.disconnect(),this.mutationObserver=null,this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=null,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null,clearTimeout(this.debugTimeout),clearTimeout(this.insertTimeout),clearTimeout(this.cleanupTimeout),this.timeouts.forEach(i=>clearTimeout(i)),this.timeouts.clear(),(t=(e=this.adLastVisible)==null?void 0:e.clear)==null||t.call(e),this.childElements=[],this.ads=[],this.slotsAwaitingIntersection={},this.parentElement=null,this.highImpactTracking=null,this.highImpactPlacementConfig=null)}isValidChildElement(e){return e instanceof Element&&!e.matches(".iai-label")&&!e.matches(".fs-iai")&&!e.matches('[class^="fs-"], [class*=" fs-"]')&&(!this.config.childElement||e.matches(this.config.childElement))}getValidChildElements(){let e=[];for(let t of this.parentElement.children)this.isValidChildElement(t)&&e.push(t);return e}biToHw(e,t){var s;let i=(s=e.style.writingMode)!=null?s:getComputedStyle(e).writingMode;return!i||i.toLowerCase().startsWith("horizontal")?{height:t.blockSize,width:t.inlineSize}:{height:t.inlineSize,width:t.blockSize}}onResize(e){let{target:t,borderBoxSize:i,contentBoxSize:s,devicePixelContentBoxSize:n}=e,o={borderBoxSize:this.biToHw(t,i[0]),contentBoxSize:this.biToHw(t,s[0]),devicePixelContentBoxSize:this.biToHw(t,n[0])};this.parentSize=o}onMutation(e){this._isDestroyed||(e.addedNodes.length&&e.addedNodes.forEach(t=>{this.isValidChildElement(t)&&this.childElements.push(t)}),document.body.contains(this.parentElement)||(this.info("Parent element removed from DOM, destroying IAI"),this._onRemove?this._onRemove(this):this.destroy()))}monitorParentMutation(){this.mutationObserver||(this.mutationObserver=new MutationObserver(e=>{for(let t of e)this.onMutation(t);this.insertAds(),this.debug()}),this.mutationObserver.observe(this.parentElement,{childList:!0}))}getNumberOfAdsWithinViewport(e){let i=e.getBoundingClientRect().bottom,{maxHeight:s}=this.getSizeMaxes(),n=i+s,o=(window.innerHeight||document.documentElement.clientHeight)*.95,a=0;for(let d=this.ads.length-1;d>=0;d--){let c=this.ads[d];if(!document.body.contains(c))continue;let f=c.getBoundingClientRect().bottom;if(n-f<o)a+=1;else break}return a}isBlocked(e){var t;return this.blocklistSelector?e.matches(this.blocklistSelector)||((t=e.nextElementSibling)==null?void 0:t.matches(this.blocklistSelector)):!1}canInsertEveryNElements(e,t,i,s){let n=e+1;(!s||s<1)&&(s=t);let o=t-s,a=Math.floor((n+o)/t);return i<a}canInsert(e,t){var u;let i=this.childElements[e],s=!1,n=null,{maxAdsInView:o,everyNElements:a,maxInserts:d,startAfterNElements:c}=this.config;return d&&this.adsInsertedCount>=d?n="maxInserts":this.canInsertEveryNElements(e-t,a,this.adsInsertedCount,c)?(u=i.nextElementSibling)!=null&&u.matches(".fs-iai")?n="adAlreadyInserted":o&&this.getNumberOfAdsWithinViewport(i)>o-1?n="maxAdsInView":this.isBlocked(i)?n="blocklist":s=!0:n="everyNElements",{result:s,reason:n}}insertAds(){this._isDestroyed||(clearTimeout(this.insertTimeout),this.insertTimeout=setTimeout(()=>{this._isDestroyed||this.checkForInsertOpportunities()},1e3))}checkForInsertOpportunities(){for(;this.nextChildIndex<this.childElements.length;){let{reason:e,result:t}=this.canInsert(this.nextChildIndex,this.blockedChildren);if(t)this.info("INSERTING AD @",this.nextChildIndex),this.addSlot(this.nextChildIndex);else if(this.info("NO INSERT @",this.nextChildIndex,"due to",e),e==="maxInserts"){this.info("maxInserts reached, disconnecting MutationObserver..."),this.mutationObserver.disconnect(),this.mutationObserver=null;return}this.nextChildIndex+=1,e==="blocklist"&&(this.blockedChildren+=1)}this.nextChildIndex>=this.childElements.length&&Object.keys(this.slotsAwaitingIntersection).length===0&&this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,this.currentRootMargin=null)}getPercentageHeight(e,t){let i=e.getBoundingClientRect(),s=t.getBoundingClientRect(),a=(i.top-s.top+i.height)/s.height;return a<0?0:Math.min(a,.99)}createFlyingCarpetSlot(e,t){let i=t.selectedSize.flyingCarpetOptions,s=this.childElements[e],n=`${this.name}_${this.debugIndex}_${this.adsInsertedCount}_fc`,o=new Us({branding:i.branding||"NONE",background:i.background||"linear-gradient(to bottom, #00c389 10%, black 100%)",height:i.height||"175vh",slotId:n}),a=o.generateHTML();this.ads.push(a),this.parentElement.insertBefore(a,s.nextSibling);let d={placementName:t.name,slotId:o.slotId,skipSAU:!0};return this.registerSlotWithStrategy({element:a,newAdSlotConfig:d}),this.adsInsertedCount+=1,{slotId:n}}static containsSize(e,t){return e.some(i=>i[0]===t[0]&&i[1]===t[1])}buildAndInsertStandardSlot(e){let t=this.childElements[e],{element:i,newAdSlotConfig:s}=this.buildSlot();this.ads.push(i),this.parentElement.insertBefore(i,t.nextSibling),this.registerSlotWithStrategy({element:i,newAdSlotConfig:s})}getHighImpactPlacementConfig(){var n,o,a;if(this.highImpactPlacementConfig)return this.highImpactPlacementConfig;let e=this.canInsertFlyingCarpetPlacement(),t=((a=(o=(n=this.config)==null?void 0:n.highImpact)==null?void 0:o.placements)!=null?a:[]).filter(d=>{switch(d.format){case Ze.FLYING_CARPET:return e&&this.getFlyingCarpetObject(d.name);case Ze.PRIMIS_VIDEO:return this.isValidVideoPlacement(d.name);default:return!1}}),i=t[Math.floor(Math.random()*t.length)],s=this.getIaiQuartile();return this.highImpactPlacementConfig={placement:i,targetQuartile:s},this.highImpactPlacementConfig}canInsertFlyingCarpetPlacement(){var t,i,s;return((s=(i=(t=this._freestar)==null?void 0:t.deviceInfo)==null?void 0:i.device)==null?void 0:s.type)===Ve&&!ul()}isValidVideoPlacement(e){var i,s,n,o;if(this.isVideoAdAdded)return!1;let t=this.getVideoAdByName(e);if(!t)return!1;switch(t.vendor){case"PRIMIS":{let a=(i=t==null?void 0:t.device)==null?void 0:i.toLowerCase(),d=(o=(n=(s=freestar==null?void 0:freestar.deviceInfo)==null?void 0:s.device)==null?void 0:n.type)==null?void 0:o.toLowerCase();return a==="all_devices"||a===d}default:return!1}}getChildPercentageHeight(e){let t=this.childElements[e];return this.getPercentageHeight(t,this.parentElement)}handleHighImpactUnit(e,t,i){var o;let s;switch(t.highImpactType){case Ze.FLYING_CARPET:{({slotId:s}=this.createFlyingCarpetSlot(e,i)),this.isFlyingCarpetAdded=!0;break}case Ze.PRIMIS_VIDEO:{this._videoManager&&!this.isVideoAdAdded&&({slotId:s}=this.createPrimisVideoSlot(e,i),this.isVideoAdAdded=!0);break}default:return}Math.random()*100<((o=this._dispensaryData.getValue("prebidLogPercentage"))!=null?o:1)&&s&&(this.highImpactTracking=kc().newHighImpactTracking(L(A({},t),{slotId:s})))}createPrimisVideoSlot(e,t){var c,u;let i=this.childElements[e],s=(u=(c=t==null?void 0:t.parentElement)==null?void 0:c.trim())!=null?u:"",n=s.startsWith("#")&&s.length>1,o=`${this.name}_${this.debugIndex}_${this.adsInsertedCount}_iai-video-ad`,a=n?s.slice(1):o;n||(t.parentElement=`#${a}`),t.nthElement=-1;let d=F({id:a});return this.ads.push(d),this.parentElement.insertBefore(d,i.nextSibling),ko({elementSelector:n?s:`#${a}`,callback:()=>{var f,p;return(p=(f=this._videoManager)==null?void 0:f.add)==null?void 0:p.call(f,t==null?void 0:t.name)},timeout:3e3}),this.adsInsertedCount+=1,{slotId:a}}getVideoAdByName(e){var t,i;return(i=(t=freestar.fsdata)==null?void 0:t.videoAds)==null?void 0:i.find(s=>s.name===e)}getHighImpactObject(e){if(this.isFlyingCarpetAdded||this.isVideoAdAdded)return{shouldServe:!1};let{placement:t,targetQuartile:i}=this.getHighImpactPlacementConfig();if(!t)return{shouldServe:!1};let s=this.getChildPercentageHeight(e),n=i-.25,o=Math.round(i*4)+s;if(!(s>=n))return{shouldServe:!1};let d;return(t==null?void 0:t.format)===Ze.PRIMIS_VIDEO?d=this.getVideoAdByName(t.name):(t==null?void 0:t.format)===Ze.FLYING_CARPET&&(d=freestar.fsdata.placements.find(c=>c.name===t.name)),d?{shouldServe:!0,tracking:{percentilePlacement:o,highImpactType:t.format},highImpactPlacement:d}:{shouldServe:!1}}getFlyingCarpetObject(e){var i,s;let t=freestar.fsdata.placements.find(n=>n.name===e);if((s=(i=t==null?void 0:t.selectedSize)==null?void 0:i.flyingCarpetOptions)!=null&&s.active)return t.selectedSize.flyingCarpetOptions}addSlot(e){let{shouldServe:t,tracking:i,highImpactPlacement:s}=this.getHighImpactObject(e);t?this.handleHighImpactUnit(e,i,s):this.buildAndInsertStandardSlot(e)}getSizeMaxes(){let e=this.placement.sizes.filter(s=>Array.isArray(s)),t=0,i=0;return e.forEach(s=>{t=Math.max(t,s[0]),i=Math.max(i,s[1])}),{maxWidth:t,maxHeight:i}}getStickySettings(){var e,t;if((t=(e=this.placement)==null?void 0:e.selectedSize)!=null&&t.stickyAdEnabled){let{headerHeight:i,stickyAdBackgroundRgba:s}=this.placement.selectedSize;return{headerHeight:i,stickyAdBackgroundRgba:s}}return null}getStickyStyleContent({headerHeight:e,stickyAdBackgroundRgba:t}){let i=[];return t&&i.push(`.fs-iai-sticky { background-color: ${t} }`),(!e||e<0)&&(e=0),i.push(`.fs-iai-sticky > div { top: ${e}px }`),i.join(` `)}makeStickyStyle({headerHeight:e,stickyAdBackgroundRgba:t}){let i=`iai-sticky-style-${this.name}`;if(!document.getElementById(i)){let n=document.createElement("style");n.id=i,n.textContent=this.getStickyStyleContent({headerHeight:e,stickyAdBackgroundRgba:t}),document.head.appendChild(n)}}buildSlot(){let e=`${this.name}_${this.debugIndex}_${this.adsInsertedCount}`,{maxWidth:t,maxHeight:i}=this.getSizeMaxes(),s=this.getStickySettings();s&&this.makeStickyStyle(s);let o=F({type:"div",id:e,classList:s?["fs-iai","fs-iai-sticky"]:["fs-iai"],attributes:[{style:`min-height:${i}px; min-width:${t}px;`},{"data-freestar-ad":zc({placement:this.placement})},{name:this.name}]}),a=e+"_slot",d=F({type:"div",id:a,attributes:[{style:"display: flex; align-items: center; min-height: inherit;"}]});return o.appendChild(d),this.adsInsertedCount+=1,{element:o,newAdSlotConfig:{placementName:this.name,slotId:a,skipSAU:!0}}}intersectionObserverCallback(e,t){e.forEach(i=>{if(i.isIntersecting){let{target:s}=i;t.unobserve(s);let n=this.slotsAwaitingIntersection[s.id];n&&(this.info("Registering new ad slot for",s.id),delete this.slotsAwaitingIntersection[s.id],this._freestar.newAdSlots([n]))}}),Object.keys(this.slotsAwaitingIntersection).length===0&&(this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=null,this.currentRootMargin=null)}isApplicableLazyLoadHeight(e){return e!=null&&typeof e=="number"&&e>=Hc&&e<=qc}registerSlotWithStrategy({element:e,newAdSlotConfig:t}){let i=this.config.lazyLoadHeight;this.isApplicableLazyLoadHeight(i)?this.registerSlotLazy(e,t,i):this.registerSlotImmediate(t)}registerSlotImmediate(e){this.info("Registering ad slot immediately (lazy loading disabled)"),this._freestar.newAdSlots([e])}registerSlotLazy(e,t,i){let s=`${i}%`;(!this.intersectionObserver||this.currentRootMargin!==s)&&(this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=new IntersectionObserver((n,o)=>this.intersectionObserverCallback(n,o),{rootMargin:s}),this.currentRootMargin=s,Object.keys(this.slotsAwaitingIntersection).forEach(n=>{let o=document.getElementById(n);o&&this.intersectionObserver.observe(o)})),this.slotsAwaitingIntersection[e.id]=t,this.intersectionObserver.observe(e),this.info(`Waiting for intersection for ${e.id} with ${i}% margin`)}debug(){this._freestar.debug&&(clearTimeout(this.debugTimeout),this.debugTimeout=setTimeout(()=>this._debug(),1e3))}_debug(){this.debugAddStyleNode(),this.debugNames()}getDebugStyleContent(){let e="";return this.blocklistSelector&&(e=` ${this.config.blocklist.map(i=>`${this.config.parentElement} >${i}`).join(", ")} { outline: dashed red; } `),` ${this.config.parentElement} { outline: solid blue; } ${this.config.parentElement} >${this.config.childElement||"*"} { outline: solid fuchsia; } .parent-label { color: blue; } .child-label { color: fuchsia; } .ad-label { color: #00c389; } .iai-label { position: absolute; font: large; background: silver; padding: 3px; } .fs-iai { outline: solid #00c389; /* freestar green */ } ${e} `}debugAddStyleNode(){let e=`iai-style-${this.name}`;if(!document.getElementById(e)){let i=document.createElement("style");i.id=e,i.textContent=this.getDebugStyleContent(),document.head.appendChild(i)}}debugNames(){this.debugAddLabel(this.parentElement,"parent-label",`${this.name} parent ${this.debugIndex}`),this.childElements.forEach((e,t)=>this.debugAddLabel(e,"child-label",`child ${t}`)),this.ads.forEach((e,t)=>this.debugAddLabel(e,"ad-label",`ad ${t}`))}debugAddLabel(e,t,i){let s=e.querySelector(".iai-label");s||(s=document.createElement("label"),s.classList.add("iai-label"),e.insertBefore(s,e.firstChild)),s.classList.add(t),s.textContent=i}getIaiQuartile(){let e=[.25,.5][Math.floor(Math.random()*2)],t=fl();return this.info(`Using ${t!=null?`${t} from query parameter`:`randomly generated target quartile ${e}`}`),t!=null?t:e}};var Ia=class{constructor({freestar:e,logger:t,dispensaryData:i,video:s}){E(this,"newIai",e=>{var t;(t=this._dispensaryData.getValue("placements"))==null||t.forEach(i=>{if(e&&i.name!==e)return;let s=Sa({placement:i});s!=null&&s.active&&(this.registerConfig({placement:i,intelligentAdInsertConfig:s}),this.initConfig({name:i.name}))})});this._freestar=e,this._logger=t,this._dispensaryData=i,this._videoManager=s,this.configs={},this.instances=new Map,this.initializedParentElements=new WeakMap,this._logger.setContext("IAI"),this._logger.setLevel(Q.CORE)}registerConfig({placement:e,intelligentAdInsertConfig:t}){let i=e.name;if(!this.configs[i]){let s={name:i,placement:e,intelligentAdInsertConfig:t};this.configs[i]=s}}initConfig({name:e}){if(Cs({name:"iai"}))return;let t=this.configs[e];if(!t){this._freestar.log(50,`Cannot init unregistered IAI ${e}!`);return}let{placement:i,intelligentAdInsertConfig:s}=t,n=s.parentElement,o=Array.from(document.querySelectorAll(n));o.length!==0&&o.forEach(a=>{if(this.initializedParentElements.has(a))return;let d=new nn({name:e,placement:i,intelligentAdInsertConfig:s,parentElement:a,debugIndex:this.instances.size,logger:this._logger,dispensaryData:this._dispensaryData,freestar:this._freestar,onRemove:c=>this.removeInstance(c),videoManager:this._videoManager});this.instances.set(d,a),this.initializedParentElements.set(a,e)})}removeInstance(e){var i;let t=this.instances.get(e);t&&((i=e==null?void 0:e.destroy)==null||i.call(e),this.instances.delete(e),this.initializedParentElements.delete(t))}};function Sa({placement:r}){var e;return(e=r==null?void 0:r.selectedSize)==null?void 0:e.intelligentAdInsertConfig}T.class(Ia,{token:"IntelligentAdInsertManager",dependencies:[l.FREESTAR,l.LOGGER,l.DISPENSARY_DATA,{token:l.VIDEO,optional:!0}],defaultAlias:"intelligentAdInsertManager"});function ta(r){var e,t;return!!((t=(e=r==null?void 0:r.selectedSize)==null?void 0:e.flyingCarpetOptions)!=null&&t.active)}function Ac(r){var t;return ta(r)?(typeof freestar!="undefined"&&((t=freestar==null?void 0:freestar.fsdata)==null?void 0:t.placements)||[]).some(i=>{var n;let s=Sa({placement:i});return!(s!=null&&s.active)||!((n=s.highImpact)!=null&&n.placements)?!1:s.highImpact.placements.some(o=>o.format==="FLYING_CARPET"&&o.name===r.name)}):!1}function Yc(r){if(Aa())throw new Error("Ad serving is blocked in "+r.locData.iso)}function $c({channel:r,logTitle:e="ChannelConfiguration",config:t,placements:i,logger:s}){return!r&&t.channel&&(r=t.channel),t.orignalChannel||(t.orignalChannel="{{channel}}"),r&&t.orignalChannel!==r&&(i=Ep({channel:r,logTitle:e,originalChannel:t.orignalChannel,placements:i,logger:s}),t.orignalChannel=r),{channel:r,placements:i}}function Ep({channel:r,originalChannel:e,logTitle:t,placements:i,logger:s}){s.log("Channel is different than originally set, modifying dfpIds",{level:s.constructor.VERBOSE,context:t});let n=i.map(o=>L(A({},o),{dfpId:o.dfpId.replace(e,r)}));return s.log(["New dfpIDs",n.map(o=>o.dfpId)],{level:s.constructor.VERBOSE,context:t}),n}function jc(r,e,t){if(!r)return[];Array.isArray(r)||(r=[r]);let i=r.filter(s=>{let{placementName:n}=s,o=Z({name:n})!==void 0;return o||t.log(`cannot find placement for ${n}, ignoring`,{level:t.constructor.CORE,context:e}),o});return uo(i,"slotId")}function Ip(r,e){var s;if("indexExchange".indexOf(e.bidder)>-1&&e.params&&e.params.id&&e.params.id<0&&(e.dynamicId=!0),e.bidder==="conversant"){e.params.secure=freestar.isHttps;for(let n in e.params)switch(n){case"bidfloor":case"position":case"maxduration":e.params[n]=Number(e.params[n]);break}}if(e.bidder==="cox"&&(e.params.id=Number(e.params.id),e.params.siteId=Number(e.params.siteId)),e.bidder==="justpremium"&&e.params&&(e.params.allow=Kc(e.params.allow),e.params.exclude=Kc(e.params.exclude),e.params.allow!==void 0&&(e.params.allow===null||e.params.allow.length===0)&&delete e.params.allow,e.params.exclude!==void 0&&(e.params.exclude===null||e.params.exclude.length===0)&&delete e.params.exclude),e.bidder==="pulsepoint")for(let n in e.params)n=="cf"&&(e.params[n]=e.params[n].replace("X","x"));if(e.bidder==="connectad")for(let n in e.params)(n==="siteId"||n==="networkId")&&(e.params[n]=Number(e.params[n]));if(e.bidder==="grid"&&e.params&&e.params.uid&&(e.params.uid=Number(e.params.uid)),e.bidder==="beachfront")for(var t in e.params)(t=="video"||t=="banner")&&(e.params[t]=typeof e.params[t]=="object"?e.params[t]:JSON.parse(e.params[t]));if(e.bidder==="undertone"&&(e.params.publisherId=Number(e.params.publisherId),e.params.placementId=Number(e.params.placementId)),e.bidder==="ttd"&&(e.params.publisherId=freestar.fsdata.companyId),e.bidder==="zid"&&(e.params.adUnitID=st(e.params.adUnitID)),e.bidder==="mantis"&&(e.params.zone=r.name),e.bidder==="districtmDMX"&&(e.params.dmxid=Number(e.params.dmxid),e.params.memberid=Number(e.params.memberid)),e.bidder==="answermedia"&&(e.params.siteId=st(e.params.siteId),e.params.networkId=st(e.params.networkId),e.params.zoneIds&&Mr(e.params.zoneIds)&&e.params.zoneIds.split(",").length>0?e.params.zoneIds=e.params.zoneIds.split(",").map(function(n){return st(n)}):e.params.zoneIds=[]),e.bidder==="consumable"&&(e.params.siteId=st(e.params.siteId),e.params.networkId=st(e.params.networkId),e.params.unitId=st(e.params.unitId)),["appnexus","appnexusAst","brealtime","pagescience","defymedia","gourmetads","matomy","featureforward","oftmedia"].indexOf(e.bidder)>-1)for(let n in e.params)n=="placementId"&&(e.params[n]=Number(e.params[n])),["allowSmallerSizes","member","invCode"].indexOf(n)>-1&&delete e.params[n];if(["defymedia","zid"].indexOf(e.bidder)>-1)return!1;e.bidder==="sortable"&&(e.params.tagId=r.name);let i=["sharethrough","triplelift"];if(r.stickyFooter===!0&&i.indexOf(e.bidder)>-1)return!1;if(e.bidder==="criteo"&&(e.params.zoneId=Number(e.params.zoneId)),e.bidder==="taboola"&&(e.params.tagId=r.name),e.bidder==="monetixads"&&e.params&&e.params.networkId&&(e.params.networkId=Number(e.params.networkId)),e.bidder==="teads")for(let n in e.params)(n==="pageId"||n==="placementId")&&(e.params[n]=Number(e.params[n]));if((e==null?void 0:e.bidder)==="flipp"&&(e!=null&&e.params)){let{siteId:n,zoneIds:o,dwellExpand:a}=e.params;if(n&&o){let c=Number(n),u=Number(o);[c,u].every(f=>!Number.isNaN(f))&&(e.params.siteId=c,e.params.zoneIds=[u]),a==="true"&&(e.params.options={dwellExpand:!0})}let d=(s=freestar==null?void 0:freestar.msg)==null?void 0:s.fpc;d&&(e.params.userKey=d)}return Qe(e)}function Sp(r,e=!1){if(e===!1)return!0;let{allowedGeos:t=[],disallowedGeos:i=[]}=r,{iso:s}=e,n=freestar.networkMap[r.id];return n&&(n.allowedGeos&&n.allowedGeos.length&&(t=n.allowedGeos),n.disallowedGeos&&n.disallowedGeos.length&&(i=n.disallowedGeos)),t&&t.length&&t.indexOf(s)===-1||i&&i.length&&i.indexOf(s)!==-1?(freestar.log(1,`Users in ${freestar.locData.iso} are not allowed to use ${r.slug}!`),!1):!0}function Ap({network:r}){if(freestar.networkMap===!1||Object.keys(freestar.networkMap).length===0)return!0;let e=freestar.networkMap[r.id];return!e||Ts()&&tl.indexOf(r.slug)!==-1?(freestar.log(1,"isNetworkActive - Page Speed Optimized in effect, or network is inactive filtering out",r.slug),!1):e&&al(e.active)?e.active:!0}function yp(r){return Wc(r.size,[0,0])&&delete r.size,r}function Xe(r=window){return r.innerWidth&&r.document.documentElement.clientWidth?Math.min(r.innerWidth,r.document.documentElement.clientWidth):r.innerWidth||r.document.documentElement.clientWidth||r.document.getElementsByTagName("body")[0].clientWidth}function on(r,e){if(e.length>0&&Array.isArray(e[0])){let i=e.length;if(e[0][0]===0&&e[0][1]===0)return!0;for(;i--;)if(on(r,e[i]))return!0}let t=r.length;for(;t--;)if(r[t][0]===e[0]&&r[t][1]===e[1])return!0;return!1}function Wc(r,e){let t=r.length;for(;t--;)if(r[t][0]===e[0]&&r[t][1]===e[1])return!0;return!1}function Qc(r){return!r.validAdSizes||!r.bidders||r.bidders.length===0||r.stickyFooter||r.dynamicAd?!1:bp(r)}function bp(r){return freestar.config!==void 0&&freestar.config.enabled_slots!==void 0?Tp(freestar.config.enabled_slots,r.name):!0}function Tp(r,e){for(let t=0;t<r.length;t++)if(r[t].placementName===e)if(document.readyState==="complete"){if(window.document.getElementById(e))return!0}else return!0;return!1}function Kc(r){if(!r)return null;let e=null;try{e=JSON.parse(r)}catch(t){e=null}return e!==null&&e.length>0?e:null}function ya({network:r,adQualityBlockList:e}){return Sp(r,window.freestar.locData)&&Ap({network:r})&&vs({network:r,adQualityBlockList:e})&&Qr({network:r})}function Jc(){return y(this,null,function*(){let r=Rs();function e(c,u){X(c.bidder)==="ix"?u.sizes.forEach(f=>{let p={bidder:c.bidder,params:{siteId:c.params.siteId,size:f}};u.bidders.push(p)}):c&&u.bidders.push(c)}function t(c,u){return j().getBidderSummary()[c]===W.BOTH&&u===W.CLIENT}function i(c){return c.deviceExclusive&&c.deviceExclusive.toLowerCase()!==freestar.deviceInfo.device.type}function s({clientOrServerBehaviour:c,size:u,parentNetwork:f,placement:p}){let h=u.params;if(c===W.SERVER&&(f!=null&&f.useDistinctParams)){if(!u.serverParams)return;h=u.serverParams}let m={bidder:f.slug,size:u.size,params:h},S=Ip(p,yp(m));if(S){let b=t(f.slug,c)?Os(f.slug):f.slug;return L(A({},S),{bidder:b})}}function n({size:c,parentNetwork:u,placement:f}){return s({clientOrServerBehaviour:W.CLIENT,size:c,parentNetwork:u,placement:f})}function o({size:c,parentNetwork:u,placement:f}){return s({clientOrServerBehaviour:W.SERVER,size:c,parentNetwork:u,placement:f})}function a(c,u,f,p=!1){let h=he(f),m=j().getConfig(h),{clientServer:S}=m,b=S[c.slug],g=c;if(p){let _=freestar.fsdata.networks.find(M=>M.slug===c.slug);_&&(g=_)}if(p)b=W.CLIENT;else{if(b===W.OFF)return;b||(b=zi.networkBidderBehaviour(g))}if(b===W.CLIENT||b===W.BOTH){let _=n({size:u,parentNetwork:g,placement:f});_&&e(_,f)}if(b===W.SERVER||b===W.BOTH){let _=o({size:u,parentNetwork:g,placement:f});_&&e(_,f)}}let d=freestar.config.channel||freestar.fsdata.defaultChannel;d&&(freestar.log(9," Setting the channel to:"+d),freestar.config.orignalChannel=d),freestar.fsdata.placements=freestar.fsdata.placements.filter(c=>!c.archived),freestar.fsdata.placements.forEach(c=>y(this,null,function*(){d&&(c.dfpId=c.dfpId.replace("{{channel}}",d),freestar.log(9," Setting the dfp id to:"+c.dfpId)),c.bidders=[],c.sizes=[],c.validAdSizes=!1;let u=S=>S[0]===320&&S[1]===50,f=S=>{S.size&&(S.size=[[300,250]])},p=(S,b)=>{if(Array.isArray(S.size[0]))S.size.forEach(g=>{u(g)?(S.size.push([300,250]),b(null,!0)):b(!0)});else{let g=S.size;u(S.size)?(S.size=[g,[300,250]],b(null,!0)):b(!0)}};for(let S=0;S<c.sizeMappings.length;S++){let b=c.sizeMappings[S];if(Xe()>=b.viewport.size[0]){for(let g=0;g<b.size.length;g++){let _=b.size[g];c.selectedSize=b,_[0]==35843?(c.fluidAd=!0,c.validAdSizes=!0):on(b.size,_)&&!Wc(c.sizes,_)&&(freestar.forceSize&&xr(freestar.forceSize.sort(),_.sort())?c.sizes.push(_):freestar.forceSize||c.sizes.push(_))}c.sizes.length>0&&(c.validAdSizes=!0);break}}let h=new Set,m=[];if(c.networks.forEach(S=>{ya({network:S,adQualityBlockList:r})&&h.add(S.slug)}),c.networks.forEach(S=>{ya({network:S,adQualityBlockList:r})&&S.sizes.forEach(b=>{if(m.push(b.size[0]),on(c.sizes,b.size)){if(i(b))return;a(S,b,c,!0)}})}),c.ignoreSiteBidders||freestar.fsdata.networks.forEach(S=>{h.has(S.slug)||ya({network:S,adQualityBlockList:r})&&Pr({value:S.sizes})&&S.sizes.forEach(b=>{if(on(c.sizes,b.size)){if(i(b))return;a(S,b,c)}})}),c.sizes=ho(c.sizes),c.bidders=ho(c.bidders),c.sizes.length>0){let{active:S,adhesionRemove:b}=pc({placement:c,type:re.STICKY_FOOTER_OPTIONS});S&&b&&document.getElementById("fs-special-remove")&&(c.bidders=c.bidders.filter(g=>!["33across","gumgum"].includes(X(g.bidder))))}})),no()>=1&&console.groupCollapsed("freestar.fsdata.placements"),freestar.log(1," freestar.fsdata.placements : "+JSON.stringify(freestar.fsdata.placements)),console.groupEnd()})}var Zc=({adUnitPath:r})=>window.freestar.fsdata.placements.find(e=>r===e.dfpId);function Aa(){let r=el,e=r.length,t=!1;if(freestar.locData&&freestar.locData.iso)for(let i=0,s=e;i<s;i++){let n=r[i];if(freestar.fsdata.siteId===n.siteId&&n.restrictedCountries.indexOf(freestar.locData.iso)>-1){t=!0;break}}return t}var ba;function pt(r=freestar.fsdata){return ba==null&&(ba=r.placements.some(e=>e.customTargetingPlacementName)),ba}function Ut(r,e=freestar.fsdata){return pt(e)&&!r.customTargetingPlacementName}function Xc(r){if(r==="true")return!0;if(r==="false")return!1}function an(r,e,t){let i=t&&t.length;if(!(e===Me&&!i))return{ver:"1.0",complete:1,nodes:[{asi:wr,sid:`${r}`,hp:1}]}}function wp(r){let e={},t=Qe({code:r.name,sizes:r.sizes,mediaTypes:null,bids:r.bidders.filter(o=>o.bidder!=="amazon")}),i=he(r),{battr:s=null}=window.freestar.fsdata.ortb||{};t.ortb2Imp={ext:{data:{fs_ad_product:i,fs_ad_optimization:Je(r)}},tagid:r.name,battr:s},r.storedRequestId&&(t.ortb2Imp.ext.prebid={storedrequest:{id:r.storedRequestId}});let n=!1;if(r.sizeMappings.forEach(o=>{!n&&Xe()>=o.viewport.size[0]&&(o.mediaTypes.forEach(a=>{typeof e[a]=="undefined"&&(e[a]={}),typeof e[a].sizes=="undefined"&&(e[a].sizes=[]),o.size.forEach(h=>{if(h[0]<35843){if((a==="banner"||a==="native")&&"302x170, 443x250, 554x312, 640x360".includes(`${h[0]}x${h[1]}`))return;e[a].sizes.push(h)}}),e[a].sizes=cl(e[a].sizes);let d=il.map(h=>h.join("x")),c=[],u=Rs();r.networks&&r.networks.forEach(h=>{vs({network:h,adQualityBlockList:u})&&h.sizes&&h.sizes.forEach(m=>{m.size.forEach(S=>{c.push(S)})})});let f=c.filter(h=>Array.isArray(h)).map(h=>h.join("x")),p=r.sizes.filter(h=>Array.isArray(h)).map(h=>h.join("x"));if(e[a].sizes=e[a].sizes.filter(h=>{if(d.indexOf(h.join("x"))!==-1||p.indexOf(h.join("x"))!==-1&&f.indexOf(h.join("x"))!==-1)return h}),e[a].sizes=e[a].sizes.sort(Yt),a==="native"&&(e[a]=Object.assign(e[a],{type:"image",sendTargetingKeys:!1})),a==="video"){let h=[1,1];e[a].sizes.forEach(S=>{h[0]<S[0]&&(h=S)});let m=h[0]>=500?Rr:vr;e[a]=Object.assign({},e[a],{api:[2],context:"instream",delivery:[2],linearity:2,maxduration:window.freestar.fsdata.adRefreshRate,mimes:["video/mp4","application/javascript","video/webm"],minduration:1,placement:1,playbackmethod:[6],playerSize:m[0],plcmt:4,protocols:[2,3,5,6],size:m,skip:0,useCacheKey:!0,renderer:{render:S=>{z.instance.create(l.IN_BANNER_VIDEO_PLAYER,{provide:{params:{bid:S}}})},url:"https://a.pub.network/superflex/loader.js"}})}}),n=!0)}),t.mediaTypes=e,!!t.bids){for(let o=t.bids.length-1;o>=0;o--){if(t.bids[o].dynamicId&&(t.bids[o].params.id=++freestar.dynamicIdNum),t.bids[o].bidder){let a={minViewPort:[0,0],relevantMediaTypes:["banner","native"]},d={minViewPort:[0,0],relevantMediaTypes:["banner","native","video"]};switch(X(t.bids[o].bidder)){case"zid":t.bids[o].params.adUnitID=Number(t.bids[o].params.adUnitID),t.bids[o].sizeConfig=[a];break;case"appnexus":t.bids[o].sizeConfig=[d];break;case"onemobile":t.bids[o].params.ext=Object.assign(t.bids[o].params.ext||{},{req:location.href}),t.bids[o].sizeConfig=[a];break;case"ttd":t.bids[o].params.publisherId=freestar.fsdata.companyId,t.bids[o].sizeConfig=[a];break;case"resetdigital":Rp()||t.bids.splice(o,1);break;case"fsxs2s":case"pubmatic":case"rubicon":case"ix":case"unruly":case"yieldmo":case"openx":case"yahoo":case"mediagrid":t.bids[o].sizeConfig=[d];break;default:t.bids[o].sizeConfig=[a];break}["use_pmt_rule","usePaymentRule"].forEach(c=>{let u=Xc(t.bids[o].params[c]);u!==void 0&&(t.bids[o].params[c]=u)})}t.bids[o].size?ef(t.bids[o].size[0],t.mediaTypes.banner.sizes)||t.bids.splice(o,1):t.bids[o].params.size&&(ef(t.bids[o].params.size,t.mediaTypes.banner.sizes)||t.bids.splice(o,1))}return t}}function ef(r,e){for(let t=0;t<e.length;t++)if(JSON.stringify(r)===JSON.stringify(e[t]))return!0;return!1}function Rp(){let r=window.freestar.locData&&window.freestar.locData.iso||null,e=window.freestar.locData&&window.freestar.locData.state||null;return r==="US"&&!["CA","CO","CT","VA","UT"].includes(e)}var Ta=wp;var le=[];for(let r=0;r<256;++r)le.push((r+256).toString(16).slice(1));function tf(r,e=0){return(le[r[e+0]]+le[r[e+1]]+le[r[e+2]]+le[r[e+3]]+"-"+le[r[e+4]]+le[r[e+5]]+"-"+le[r[e+6]]+le[r[e+7]]+"-"+le[r[e+8]]+le[r[e+9]]+"-"+le[r[e+10]]+le[r[e+11]]+le[r[e+12]]+le[r[e+13]]+le[r[e+14]]+le[r[e+15]]).toLowerCase()}var wa,vp=new Uint8Array(16);function Ra(){if(!wa){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");wa=crypto.getRandomValues.bind(crypto)}return wa(vp)}var Op=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),va={randomUUID:Op};function Cp(r,e,t){var s,n,o;if(va.randomUUID&&!e&&!r)return va.randomUUID();r=r||{};let i=(o=(n=r.random)!=null?n:(s=r.rng)==null?void 0:s.call(r))!=null?o:Ra();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let a=0;a<16;++a)e[t+a]=i[a];return e}return tf(i)}var Oa=Cp;function rf({cpm:r}){let e=r<=10?20:2;return(Math.round(r*e)/e).toFixed(2)}function Ca({freestar:r}){if(r!=null&&r.prebidAdserverTargetingKeys)return r.prebidAdserverTargetingKeys;let e={},t=["bidder","adid","pb","size","format","auction_id","source"],i=r.fsdata.useFsAdserverTargetingKeys||B("use-fs-adserver-targeting-keys")?"fs_":"hb_";return t.forEach(s=>{e[s]=`${i}${s}`}),r.prebidAdserverTargetingKeys=e,e}function dn(r=window.freestar.locData){return r?co.includes(r.iso)||r.state==="QC":!1}var of=r=>r.length===1&&r[0][0]===1&&r[0][1]===1;var zc=({placement:r})=>{let e="";if(!r)return e;let t=r.sizes.filter(s=>Array.isArray(s)),i={w:Di(t,s=>s[0]),h:Di(t,s=>s[1])};return i.w&&i.w.length&&(e+=`__${i.w.join("x")}`),i.h&&i.h.length&&(e+=` __${i.h.join("x")}`),e};var af=()=>["v2ContentCategory","v2ContentSource","v2ContentMediaFormat","v2ContentChannel","v2ContentType","v2ContentLanguage","v2ContentSourceGeo"].reduce((e,t)=>window.freestar.fsdata[t]?[...e,...window.freestar.fsdata[t]]:e,[]),de=()=>Oa();function df(r,{id:e=null}={}){let t=F({type:"style",attributes:[{"data-owner":"freestar"}],id:e});t.textContent=r,document.head.append(t)}function aa(r,e=window){let t=null;return r.sizeMappings.some(i=>{if(Xe(e)>=i.viewport.size[0])return t=i.size.sort(Yt).filter(s=>s[0]!==35843),!0}),t}var Z=({name:r})=>window.freestar.fsdata.placements.find(e=>e.name===r);var lf=r=>r.intersectionRatio>0&&r.isIntersecting&&ll(r,"target.id.length",0)>1,cf=({email:r})=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(r);var Da="fs.session";var Pa="fs.itf.group",Na="fs.itf.targeting",ln="fs.ident";var Ma=class{constructor(){this.session=null,this._init()}_init(){this.session=G({key:Da,type:k.object.type}),(!this.session||!Object.keys(this.session).length)&&(this.session={id:de()});let t=Ti.flatMap(i=>{let s=B(i);return s?{key:i,value:s}:[]}).reduce((i,{key:s,value:n})=>(i[s]=n,i),{});this.session.utm=t,ee({key:Da,type:k.object,value:this.session})}getSessionId(){return this.session.id}getUTMValue(e){var t;return(t=this.session.utm)==null?void 0:t[e]}};T.class(Ma,{token:l.SESSION_STORAGE_MANAGER,defaultAlias:"sessionStorageManager"});var xa=class{constructor({page:e,sessionStorageManager:t,dispensaryData:i}){this._page=e,this._sessionStorageManager=t,this._dispensaryData=i}create({events:e=[]}){let t=this._collectContextInfo();return new Is({context:t,events:e})}_collectContextInfo(){let{pageId:e,pageViewCount:t,url:i}=this._page||{};return A(A(A({messageId:de(),referalURL:document.referrer||void 0,pageId:e,url:i,userAgent:navigator.userAgent,pageviewCount:t||1},this._getDispensaryData()),this._getTestData()),this._getSessionData())}_getSessionData(){let t=Object.fromEntries([["utmSource",Si],["utmMedium",Ai],["utmCampaign",yi],["utmTerm",ro],["utmContent",bi]].map(([i,s])=>[i,this._sessionStorageManager.getUTMValue(s)]));return L(A({},t),{sessionId:this._sessionStorageManager.getSessionId()})}_getTestData(){let e=G({key:rt,type:k.number.type})||0,t=G({key:Ne})||null,i=G({key:vi})||null;return{testName:t,testGroup:e,testVariantId:i}}_getDispensaryData(){let t=Object.fromEntries(["accountId","siteId","deploymentId","templateVersionId"].map(s=>[s,this._dispensaryData.getValue(s)])),i=this._dispensaryData.getValue("gitHash");return t.templateVersionId==null&&i&&(t.templateVersionId=i),t}};T.class(xa,{token:l.ANALYTICS_MESSAGE_FACTORY,defaultAlias:"analyticsMessageFactory",dependencies:[l.PAGE,l.SESSION_STORAGE_MANAGER,l.DISPENSARY_DATA]});var Wi=class extends Error{constructor({message:e,details:t,context:i}){super(e),this.details=t,this.context=i}};var La=class{constructor({logger:e,apiHost:t=Sr,version:i="v2"}={}){this.apiHost=t,this.version=i,this.url=`${this.apiHost}/${this.version}/c`,this._logger=e,this._logger.setContext(l.DATA_COLLECTOR_API),this._logger.setLevel(80)}send(e){return y(this,null,function*(){var t;if(e){this._logger.log(["Sending data to collector",e]);try{let i=yield fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(i!=null&&i.ok)return;throw i}catch(i){let s={status:(t=i==null?void 0:i.status)==null?void 0:t.toString(),statusText:i==null?void 0:i.statusText},n="Data Collector API Error: ";throw i!=null&&i.status?n+=`Status: ${i==null?void 0:i.status} ${i==null?void 0:i.statusText}`:n+=`Status: ${i.message}`,new Wi({message:n,details:s,context:e})}}})}sendBeacon(e){let t=new Blob([JSON.stringify(e)],{type:"application/json"});if(!navigator.sendBeacon(this.url,t)){let s={status:"0",statusText:"Failed to send via sendBeacon"},n="Data Collector API Error: sendBeacon failed to send the data.";throw this._logger.warning([n,s]),new Wi({message:n,details:s,context:e})}}};T.class(La,{token:l.DATA_COLLECTOR_API,dependencies:[l.LOGGER],defaultAlias:"dataCollectorAPI"});var ci={ERROR:"analyticsError"};var St=class{beforeMessageSend(e,t){t(e)}};var fn=class fn extends St{beforeMessageSend(e,t){let{payload:i}=e;fn.propertiesToUnalias.forEach(s=>{i[s]&&(i[s]=X(i[s]))}),t()}};E(fn,"propertiesToUnalias",["bidder","bidderCode","adapterCode"]);var cn=fn;var un=class extends St{beforeMessageSend({payload:e},t){var i;(i=e.kvps)!=null&&i.length&&(e.kvps=e.kvps.map(([s,n])=>`[${s}=${n}]`)),t()}};var hn=class{constructor({logger:e,mainQueue:t,errorQueue:i,immediateQueue:s,beaconQueue:n,eventBus:o}){E(this,"_reportError",({payload:e})=>{var t;this._errorQueue.enqueue(new $({eventName:"MESSAGE_ERROR",eventType:(t=e.details)==null?void 0:t.status,data:{error:e.details,message:e.message,timestamp:new Date().toISOString()}}))});this._logger=e,this._logger.setContext(l.ANALYTICS),this._logger.setLevel(2),this._errorReportingEnabled=Math.random()<=.01,this._mainQueue=t,this._errorQueue=i,this._immediateQueue=s,this._beaconQueue=n,this._middlewares=[],this._eventBus=o,this._topicMap={[fe.ERROR]:this._errorQueue,[fe.BEACON]:this._beaconQueue,[fe.IMMEDIATE]:this._immediateQueue,[fe.MAIN]:this._mainQueue},this._errorReportingEnabled&&this._eventBus.subscribe(ci.ERROR,this._reportError),this._init()}_init(){this._logger.log(oi.INIT),this._mainQueue.start(),this._logger.log([oi.INIT_COMPLETE,"Queue processing started."])}addMiddleware(e){if(!(e instanceof St))throw new Error("Middleware must be an instance of AnalyticsMiddleware");this._middlewares.includes(e)||this._middlewares.push(e)}removeMiddleware(e){this._middlewares=this._middlewares.filter(t=>t!==e)}track(e){if(!e.type||!e.payload){this._logger.error("Invalid event type. event must be an instance of AnalyticsEvent.");return}let t=this._applyBeforeSendMiddleware(e);if(!t)return;(this._topicMap[t.topic]||this._topicMap[fe.MAIN]).enqueue(t)}_applyBeforeSendMiddleware(e){let t=this._middlewares.filter(i=>i.beforeMessageSend);if(!t.length)return e;try{let i=()=>{if(!t.length)return;t.shift().beforeMessageSend(e,i)};return i(),e}catch(i){return null}}};T.class(hn,{token:l.ANALYTICS,defaultAlias:"analytics",dependencies:[l.LOGGER,l.MAIN_QUEUE,l.ERROR_QUEUE,l.IMMEDIATE_QUEUE,l.BEACON_QUEUE,l.EVENT_BUS],factory:({dependencies:r})=>{let e=new hn(r);return e.addMiddleware(new cn),e.addMiddleware(new un),e}});var At=class{enqueue(){throw new Error("Method not implemented")}};var pn=class extends At{constructor({analyticsMessageFactory:t,eventBus:i,logger:s,api:n,batchLimit:o=30,intervalMs:a=500}){super();E(this,"_name","DelayedQueue");this._eventBus=i,this._logger=s,this._messageFactory=t,this._logger.setContext(`Analytics Queue: ${this._name}`),this._logger.setLevel(2),this._queue=[],this._api=n,this._intervalMs=a,this._batchLimit=o,this._isProcessing=!1,this._intervalId=null}enqueue(t){let i=this._queue[this._queue.length-1];if(i&&i.size<this._batchLimit){i.addEvent(t);return}this._queue.push(this._messageFactory.create({events:[t]}))}start(){this._processQueue(),this._intervalId=setInterval(()=>{this._processQueue()},this._intervalMs)}stop(){clearInterval(this._intervalId)}_processQueue(){return y(this,null,function*(){if(this._isProcessing)return;let t=this._queue.shift();if(t!=null&&t.size)try{this._isProcessing=!0,yield this._api.send(t.getJSON())}catch(i){this._logger.warning(["Failed to process queue",i]),this._eventBus.emit(ci.ERROR,i)}finally{this._isProcessing=!1}})}};var Qi=class extends At{constructor({analyticsMessageFactory:t,eventBus:i,logger:s,api:n,reportErrors:o=!0}){super();E(this,"_name","ImmediateQueue");this._eventBus=i,this._logger=s,this._messageFactory=t,this._logger.setContext(`Analytics Queue: ${this._name}`),this._logger.setLevel(2),this._queue=[],this._api=n,this._reportErrors=o,this._isProcessing=!1}enqueue(t){this._queue.push(this._messageFactory.create({events:[t]})),this._processQueue()}_processQueue(){return y(this,null,function*(){for(;this._queue.length;)try{let t=this._queue.shift();if(!(t!=null&&t.size))continue;yield this._api.send(t.getJSON())}catch(t){this._logger.warning(["Failed to process queue",t]),this._reportErrors&&this._eventBus.emit(ci.ERROR,t)}})}};var Ji=class extends At{constructor({analyticsMessageFactory:t,logger:i,api:s}){super();E(this,"_name","BeaconQueue");this._messageFactory=t,this._api=s,this._logger=i,this._logger.setContext(`Analytics Queue: ${this._name}`),this._logger.setLevel(2),this._queue=[]}enqueue(t){let i=this._messageFactory.create({events:[t]});this._sendBeacon(i)}_sendBeacon(t){try{this._api.sendBeacon(t.getJSON())}catch(i){this._logger.warning(["Failed to send beacon",i])}}};var Ua=[l.EVENT_BUS,l.LOGGER,{token:l.DATA_COLLECTOR_API,alias:"api"},l.ANALYTICS_MESSAGE_FACTORY],gn=class extends pn{constructor(){super(...arguments);E(this,"_name",l.MAIN_QUEUE)}},mn=class extends Qi{constructor(){super(...arguments);E(this,"_name",l.IMMEDIATE_QUEUE)}};T.class(gn,{token:l.MAIN_QUEUE,defaultAlias:"mainQueue",dependencies:Ua,factory:({dependencies:r})=>new gn(L(A({},r),{batchLimit:30,intervalMs:500}))});T.class(mn,{token:l.ERROR_QUEUE,defaultAlias:"errorQueue",dependencies:Ua,factory:({dependencies:r})=>new mn(L(A({},r),{reportErrors:!1}))});T.class(Qi,{token:l.IMMEDIATE_QUEUE,defaultAlias:"immediateQueue",dependencies:Ua});T.class(Ji,{token:l.BEACON_QUEUE,defaultAlias:"beaconQueue",dependencies:[l.ANALYTICS_MESSAGE_FACTORY,l.LOGGER,l.EVENT_BUS,{token:l.DATA_COLLECTOR_API,alias:"api"}],factory:({dependencies:r})=>new Ji({analyticsMessageFactory:r.analyticsMessageFactory,api:r.api,eventBus:r.eventBus,logger:r.logger})});var zf=Rt(uf()),Yf=Rt(pf()),$f=Rt(Uo());var Se={ALL_DISABLED:"disabled",ALL_ENABLED:"enabled",PARTNER_ONLY:"partner-only",TEST_PARTNERS:"test"},In={criteo:{itfPosition:0,itfTestPercent:.95,enabled:void 0},uid2:{itfPosition:1,itfTestPercent:.95,enabled:void 0},fabrickId:{itfPosition:2,itfTestPercent:.95,enabled:void 0},hadronId:{itfPosition:3,itfTestPercent:.95,enabled:void 0},id5Id:{itfPosition:4,itfTestPercent:.95,enabled:void 0},pairId:{itfPosition:5,itfTestPercent:.95,enabled:void 0},"33acrossId":{itfPosition:6,itfTestPercent:.95,enabled:void 0},sharedId:{itfPosition:7,itfTestPercent:.95,enabled:void 0},connectid:{itfPosition:8,itfTestPercent:.95,enabled:void 0},identityLink:{itfPosition:9,itfTestPercent:.95,enabled:void 0},liveIntentId:{itfPosition:11,itfTestPercent:.95,enabled:void 0},unifiedId:{itfPosition:12,itfTestPercent:.95,enabled:void 0},intentIqId:{itfPosition:13,itfTestPercent:.95,enabled:!0},carbon:{itfPosition:14,itfTestPercent:.95,enabled:void 0},airgrid:{itfPosition:15,itfTestPercent:.95,enabled:void 0},linkedInAdsId:{itfPosition:16,itfTestPercent:.95,enabled:void 0},symitri:{itfPosition:17,itfTestPercent:.95,enabled:void 0},gamera:{itfPosition:18,itfTestPercent:.95,enabled:void 0},optable:{itfPosition:19,itfTestPercent:.95,enabled:void 0}},gf=.01,mf=.01,_f=.01,Ef=` @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap'); .__fs-modal__overlay { position: absolute; z-index: 10000; top: 0; right: 0; bottom: 0; left: 0; background-color: rgba(255,255,255,0.75); display: flex; align-items: center; justify-content: center; } .__fs-modal { font-family: 'Varela Round', sans-serif !important; font-size: 16px; width: 45vw; border-radius: 5px; background-color: white; box-shadow: 0 10px 25px 0 rgb(0 195 137 / 50%); border: 1px solid rgb(0 195 137); } .__fs-modal__content { margin: 1rem; padding: 1rem; height: calc(100% - 2rem); } .__fs-modal__header { width: 100%; text-align: left; font-size: 2rem; } h2.__fs-modal__header { border-bottom: 3px solid rgb(0 195 137); margin-bottom: 1rem; } h3.__fs-modal__header { font-size: 1.5rem; } .__fs-modal__description { width: 100%; font-size: 1rem; margin-bottom: .75rem; } .__fs-modal__content span { width: 100%; font-size: 1.25rem; display: flex; align-items: center; justify-content: space-between; } .__fs-modal__content span input, .__fs-modal__content span button { width: 100%; font-size: 1.25em; padding: .25rem; } .__fs-modal__content span button { border: 0; border-radius: 5px; background-color: rgb(0 195 137); color: white; font-family: 'Varela Round', sans-serif !important; } @media only screen and (min-device-width : 320px) and (max-device-width : 768px) { .__fs-modal { width: 100vw; border-radius: 0; background-color: white; box-shadow: initial; border: 0; position: fixed; top: 0; bottom: 0; } } `,If=`<div class="__fs-modal"><form class="__fs-modal__content"><h2 class="__fs-modal__header">Welcome!</h2><p class="__fs-modal__description">Our trusted advertising partners using the UID identifier and/or encrypted email addresses are committed to delivering relevant advertising that also respects your choice. Advertising enables access to your favorite content across the internet.</p><h3 class="__fs-modal__header">Opt-Out</h3><p class="__fs-modal__description">Your choice to Opt-Out will indicate to trusted advertising partners that you no longer wish to receive targeted advertising based on your UID/email. The scope of this Opt-Out is limited to this site which use UID/email. For choice with respect to advertising based on cookies, please visit https://optout.aboutads.info. To opt out of UID across all sites please visit <a href="https://transparentadvertising.org/" target="_blank">https://transparentadvertising.org/</a></p><p class="__fs-modal__description">Note: this choice may limit your ability to access ad supported content. You may be asked to Opt-In again in the future to access such content.</p><span><button type="submit" id="__fs-model__submit">OPT OUT</button>&nbsp; <button id="__fs-model__cancel">CANCEL</button></span></form></div>`,kp="serverPublicKey",Up="subscriptionId",Sf="emailHash",Af=[kp,Up],yf="fs_liveintent",bf="liveIntentId",Ga=.95,fi="carbon",Tf="4d97a662ad",Zi="airgrid",wf="PV483g",Rf="FpZbsa",vf="cdeffa51-8532-473f-8ba0-200d751fd73e",Of="https://pb-ing.ccgateway.net",Fa={PARENT_ID:"parentId",ENDPOINT:"endpoint",ANALYTICS_ENDPOINT:"analyticsEndpoint"},Xi="hadronId",Va=474;var et="symitri",Cf="freestar.dap.symitri.net",Df="x1",Pf="compositeid",Nf="HEM:",Mf=708,xf="https://prodsymitriapp.azurewebsites.net/v1/impression",Ae="gamera",Lf=[Zi,fi,et,Ae],U={FABRICK_ID:"fabrickId",CONNECT_ID:"connectid",ID5_ID:"id5Id",LIVEINTENT_ID:"liveIntentId",UID2:"uid2",IDENTITY_LINK:"identityLink",AMAZON:"amazon",CRITEO:"criteo",OPTABLE:"optable"},Bf=40,kf=64,Uf=32,Gf=2,Ff=106,er="optable",Vf="https://freestar.solutions.cdn.optable.co/public-assets/freestar-sdk.js",tr="intentIqId",Hf="https://a.pub.network/core/intentIQ/20250618/IIQUniversalID.js",MO=U.CONNECT_ID;var qe=class{static normalizeEmail(e){if(!(e!=null&&e.length))return;let t=e.trim().toLowerCase();if(t.includes(" "))return;let i=this.splitEmailIntoAddressAndDomain(t);if(!i)return;let{address:s,domain:n}=i,o=this.isGmail(n),a=this.normalizeAddressPart(s,o,o);return a?`${a}@${n}`:void 0}static bytesToBase64(e){let t=Array.from(e,i=>String.fromCodePoint(i)).join("");return btoa(t)}static hashUID2(e){let t=new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(i){return parseInt(i,16)}));return this.bytesToBase64(new Uint8Array(t))}static splitEmailIntoAddressAndDomain(e){let t=e.split("@");if(!(t.length!==2||t.some(i=>i==="")))return{address:t[0],domain:t[1]}}static isGmail(e){return e===this.GMAIL_DOMAIN}static dropExtension(e){return e.split(this.EMAIL_EXTENSION_SYMBOL)[0]}static normalizeAddressPart(e,t,i){let s=e;return t&&(s=dl(s,this.EMAIL_DOT,"")),i&&(s=this.dropExtension(s)),s}};E(qe,"EMAIL_EXTENSION_SYMBOL","+"),E(qe,"EMAIL_DOT","."),E(qe,"GMAIL_DOMAIN","gmail.com");var Ha=(r,e,t)=>(r==null?void 0:r.length)===e?{[t]:r}:{},qf=r=>{let e=A(A(A({},Ha(r==null?void 0:r.sha256,kf,"sha256")),Ha(r==null?void 0:r.sha1,Bf,"sha1")),Ha(r==null?void 0:r.md5,Uf,"md5"));return e.sha256||console.warn("Limited support with ID partners due to invalid sha256",r==null?void 0:r.sha256),e};var qa=class{constructor({identityConfig:r,hashedEmailProviderManager:e,realtimeProvidersManager:t,logger:i,analytics:s,gamManager:n,win:o=window}){E(this,"targeting","----------------------------------------");E(this,"hashedEmailsPassed",!1);E(this,"messageSent",!1);E(this,"prebidNonRealTimeProvidersConfig",null);this._window=o,this._gamManager=n,this._identityConfig=r,this._analytics=s,this._logger=i,this._logger.setContext(l.IDENTITY_MANAGER),this.hashedEmailProviders=e,this.realtimeProviders=t,this._populatePrebidNonRealTimeProvidersConfig(),this._initializeLiveIntentHIRO()}init(){var r;this._logger.log((r=this._identityConfig.identityProviders)!=null&&r.length?`Eligible providers: ${this._identityConfig.identityProviders.map(e=>e.slug)}`:"No Eligible Providers"),this.hashedEmailProviders.initializeProviders(),this.realtimeProviders.loadScripts(),this._createTargeting(),this._logger.log(`Targeting: ${JSON.stringify(this.targeting)}`),this._setGamTargeting(),this._sendEventMessages(this._identityConfig.providersRules)}_hasIdentitySet(){return!!this._identityConfig.identityData&&!!Object.keys(this._identityConfig.identityData).length}setIdentity({email:r,hashes:e}={}){return r||e?(r&&cf({email:r})&&this._setIdentityFromEmail(r),e&&this._setIdentityFromHashes(e),this._sendEventMessages(this._identityConfig.providersRules),!0):(this._logger.error("setIdentity requires at least one parameter: email or hashes"),!1)}_updateProviders(r){this.hashedEmailProviders.updateAllProviders(r,!1)}_setIdentityFromHashes(r){let e=qf(r);if(!Object.keys(e).length)return console.warn("Invalid hashes: ",r),!1;this._identityConfig.setIdentityData(e),this._updateProviders(e)}_setIdentityFromEmail(r){let e=qe.normalizeEmail(r),t={sha256:(0,zf.default)(e).toString(),sha1:(0,Yf.default)(e).toString(),md5:(0,$f.default)(e).toString()};this._identityConfig.setIdentityData(t),this._updateProviders(t)}showModal(){df(Ef);let r=F({classList:["__fs-modal__overlay"]});r.innerHTML=If,this._window.document.body.appendChild(r);let e=this._window.document.getElementById("__fs-model__submit"),t=this._window.document.getElementById("__fs-model__cancel");e.onclick=i=>y(this,null,function*(){i.preventDefault(),this._identityConfig.removeIdentityDataFromSessionStorage(),this.hashedEmailProviders.updateAllProviders({},this._identityConfig.testGroup,!1),r.remove(),Te({name:"identityModalOptOut",detail:!0})}),t.onclick=i=>{i.preventDefault(),r.remove(),Te({name:"identityModalClosed",detail:!0})}}addOptOut({selector:r="#freestarOptOutLink",element:e=!1}){if(e=e!=null?e:document.querySelector(r),!e)return!1;e.onclick=t=>{t.preventDefault(),this.showModal()}}_createTargeting(){if(this._identityTrackingDisabled){this.targeting="0";return}let r=this._identityConfig.identityProviders.filter(({slug:e})=>e).map(({slug:e})=>e.toLowerCase());Object.entries(this._identityConfig.providersRules).forEach(([e,t])=>{var i;if((r.includes(e.toLowerCase())||e==="gamera")&&typeof t.enabled=="boolean"){let s=this.targeting.split("");s[t.itfPosition]=t.enabled?(i=t.itfValue)!=null?i:"Y":"N",this.targeting=s.join("")}})}_setGamTargeting(){if(this._gamManager.setGlobalTargeting(K.ITF,this.targeting),this.targeting==="0")return;let r=In[bf].itfPosition||-1,e=this.targeting.length>0&&this.targeting[r];["Y","N"].includes(e)&&this._gamManager.setGlobalTargeting(yf,e)}get _identityTrackingDisabled(){return!(this._identityConfig.itfY||this._identityConfig.itf_n)&&this._identityConfig.testGroup===Se.ALL_DISABLED}_normalizeStorageConfig(config={}){let{refreshInSeconds,expires}=config!=null?config:{};try{return L(A({},config),{refreshInSeconds:eval(refreshInSeconds),expires:eval(expires)})}catch(r){return config}}_populatePrebidNonRealTimeProvidersConfig(){if(this._identityTrackingDisabled)return[];this.prebidNonRealTimeProvidersConfig=this._identityConfig.identityProviders.filter(({slug:r})=>!Lf.includes(r)&&this._identityConfig.checkIfProviderEnabled(r)&&this._identityConfig.checkIfProviderIsAllowedInGeo(r)&&er!==r&&tr!==r).map(({slug:r,params:e,storage:t})=>{var s,n,o,a,d,c,u,f;let i=A(A({name:r},Object.keys(e||{}).length!==0?{params:e}:{}),Object.keys(t||{}).length!==0?{storage:A({},this._normalizeStorageConfig(t))}:{});switch(r){case"uid2":if((s=this._identityConfig.identityData)!=null&&s.sha256){let p=this.hashedEmailProviders.getProviderConfigByName(r,this._identityConfig.identityData);i.params=Object.assign(i.params,p.params)}break;case"merkleId":i.params=Object.assign(i.params,{sv_domain:window.location.hostname});break;case"pairId":if((n=i.params)!=null&&n.liveramp){let p=po("liveramp",i.params);i.params=Object.assign(i.params,{liveramp:p})}break;case"liveIntentId":if((o=i.params)!=null&&o.requestedAttributesOverrides){let p=po("requestedAttributesOverrides",i.params);if(typeof p=="object"&&!Array.isArray(p)&&p!==null&&Object.keys(p).forEach(h=>{let m=["nonId","uid2","medianet","magnite","bidswitch","pubmatic","openx","sovrn","index","thetradedesk","triplelift","vidazoo","sonobi","sharethrough","nexxen"];p[h]=m.includes(h)&&p[h]==="true"}),i.params=Object.assign(i.params,{requestedAttributesOverrides:p}),(a=this._identityConfig.identityData)!=null&&a.sha1||(d=this._identityConfig.identityData)!=null&&d.md5){let h=this.hashedEmailProviders.getProviderConfigByName(r,this._identityConfig.identityData);h.emailHash&&(i.params.emailHash=h.params.emailHash)}}break;case"connectid":if((c=this._identityConfig.identityData)!=null&&c.sha256){let p=this.hashedEmailProviders.getProviderConfigByName(r,this._identityConfig.identityData);i.params=Object.assign(i.params,p.params)}else{let{pixelId:p}=i.params||{};if(!p)break;let h=G({key:"fs.config",type:k.object.type}),m=h==null?void 0:h.fsuid,S=A({pixelId:p},m?{puid:m}:{});Object.assign(i.params,S)}break;case U.FABRICK_ID:if((u=this._identityConfig.identityData)!=null&&u.sha256){let p=this.hashedEmailProviders.getProviderConfigByName(r,this._identityConfig.identityData);i.params=Object.assign(i.params,p.params)}break;case U.ID5_ID:if((f=this._identityConfig.identityData)!=null&&f.sha256){let p=this.hashedEmailProviders.getProviderConfigByName(r,this._identityConfig.identityData);i.params=Object.assign(i.params,p.params)}break}return i})}_sendEventMessages(r){var i,s;let e={};r&&typeof r=="object"&&!Array.isArray(r)&&(e=Object.keys(r).reduce((n,o)=>(r[o].enabled?n.available.push(o):n.unavailable.push(o),n),{available:[],unavailable:[]}));let t=e&&(((i=e.available)==null?void 0:i.length)||((s=e.unavailable)==null?void 0:s.length));!this.messageSent&&this._hasIdentitySet()&&t&&(e.hemsAvailability=this.hashedEmailProviders.getHashesSentByProvider(),this._logger.log(`HEM types sent: ${JSON.stringify(e.hemsAvailability)}`),this._analytics.track(new $({eventType:"IDENTITY",eventName:"HASHED_EMAIL_PROVIDERS",data:e})),this.messageSent=!0)}_initializeLiveIntentHIRO(){this._window.liModuleEnabled===void 0&&(this._window.liModuleEnabled=Math.random()<Ga,this._window.liTreatmentRate=Ga)}};T.class(qa,{token:l.IDENTITY_MANAGER,dependencies:[l.IDENTITY_CONFIG,l.HASHED_EMAIL_PROVIDERS,l.REALTIME_PROVIDERS,l.LOGGER,l.ANALYTICS,l.OPTABLE_MANAGER,l.IIQ_MANAGER,l.GAM_MANAGER,{token:"window",alias:"win"}]});var Sn=class{constructor({dispensaryData:e,logger:t,identityConfig:i,prebidManager:s,gamManager:n,win:o=window}){E(this,"_atsKey","ats");E(this,"version",2);E(this,"atsEnabled",!1);this._window=o,this._identityConfig=i,this._dispensaryData=e,this._prebidManager=s,this._gamManager=n,this._instance=null,this._logger=t,this._lastATSIdentityData=null,this._logger.setContext(l.ATS_MANAGER),this._init()}_init(){if(!this._identityConfig.checkIfProviderEnabled(U.IDENTITY_LINK)||!this._isGeoAllowed)return;this.atsEnabled=this._dispensaryData.fsdata.atsEnabledV2,this.atsEnabled&&(this._gamManager.instance.pubads().setTargeting("atsd",[]),this._loadScript()),(this._dispensaryData.fsdata.atsAnalyticsEnabled!==null&&this._dispensaryData.fsdata.atsAnalyticsEnabled!==void 0?this._dispensaryData.fsdata.atsAnalyticsEnabled:this._dispensaryData.fsdata.atsEnabledV2)&&this._enablePrebidAnalytics()}get _isGeoAllowed(){var t;let e=(t=this._dispensaryData.locData)==null?void 0:t.iso;return e?this._identityConfig.checkIfProviderIsAllowedInGeo(U.IDENTITY_LINK)?!0:(this._logger.log(`LiveRamp ATS does not run for users in ${e}.`,{level:10}),!1):(this._logger.log("LiveRamp ATS does not run for users "+(e?`in ${e}.`:"without location data."),{level:10}),!1)}getConfigV2(){let e=this._identityConfig.identityData;return e?{id:Object.values(e),type:"emailHashes"}:{}}_enablePrebidAnalytics(){var i,s;let e=this._identityConfig.identityProviders.find(n=>n.id===Gf),t=(s=(i=e==null?void 0:e.params)==null?void 0:i.pid)!=null?s:Ff;this._prebidManager.instance.enableAnalytics([{provider:"atsAnalytics",options:{pid:t}}])}get _atsURL(){return`https://launchpad-wrapper.privacymanager.io/${this._dispensaryData.fsdata.atsV2ConfigUUID}/launchpad-liveramp.js`}_loadScript(){ge(this._atsURL,()=>{ti({getIsFound:()=>{var e;return!!((e=this._window[this._atsKey])!=null&&e.setAdditionalData)},callback:()=>{this._instance=this._window[this._atsKey],this.setConfig()},timeout:60*1e3})})}_hasValidIdentityData(e){return!e||Object.keys(e).length===0?!1:e.id&&(Array.isArray(e.id)?e.id.length>0:e.id.trim()!=="")}setConfig(){var t;let e=this.getConfigV2();if(!this._hasValidIdentityData(e)){this._logger.log(["Skipping LiveRamp ATS setAdditionalData - no meaningful identity data:",e],{level:10});return}if(this._lastATSIdentityData&&JSON.stringify(this._lastATSIdentityData)===JSON.stringify(e)){this._logger.log("Skipping LiveRamp ATS setAdditionalData - identity data unchanged",{level:10});return}this._logger.log("LiveRamp ATS setAdditionalData called with identity data",{level:10}),(t=this._instance)==null||t.setAdditionalData(e),this._lastATSIdentityData=e}};T.class(Sn,{token:l.ATS_MANAGER,dependencies:[l.DISPENSARY_DATA,{token:"window",alias:"win"},l.LOGGER,l.IDENTITY_CONFIG,l.PREBID_MANAGER,l.GAM_MANAGER],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,new Sn(A({},r))})});var De=Object.freeze({SHA256:"sha256",SHA1:"sha1",MD5:"md5"});var An=class{constructor({identityConfig:e,dispensaryData:t,atsManager:i,prebidManager:s,amazonManager:n,win:o=window}){this._prebid=s,this._amazon=n,this._ats=i,this._identityConfig=e,this._dispensaryData=t,this._window=o,this._hashesSentByProvider={}}_recordHashSent(e,t){this._hashesSentByProvider[e]||(this._hashesSentByProvider[e]=new Set),this._hashesSentByProvider[e].add(t)}getProviderConfigByName(e,t={}){switch(e){case U.FABRICK_ID:return this._getFabrickConfig(t);case U.CONNECT_ID:return this._getYahooConfig(t);case U.ID5_ID:return this._getID5Config(t);case U.LIVEINTENT_ID:return this._getLiveIntentConfig(t);case U.UID2:return this._getUid2Config(t);case U.CRITEO:return this._getCriteoConfig(t);default:return{}}}getHashesSentByProvider(){let e={};for(let[t,i]of Object.entries(this._hashesSentByProvider))e[t]=Array.from(i).sort();return e}_resetHashesSentByProvider(){this._hashesSentByProvider={}}updateAllProviders(e={},t){if(!(!this._identityConfig.testGroup||this._identityConfig.testGroup===Se.ALL_DISABLED)){if(this._resetHashesSentByProvider(),this._identityConfig.checkIfProviderEnabled(U.AMAZON)&&this._hasSha256(e)&&this._amazon.isEnabled&&this._updateAmazon(e,t),this._identityConfig.checkIfProviderEnabled(U.IDENTITY_LINK)&&this._updateATS(),this._identityConfig.checkIfProviderEnabled(U.FABRICK_ID)&&this._updatePrebidUserSyncConfig(this._getFabrickConfig(e)),this._identityConfig.checkIfProviderEnabled(U.CONNECT_ID)&&this._updatePrebidUserSyncConfig(this._getYahooConfig(e)),this._identityConfig.checkIfProviderEnabled(U.ID5_ID)&&this._updatePrebidUserSyncConfig(this._getID5Config(e)),this._identityConfig.checkIfProviderEnabled(U.LIVEINTENT_ID)&&this._updatePrebidUserSyncConfig(this._getLiveIntentConfig(e)),this._identityConfig.checkIfProviderEnabled(U.UID2)&&this._updatePrebidUserSyncConfig(this._getUid2Config(e)),this._identityConfig.checkIfProviderEnabled(U.CRITEO)){let i=this._getCriteoConfig(e);i&&this._prebid.instance.setBidderConfig(i,!0)}if(this._identityConfig.checkIfProviderEnabled(U.OPTABLE)){let i=this._getOptableConfig(e);if(i)try{window.optable=window.optable||{cmd:[]},window.optable.cmd.push(()=>{var s,n;(n=(s=window.optable)==null?void 0:s.freestar_auth)==null||n.identify("e:"+i)})}catch(s){console.warn(s)}}this._prebid.instance.refreshUserIds()}}initializeProviders(){if(this._hasSha256(this._identityConfig.identityData)&&this._identityConfig.testGroup!==Se.ALL_DISABLED&&this._amazon.isEnabled&&this._initializeAmazon(this._identityConfig.identityData),this._identityConfig.checkIfProviderEnabled(U.CRITEO)){let e=this._getCriteoConfig(this._identityConfig.identityData);e&&this._prebid.instance.setBidderConfig(e,!0)}}_hasSha256(e){return typeof(e==null?void 0:e.sha256)!="undefined"}_initializeAmazon(e){var t;(t=this._amazon.instance)==null||t.renewId({hashedRecords:[{type:"email",record:e.sha256}]})}_getConfigBySlug(e){return this._identityConfig.identityProviders.find(({slug:t})=>t===e)}_getCriteoConfig(e){if(e!=null&&e.sha256||e!=null&&e.md5){e!=null&&e.sha256&&this._recordHashSent(U.CRITEO,De.SHA256),e!=null&&e.md5&&this._recordHashSent(U.CRITEO,De.MD5);try{return{bidders:["criteo"],config:{ortb2:{user:{ext:{data:{eids:[{source:this._window.location.hostname,uids:[...e.md5?[{id:e.md5,atype:3,ext:{stype:"hemmd5"}}]:[],...e.sha256?[{id:e.sha256,atype:3,ext:{stype:"hemsha256"}}]:[]]}]}}}}}}}catch(t){return}}}_getFabrickConfig(e){if(this._dispensaryData.locData.iso){let i=this._getConfigBySlug(U.FABRICK_ID);if(this._hasSha256(e)&&i)return this._recordHashSent(U.FABRICK_ID,De.SHA256),{name:U.FABRICK_ID,params:L(A({},i.params),{e:e.sha256}),storage:i.storage}}return{}}_getYahooConfig(e){let t=this._getConfigBySlug(U.CONNECT_ID),i=G({key:"fs.config",type:k.object.type}),s=i&&i.fsuid?i.fsuid:void 0;return this._hasSha256(e)&&t?(this._recordHashSent(U.CONNECT_ID,De.SHA256),{name:t.slug,params:A(L(A({},t.params),{he:e.sha256}),s?{puid:s}:{}),storage:t.storage}):{}}_getID5Config(e){var i,s;let t=(s=(i=this._getConfigBySlug(U.ID5_ID))==null?void 0:i.params)==null?void 0:s.partner;if(this._hasSha256(e)&&t){this._recordHashSent(U.ID5_ID,De.SHA256);let n={1:e.sha256},o=Object.keys(n).map(d=>d+"="+n[d]).join("&"),a=btoa(o);return{name:U.ID5_ID,params:{partner:t,pd:a}}}return{}}_getLiveIntentConfig(e){var s,n;let t=this._getConfigBySlug(U.LIVEINTENT_ID),i=(n=(s=e==null?void 0:e.sha1)!=null?s:e==null?void 0:e.sha256)!=null?n:e==null?void 0:e.md5;if(typeof i!="undefined"&&t){e.sha1?this._recordHashSent(U.LIVEINTENT_ID,De.SHA1):e.sha256?this._recordHashSent(U.LIVEINTENT_ID,De.SHA256):e.md5&&this._recordHashSent(U.LIVEINTENT_ID,De.MD5);try{return{name:U.LIVEINTENT_ID,params:L(A({},t.params),{emailHash:i}),storage:t.storage}}catch(o){return{}}}return{}}_getUid2Config(e){let t=this._getConfigBySlug(U.UID2);return!Af.every(s=>!!(t!=null&&t.params[s]))||!this._hasSha256(e)?{}:(this._recordHashSent(U.UID2,De.SHA256),{name:U.UID2,params:L(A({},t.params),{[Sf]:qe.hashUID2(e.sha256)}),storage:t.storage})}_getOptableConfig(e){return this._hasSha256(e)?(this._recordHashSent(U.OPTABLE,De.SHA256),e.sha256):null}_updatePrebidUserSyncConfig(e){if(Object.keys(e).length===0)return;let t=this._prebid.instance.getConfig("userSync"),i=t.userIds.find(({name:s})=>s.toLowerCase()===e.name.toLowerCase());if(i){let s=t.userIds.filter(({name:n})=>n.toLowerCase()!==e.name.toLowerCase());t.userIds=[...s,A(A({},i),e)],this._prebid.instance.mergeConfig({userSync:t})}}_updateAmazon(e,t){var i;this._recordHashSent(U.AMAZON,De.SHA256),(i=this._amazon.instance)==null||i.updateId({optOut:t,hashedRecords:[{type:"email",record:e.sha256}]})}_updateATS(){this._window.addEventListener("pairIdEnvelopePresent",()=>{this._prebid.instance.refreshUserIds()}),this._window.addEventListener("lrEnvelopePresent",()=>{this._prebid.instance.refreshUserIds()}),this._ats.setConfig()}};T.class(An,{token:l.HASHED_EMAIL_PROVIDERS,dependencies:[l.IDENTITY_CONFIG,l.DISPENSARY_DATA,l.ATS_MANAGER,l.PREBID_MANAGER,l.AMAZON_MANAGER,{token:"window",alias:"win"}],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,new An(r)})});var yn=class{constructor({identityConfig:e,dispensaryData:t,prebidManager:i,logger:s,win:n=window}){E(this,"HADRON_NAME","_hadron");E(this,"HADRON_SRC","https://cdn.hadronid.net/hadron.js");E(this,"GAMERA_SRC","https://metrics.rapidedge.io/gamera.js?ltv=1&audience=1&tpcs=1&partner=freestar");E(this,"prebidAnalyticProviders",[]);E(this,"prebidRealTimeDataProviders",[]);this._window=n,this._logger=s,this._logger.setContext(l.REALTIME_PROVIDERS),this._identityConfig=e,this._prebidManager=i,this._dispensaryData=t,this._carbonInit(),this._hadronInit(),this._airgridInit(),this._permutiveInit(),this._gameraInit()}_getIdentityProviderConfigBySlug(e){return this._identityConfig.identityProviders.find(t=>(t==null?void 0:t.slug)===e)}_getConfigValue(e,t){if(e.params=e.params||{},!(nt(e.params[t])||e.params[t]===""))return e.params[t]}_getConfigValueOrDefault(e,t,i){return this._getConfigValue(e,t)||i}_getHadronId(e,t){let i=this._getConfigValue(e,"partnerId");return nt(i)||Number.isNaN(i)?t:typeof i!="number"&&!Number.isNaN(Number(i))?Number(i):i}_getUserIdValue(e,t){var i,s,n,o,a,d,c,u;if(this._identityConfig.checkIfProviderEnabled(e)&&this._identityConfig.checkIfProviderIsAllowedInGeo(e)){let f=(a=(o=(n=(s=(i=this._prebidManager.instance.getConfig())==null?void 0:i.userSync)==null?void 0:s.userIds)==null?void 0:n.find(({name:p})=>p===e))==null?void 0:o.storage)==null?void 0:a.name;return f?t?(c=(d=this._prebidManager.instance.getUserIds())==null?void 0:d[f])==null?void 0:c[t]:(u=this._prebidManager.instance.getUserIds())==null?void 0:u[f]:null}}_loadHadronScript(){let e=this._getIdentityProviderConfigBySlug(Xi);if(!(e&&this._identityConfig.checkIfProviderEnabled(Xi)))return;let t=this._getConfigValueOrDefault(e,"partnerId",Va);(function(i,s,n,o,a,d,c){i[d]=i[d]||function(){(i[d].q=i[d].q||[]).push(arguments)},i[d]({config:{dm:c}});let u=s.createElement(n);s.async=!0,u.src=o+"?url="+encodeURIComponent(i.location.href)+"&ref="+encodeURIComponent(s.referrer)+"&_it=freestar&partner_id="+a+"&ha="+d;let f=s.getElementsByTagName(n)[0];f.parentNode.insertBefore(u,f)})(window,document,"script",this.HADRON_SRC,t,this.HADRON_NAME,!0)}_carbonInit(){let e=this._getIdentityProviderConfigBySlug(fi);if(!e||!this._identityConfig.checkIfProviderEnabled(fi)||!this._identityConfig.checkIfProviderIsAllowedInGeo(fi))return;let t=this._getConfigValueOrDefault(e,Fa.PARENT_ID,Tf);if(!t)return;let i=this._getConfigValueOrDefault(e,Fa.ANALYTICS_ENDPOINT,Of);this.prebidAnalyticProviders.push({provider:fi,options:{parentId:t,endpoint:i}})}_hadronInit(){let e=this._getIdentityProviderConfigBySlug(Xi);if(e&&this._identityConfig.checkIfProviderEnabled(Xi)){let t=this._getHadronId(e,"partnerId")||Va;t&&this.prebidRealTimeDataProviders.push({name:"hadron",waitForIt:!0,params:{partnerId:t}})}}_airgridInit(){let e=this._getIdentityProviderConfigBySlug(Zi);if(e&&this._identityConfig.checkIfProviderEnabled(Zi)){let t=this._getConfigValueOrDefault(e,"accountId",wf),i=this._getConfigValueOrDefault(e,"publisherId",Rf),s=this._getConfigValueOrDefault(e,"apiKey",vf),n={name:Zi,waitForIt:!0,params:{apiKey:s,accountId:t,publisherId:i}},o=this._getConfigValue(e,"bidders");o&&(n.params.bidders=o.split(",").map(a=>a.trim())),this.prebidRealTimeDataProviders.push(n)}}_permutiveInit(){this._dispensaryData.fsdata.permutiveEnabled&&this.prebidRealTimeDataProviders.push({name:"permutive",waitForIt:!0,params:{acBidders:[this._dispensaryData.fsdata.permutiveBidders.split(",")]}})}get waitForUserSync(){return!!(this._getIdentityProviderConfigBySlug(et)&&this._identityConfig.checkIfProviderEnabled(et)&&this._identityConfig.checkIfProviderIsAllowedInGeo(et))}_symitriInit(){let e=this._getIdentityProviderConfigBySlug(et);if(!e||!this._identityConfig.checkIfProviderEnabled(et)||!this._identityConfig.checkIfProviderIsAllowedInGeo(et))return;let t=this._getConfigValueOrDefault(e,"apiHostname",Cf),i=this._getConfigValueOrDefault(e,"apiVersion",Df),s=this._getConfigValueOrDefault(e,"segtax",Mf),n=this._getConfigValueOrDefault(e,"pixelUrl",xf).trim(),o={},a=this._identityConfig.identityData;a!=null&&a.sha256&&(o.HEM=a==null?void 0:a.sha256);let d=this._getUserIdValue(U.ID5_ID,"uid");d&&(o.ID5=d);let c=this._getUserIdValue(U.IDENTITY_LINK);c&&(o.RampId=c);let u=Object.keys(o).reduce((p,h)=>(p.push(`${h}:${o[h]}`),p),[]).join(","),f={name:`${et}Dap`,waitForIt:!0,params:{apiHostname:t.trim(),apiVersion:i,domain:this._dispensaryData.fsdata.domain,segtax:s,pixelUrl:n,identityType:Pf,identityValue:u||Nf}};this.prebidRealTimeDataProviders.push(f)}_gameraInit(){if(!this._getIdentityProviderConfigBySlug(Ae)||!this._identityConfig.checkIfProviderEnabled(Ae)||!this._identityConfig.checkIfProviderIsAllowedInGeo(Ae))return;let t={name:Ae,waitForIt:!0};this.prebidRealTimeDataProviders.push(t)}_loadGameraScript(){if(!this._getIdentityProviderConfigBySlug(Ae)||!this._identityConfig.checkIfProviderEnabled(Ae)||!this._identityConfig.checkIfProviderIsAllowedInGeo(Ae))return;let t=document.createElement("script");t.src=this.GAMERA_SRC,t.type="text/javascript",t.async=!0,t.id="__gamera__",document.body.appendChild(t)}loadScripts(){this._loadHadronScript(),this._loadGameraScript()}getRtdProvidersConfig(){return this._symitriInit(),this.prebidRealTimeDataProviders}};T.class(yn,{token:l.REALTIME_PROVIDERS,dependencies:[l.IDENTITY_CONFIG,l.DISPENSARY_DATA,l.PREBID_MANAGER,l.LOGGER,{token:"window",alias:"win"}],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,new yn(r)})});var za=class{constructor({dispensaryData:e,logger:t}){E(this,"providersRules",[]);this._dispensaryData=e,this._logger=t,this._logger.setContext(l.IDENTITY_CONFIG),this.itfY=B("itf_y"),this.itf_n=B("itf_n"),this.identityData=this.identityDataFromSessionStorage,this.partnerOnlyTrafficPercentage=this.identityProviders.length*gf,this.testTrafficPercentage=1-mf-this.partnerOnlyTrafficPercentage,this._populateIdentityTestGroup(),this._populateProviderRules()}get identityProviders(){return this._dispensaryData.fsdata.identityProviders||[]}get identityDataFromSessionStorage(){return G({key:ln,type:k.object.type})}setIdentityData(e){this.identityData=e,ee({key:ln,value:e,type:k.object})}removeIdentityDataFromSessionStorage(){this.identityDataFromSessionStorage&&(Br({key:ln}),this.identityData=null)}checkIfProviderEnabled(e){var t;return!this.providersRules[e]||((t=this.providersRules[e])==null?void 0:t.enabled)!==!1}checkIfProviderIsAllowedInGeo(e){var o,a;let t=(a=(o=this._dispensaryData)==null?void 0:o.locData)==null?void 0:a.iso;if(!t)return!1;let i=this.identityProviders.find(({slug:d})=>d===e);if(!i)return!1;let{disallowedGeos:s,allowedGeos:n}=i;return s!=null&&s.length?!s.includes(t):n!=null&&n.length?n.includes(t):!0}_populateProviderRules(){try{this.providersRules=JSON.parse(atob(G({key:Na,type:k.string.type})))}catch(e){this._getProvidersRulesByTestGroup()}this._updateProvidersRulesByUrlParams()}_getProvidersRulesByTestGroup(){let t={[Se.TEST_PARTNERS]:!0,[Se.PARTNER_ONLY]:!1,[Se.ALL_DISABLED]:!1}[this.testGroup];this.providersRules=this._getDefaultProviderRules(t),this.testGroup===Se.TEST_PARTNERS&&Math.random()<=_f&&this._setRandomIdentityProvider(!1),this.testGroup===Se.PARTNER_ONLY&&this._setRandomIdentityProvider(!0),this.providersRules[Ae]={itfPosition:18,itfValue:"-",itfTestPercent:1,enabled:!0},ee({key:Na,value:btoa(JSON.stringify(this.providersRules)),type:k.string.type})}_getDefaultProviderRules(e){let t={};return this.identityProviders.filter(i=>i.slug!==Ae).forEach(i=>{let s=In[i.slug],n=typeof e=="function"?e(i.slug,s):e;t[i.slug]=Object.assign({},s,{enabled:n})}),t}_populateIdentityTestGroup(){let e=G({key:Pa,type:k.string.type});this.testGroup=e||this._determineTestingGroup(),ee({key:Pa,value:this.testGroup,type:k.string.type})}_updateProvidersRulesByUrlParams(){if(this.itfY&&this._logger.log(`itf_y parameter found: ${this.itfY}`),this.itf_n&&this._logger.log(`itf_n parameter found: ${this.itf_n}`),this.itfY||this.itf_n){let e=this.itfY?this.itfY.split(","):[],t=this.itf_n?this.itf_n.split(","):[];this._logger.log(`Provider Rules before update: ${this.providersRules}`),this.providersRules=Object.keys(this.providersRules).reduce((i,s)=>(e.includes(s)?(this._logger.log(`Enabling identity provider: ${s}`),i[s]=L(A({},this.providersRules[s]),{enabled:!0})):t.includes(s)&&(this._logger.log(`Disabling identity provider: ${s}`),i[s]=L(A({},this.providersRules[s]),{enabled:!1})),i),this.providersRules),this._logger.log(`Provider Rules after update: ${this.providersRules}`)}}_determineTestingGroup(){let e=Math.random();return e<=this.testTrafficPercentage?Se.TEST_PARTNERS:this.testTrafficPercentage<e&&e<=this.testTrafficPercentage+this.partnerOnlyTrafficPercentage?Se.PARTNER_ONLY:Se.ALL_DISABLED}_setRandomIdentityProvider(e){let t=this.identityProviders.filter(s=>s.slug!==Ae);if(t.length===0)return;let i=t[Math.floor(Math.random()*t.length)];this.providersRules[i.slug].enabled=e}};T.class(za,{token:l.IDENTITY_CONFIG,dependencies:[l.DISPENSARY_DATA,l.LOGGER]});var Ya=class{constructor({dispensaryData:e,logger:t,identityConfig:i,win:s=window,analytics:n}){E(this,"version",1);this._window=s,this._identityConfig=i,this._dispensaryData=e,this._logger=t,this._analytics=n,this._logger.setContext(l.OPTABLE_MANAGER),this._init()}_setOptableReload(){let i={value:!0,expiration:new Date().getTime()+5*60*1e3};sessionStorage.setItem("optableReload",JSON.stringify(i))}_isOptableReloadInvalid(){let e=sessionStorage.getItem("optableReload");if(!e)return!0;try{let t=JSON.parse(e);return new Date().getTime()>t.expiration?(sessionStorage.removeItem("optableReload"),!0):!1}catch(t){return sessionStorage.removeItem("optableReload"),!0}}get _isGeoAllowed(){var i;let e=(i=this._dispensaryData.locData)==null?void 0:i.iso,t="Optable does not run for users";return e?this._identityConfig.checkIfProviderIsAllowedInGeo(er)?!0:(this._logger.log(`${t} in ${e}.`,{level:10}),!1):(this._logger.log(`${t} without location data.`,{level:10}),!1)}_getSlug(){try{let t=this._dispensaryData.fsdata.domain.split("."),i=t.slice(-2),s=["co.uk","org.uk","gov.uk","com.au","net.au"],n=t.slice(-2).join("."),o=t.slice(-3).join(".");s.includes(n)?i=t.slice(-3):s.includes(o)&&(i=t.slice(-4));let a=i.join("-");return a=a.replace(/_/g,"-"),/^\d/.test(a)&&(a=`s-${a}`),a}catch(e){return null}}_checkAndMergeOptableConfig(){var s,n;let e,t=localStorage.getItem("OPTABLE_RESOLVED");if(!t)return;try{e=JSON.parse(t)}catch(o){this._logger.log("Failed to parse OPTABLE_RESOLVED from localStorage.",{level:10})}if(!e)return;let i=(n=(s=e==null?void 0:e.ortb2)==null?void 0:s.user)==null?void 0:n.eids;Te({name:"optablePerformance",detail:{legacy:1,eidLength:i.length}}),i&&fsprebid.que.push(()=>{fsprebid.mergeConfig({userSync:{userIds:(()=>{let o=fsprebid.getConfig("userSync.userIds")||[],a=o.find(d=>d.name==="pubProvidedId");return a||(a={name:"pubProvidedId",params:{}},o.push(a)),a.params=a.params||{},a.params.eids=a.params.eids?[...a.params.eids,...i]:i,o})()}}),fsprebid.refreshUserIds({submoduleNames:["pubProvidedId"]})})}_loadScript(e){window.optable=window.optable||{cmd:[]},window.optable.site=e,document.addEventListener("optableResolved",()=>{this._checkAndMergeOptableConfig()}),this._setOptableReload(),ge(Vf)}_init(){let e=this._getSlug();!this._identityConfig.checkIfProviderEnabled(er)||!this._isGeoAllowed||!e||(this._isOptableReloadInvalid()?this._loadScript(e):this._checkAndMergeOptableConfig(),window.addEventListener("optable-split-test",t=>{this._analytics.track(new $({eventName:"OPTABLE-SPLIT-TEST",data:{optableMatcher:t.detail.optable_matcher}}))}))}};T.class(Ya,{token:l.OPTABLE_MANAGER,dependencies:[l.DISPENSARY_DATA,{token:"window",alias:"win"},l.LOGGER,l.IDENTITY_CONFIG,l.PREBID_MANAGER,l.ANALYTICS]});var bn=class{constructor({dispensaryData:e,identityConfig:t,prebidManager:i,gamManager:s,win:n=window}){E(this,"version",1);this._window=n,this._identityConfig=t,this._dispensaryData=e,this._prebidManager=i,this._gamManager=s,this._iiq=null,this._init()}_init(){!this._identityConfig.checkIfProviderEnabled(tr)||!this._isGeoAllowed||this._loadScript()}get _isGeoAllowed(){var t;return((t=this._dispensaryData.locData)==null?void 0:t.iso)?this._identityConfig.checkIfProviderIsAllowedInGeo(tr):!1}_iiqPrebidOperations(){this._prebidManager.instance.onEvent("bidWon",e=>{if(this._iiq!=null){let t={biddingPlatformId:1,bidderCode:e==null?void 0:e.bidder,prebidAuctionId:e==null?void 0:e.auctionId,cpm:e==null?void 0:e.cpm,currency:e==null?void 0:e.currency,originalCpm:e==null?void 0:e.originalCpm,originalCurrency:e==null?void 0:e.originalCurrency,status:e==null?void 0:e.status,placementId:e==null?void 0:e.adUnitCode};this._iiq.reportExternalWin(t)}})}_iiqGAMKVPSetting(){let e="intent_iq_group";try{this._gamManager.setGlobalTargeting(e,this._iiq.intentIqConfig.abTesting.currentTestGroup||"U")}catch(t){this._gamManager.setGlobalTargeting(e,"U")}}_iiqGAMPPIDSetting(){let t=(i=>{try{let s=i.eids;for(let n=0;n<s.length;n++){let o=s[n];if(o.source==="intentiq.com"){let a=o.uids;for(let d=0;d<a.length;d++){let c=a[d];if(c.ext.stype==="ppuid")return c.id}}}return null}catch(s){return null}})(this._iiq.getIntentIqData());t!=null&&this._gamManager.instance.setPublisherProvidedId(t)}_iiqGAMOperations(){this._iiq!=null&&(this._iiqGAMKVPSetting(),this._iiqGAMPPIDSetting())}_loadScript(){ge(Hf,()=>{this._iiq=new IntentIqObject({partner:1434517136,pbjs:this._prebidManager.instance,callback:()=>{Te({name:"iiqInit",detail:!0})},timeoutInMillis:400,ABTestingConfigurationSource:"IIQServer",allowGDPR:!1,manualWinReportEnabled:!0,domainName:this._dispensaryData.domainName,vrBrowserBlackList:["chrome"]}),this._iiqPrebidOperations(),this._iiqGAMOperations()})}};T.class(bn,{token:l.IIQ_MANAGER,dependencies:[l.DISPENSARY_DATA,l.IDENTITY_CONFIG,l.PREBID_MANAGER,l.GAM_MANAGER],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,new bn(r)})});var $a=class{constructor(){E(this,"_events");this._events={}}subscribe(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}unsubscribe(e,t){this._events[e]&&(this._events[e]=this._events[e].filter(i=>i!==t))}emit(e,t){this._events[e]&&this._events[e].forEach(i=>i({eventName:e,payload:t}))}hasSubscribers(e){var t;return!!((t=this._events[e])!=null&&t.length)}};T.class($a,{token:l.EVENT_BUS,defaultAlias:"eventBus"});var Gp=[{owner:"google",ua:"googlebot"},{owner:"google",ua:"mediapartners-google"},{owner:"google",ua:"adsbot-google"},{owner:"bing",ua:"bingbot"},{owner:"yahoo",ua:"slurp"},{owner:"duckduckgo",ua:"duckduckbot"},{owner:"baidu",ua:"baiduspider"},{owner:"yandex",ua:"yandexbot"},{owner:"exabot",ua:"konqueror/3.5"},{owner:"exabot",ua:"Exabot/3.0"},{owner:"facebook",ua:"facebot"},{owner:"facebook",ua:"facebookexternalhit/1.0"},{owner:"facebook",ua:"facebookexternalhit/1.1"},{owner:"alexa",ua:"ia_archiver"},{owner:"meta",ua:"meta-externalads/1.1"},{owner:"meta",ua:"meta-externalagent/1.1"},{owner:"meta",ua:"meta-externalfetcher/1.1"},{owner:"aws",ua:"CloudWatchSynthetics/"},{owner:"amazon",ua:"AmazonAdBot"}],Tn=class{constructor(){}checkForBot(){var s;let e=((s=window.navigator)==null?void 0:s.userAgent)||(navigator==null?void 0:navigator.userAgent),t="fs.bot.found",i=wi({name:t});i&&i?this._handleBotDetected(t,e):e&&!i&&(Gp.forEach(n=>{RegExp(n.ua.toLowerCase()).test(e.toLowerCase())&&this._handleBotDetected(t,e)}),mr({name:t,value:!1}))}_handleBotDetected(e,t){throw this._isDetected=!0,this._trackEvent(),mr({botCookieName:e,value:!0}),`pubfig code is disabled as the user agent ${t} is a bot`}_trackEvent(){return y(this,null,function*(){let e=new $({eventName:"BOT_DETECTED",eventType:"botDetected",data:{detected:!0}});yield fetch(`${Sr}/v2/c`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customEvent:[e.payload],accountId:freestar.fsdata.accountId,siteId:freestar.fsdata.siteId}),credentials:"include"})})}};var Fp=["kargo","teads","seedtag"],jf=r=>{var o;if(r.mediaType==="banner"){let a=fsprebid.adUnits.find(({code:c})=>c===r.adUnitCode);if(!((o=a==null?void 0:a.sizes)==null?void 0:o.some(([c=0,u=0])=>c===r.width&&u===r.height)))return freestar.log(10,`Invalid bid size for ad unit: ${r.adUnitCode}`),!1}let e=X(r.bidderCode);if(!Fp.some(a=>X(a)===e))return!0;let{width:t,height:i,ad:s}=r;if(!s||!t||!i)return!0;let n=String(s).toLowerCase().includes(`${t}x${i}`);return n||freestar.log(10,`Invalid ad size for ${r.bidderCode} bid: ${t}x${i}`),n};var Kf=(r,e=5e3)=>y(void 0,null,function*(){return new Promise((t,i)=>{var s,n;if(!r){t();return}if(((n=(s=r.contentWindow)==null?void 0:s.document)==null?void 0:n.readyState)==="complete"){t();return}r.addEventListener("load",()=>{if(Number(r==null?void 0:r.width)<=1){i(new Error("Iframe width is less than or equal to 1"));return}t()},{once:!0}),setTimeout(()=>{t()},e)})});var wn=class{constructor({type:e,prebidAuctionId:t=null}){this.fsAuctionId=de(),this.type=e,this.prebidAuctionId=t,this.adUnits=new Set,this.reportedPlacements=new Set,this.timestamp=Date.now()}addAdUnit(e){this.adUnits.add(e)}getAdUnits(){return Array.from(this.adUnits)}isAuctionEndReported(e){return this.reportedPlacements.has(e)}};var Vp={"scribd-com":{clientId:"ca-pub-1211639399720391",sizes:{"300x100":6475080870,"300x250":7125817567,"300x50":1716797968,"320x100":9052362509,"320x50":4499654227,"336x280":4367012037,"468x60":5113117491,"728x90":7843222610,"970x250":5105378639,"970x90":6338569255}}},ui=()=>{var r;return((r=freestar==null?void 0:freestar.config)==null?void 0:r.adsense)||Vp[freestar.sitePath]},ja=class{constructor(){this.params=!1,this.init()}init(){this.params=ui()}render(e=null){if(!ui())return;this.params||(this.params=ui()),window.adsbygoogle||(ge("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"),window.adsbygoogle=[]);let t=te.getAdUnitByPrebidCode(e),{placement:i}=t,s=Object.keys(this.params.sizes),n=go({placement:i,sizesAllowed:s}),o=document.getElementById(e);o.innerHTML=`<ins class="adsbygoogle" style="display:block; width:${n[0]}px; height:${n[1]}px;" data-ad-client="${this.params.clientId}" data-ad-slot="${this.params.sizes[n.join("x")]}" ></ins>`,window.adsbygoogle.push({})}},Ka=new ja;var ye={PREBID:"PREBID",PREBID_GAM:"PREBID-GAM",GAM:"GAM"},Wa=10*60*1e3;var Rn=class{constructor({adUnitManager:e,analytics:t,prebidManager:i,gamManager:s,idealAdStackManager:n,rebidManager:o,dispensaryData:a,logger:d,nativeRenderManager:c,eventBus:u}){this._adUnitManager=e,this._idealAdStackManager=n,this._analytics=t,this._prebidManager=i,this._gamManager=s,this._rebidManager=o,this._dispensaryData=a,this._nativeRenderManager=c,this._logger=d,this._eventBus=u,this._logger.setContext(l.AUCTION_MANAGER),this.auctions=new Map,this._bindPrebidEvents(),this._bindGamEvents(),this._listeners={auctionInit:[]}}addEventListener(e,t){if(!this._listeners[e])throw new Error(`Invalid event type: ${e}`);this._listeners[e].includes(t)||this._listeners[e].push(t)}removeEventListener(e,t){this._listeners[e]=this._listeners[e].filter(i=>i!==t)}_bindGamEvents(){this._gamManager.instance.pubads().addEventListener(si,this._handleSlotRequested.bind(this)),this._gamManager.instance.pubads().addEventListener(mt,this._handleSlotRenderEnded.bind(this))}_bindPrebidEvents(){this._prebidManager.instance.onEvent(_s,this._handleAuctionInit.bind(this)),this._prebidManager.instance.onEvent(ri,this._handleAuctionEnd.bind(this))}_createAuction(e,t=null){let i=new wn({type:e,prebidAuctionId:t});return this.auctions.set(i.fsAuctionId,i),i}_handleAuctionInit(e){let{adUnits:t,auctionId:i}=e,s=this._idealAdStackManager.isGAMEnabled()?ye.PREBID_GAM:ye.PREBID,n=this._createAuction(s,i),o=n.fsAuctionId;t.forEach(a=>{let{code:d}=a,c=this._adUnitManager.getAdUnitByPrebidCode(d);c&&(c.saveState({fsAuctionId:o,auctionType:s,prebidAuctionId:i,rebid:this._rebidManager.getStatus({adUnitCode:c.getSlotId()})}),n.addAdUnit(c),this._trackAuctionStart(c,o,s,i))}),this._listeners.auctionInit.forEach(a=>a(n))}_handleAuctionEnd(e){let{auctionId:t}=e,i=this.getAuctionByPrebidAuctionId(t);i&&i.adUnits.forEach(s=>{let n=(o,a=!1)=>{this._trackAuctionEnd(s,i.fsAuctionId,o,e,t,a,!1)};if(i.type===ye.PREBID){let o=null;this._nativeRenderManager.isEnabled&&(o=this._nativeRenderManager.getHighestBid(s.prebid.code)),o?this._nativeRenderManager.renderAd(o,s.prebid.code).then(()=>{n(ye.PREBID,!0)}):ui()&&s.isDisplayAd()?Ka.render(s.prebid.code):n(ye.PREBID)}else s.slot||n(ye.PREBID_GAM)})}_handleSlotRequested(e){let{slot:t}=e,i=this._adUnitManager.getAdUnitBySlotElementId(t.getSlotElementId());if(i){let s=t.getTargeting("fs-auuid")[0],n=this.getAuctionByFsAuctionId(s);if((n==null?void 0:n.type)===ye.PREBID_GAM||(n==null?void 0:n.type)===ye.PREBID)return;let o=this._createAuction(ye.GAM);i.saveState({fsAuctionId:o.fsAuctionId,auctionType:ye.GAM,rebid:this._rebidManager.getStatus({adUnitCode:i.getSlotId()})}),this._trackAuctionStart(i,o.fsAuctionId,ye.GAM)}}_handleSlotRenderEnded(e){let{slot:t}=e,i=t.getSlotElementId(),s=this._adUnitManager.getAdUnitBySlotElementId(i);if(!s)return;let n=t==null?void 0:t.getTargeting("fs-auuid")[0],o=this.getAuctionByFsAuctionId(n);if(!o)return;let a=(c=!1)=>{this._trackAuctionEnd(s,n,o.type,e,o.prebidAuctionId,c,c)};if(B("fs-force-rebid")){this._rebidEmptySlot(e,i),a(),this._logger.log("When in 'fs-force-rebid' mode, ads will not be rendered natively");return}if(B("fs-force-native-render")){let c=this._nativeRenderManager.getHighestBid(i);if(c){this._nativeRenderManager.renderAd(c,i).then(()=>{a(!0)}).catch(u=>{this._logger.log(`Error native rendering prebid ad: ${u}`)});return}}if(!e.isEmpty){a();return}if(ui()&&s.isDisplayAd()){Ka.render(i);return}let d=null;if(this._nativeRenderManager.isEnabled&&(d=this._nativeRenderManager.getHighestBid(i)),d){this._nativeRenderManager.renderAd(d,i).then(()=>{a(!0)}).catch(c=>{this._logger.log(`Error native rendering prebid ad: ${c}`)});return}this._rebidEmptySlot(e,i),a()}_rebidEmptySlot(e,t){this._dispensaryData.fsdata.secondAuctionDisabled||!this._idealAdStackManager.isRebidAllowed()||this._rebidManager.handleNoBidScenario(e,t)}_trackAuctionStart(e,t,i,s=null){var a,d,c;let n=L(A({},this._buildBaseAuctionPayload(e,t,i,s)),{fsAuctionId:t}),o=e.getSlotId();o&&((a=this._eventBus)!=null&&a.emit)&&this._eventBus.emit(Rc,{slotId:o,fsAuctionId:t,auctionType:i,prebidAuctionId:s,placementId:(c=(d=e.placement)==null?void 0:d.name)!=null?c:null}),this._analytics.track(new ai(n))}_trackAuctionEnd(e,t,i,s,n=null,o,a){let d=this.getAuctionByFsAuctionId(t);if(d&&!d.reportedPlacements.has(e.placement.name)){let c=this._buildAuctionEndPayload(e,t,i,s,n,o,a);this._analytics.track(new Fs(c)),d.reportedPlacements.add(e.placement.name),this._setAuctionExpiration(t)}}_setAuctionExpiration(e){setTimeout(()=>{this._logger.log(`Removing expired auction ${e} after ${Wa}`),this.auctions.delete(e)},Wa)}_buildAuctionEndPayload(e,t,i,s,n,o,a){return L(A(A(A({},this._buildBaseAuctionPayload(e,t,i,n)),this._extractAuctionEndData(s)),this._calculateAuctionStatusFields(t,i,s,o,a)),{fsAuctionId:t,winningBid:e.getWinningBid(),isS2SDisabled:this._idealAdStackManager.isS2SDisabled()})}_buildBaseAuctionPayload(e,t,i,s=null){var n,o;return{placementId:e.placement.name,DfpId:(n=e.slot)==null?void 0:n.getAdUnitPath(),fsAuctionId:t,auctionId:s,auctionType:i,location:(o=freestar.locData)!=null?o:{},userIds:this._prebidManager.instance.getConfig().userSync.userIds.map(a=>a.name),kvps:e.getKVPs().filter(([a])=>Md.includes(a))}}_extractAuctionEndData(e){return L(A({},e),{size:JSON.stringify(e.size)})}_calculateAuctionStatusFields(e,t,i,s,n){let o,a;return t===ye.PREBID?(o=!0,a=!s):(o=!1,a=i.isEmpty&&!s&&!n),{isNativeRender:s,isGamBypass:o,unfilled:a}}getAuctionByFsAuctionId(e){return this.auctions.get(e)||null}getAuctionByPrebidAuctionId(e){return Array.from(this.auctions.values()).find(t=>t.prebidAuctionId===e)||null}};T.class(Rn,{token:l.AUCTION_MANAGER,dependencies:[l.ANALYTICS,l.FREESTAR,l.PREBID_MANAGER,l.GAM_MANAGER,l.DISPENSARY_DATA,l.LOGGER,l.NATIVE_RENDER_MANAGER,l.REBID_MANAGER,l.EVENT_BUS],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,new Rn(L(A({},r),{idealAdStackManager:j(),adUnitManager:te}))})});var vn=class{constructor(){this._queue=[]}enqueue({bidObjects:e}){this._queue=this._queue.concat(e)}get items(){return Array.from(new Set(this._queue))}hasItem(e){return this.items.includes(e)}clear(){this._queue=[]}};function On({adUnits:r}){Array.isArray(r)||(r=[r]);let e=r.filter(i=>i&&i.bids!=null&&i.bids.length>0),t=r.filter(i=>!i||i.bids==null||i.bids.length===0);if(t.length>0){let i=t.map(s=>s&&s.code).join(", ");freestar.log(20,`Not adding adUnits ${i} which have no bidders configured.`)}freestar.log(20,`Adding ${e.length} adUnits to fsprebid.`),fsprebid.que.push(function(){fsprebid.addAdUnits(e)}),e.forEach(i=>{te.add({prebid:i})})}function Wf(r=new ft){var p,h;let{placements:e,networks:t}=window.freestar.fsdata,{bidderOverrides:i=[],type:s=Me}=((h=(p=window.freestar)==null?void 0:p.fsdata)==null?void 0:h.schain)||{},n=m=>m.slug,o=(m,S,b)=>b.indexOf(m)===S&&!rl.includes(m),a=()=>e.filter(m=>m.networks.length).map(({networks:m})=>m.map(n)),d=t.map(n).concat(a()).flat();r.hasValidStoredRequests()&&d.push(r.getSlug());let c=i&&i.length;c&&s===vt?d=d.filter(m=>!i.includes(m)):c&&s===Me&&(d=d.filter(m=>i.includes(m)));let u=d.filter(o),f=[];return Object.entries(j().getBidderSummary()).forEach(([m,S])=>{u.includes(m)&&S==="both"&&f.push(Os(m))}),u.concat(f)}function Qa(r){return r.sizes.forEach(e=>{Object.keys(e.params).forEach(t=>!e.params[t]&&delete e.params[t])})}var Cn=class{constructor(e){this._logger=e.logger,this._analytics=e.analytics,this._deviceInfo=e.deviceInfo,this._performanceLogger=e.performanceLogger,this._gamManager=e.gamManager,this._prebidManager=e.prebidManager,this._bidsQueue=e.bidsQueue,this._adBlock=e.adBlock,this._freestar=e.freestar,this._dispensaryData=e.dispensaryData,this._amazonManager=e.amazonManager,this._logger.setContext(l.BIDS_MANAGER),this._initializeState(),this._processingTimeout=null}enqueueBids({bidObjects:e}){if(!(e!=null&&e.length)){this._logger.log("No bid objects provided for enqueueBids");return}this._bidsQueue.enqueue({bidObjects:e}),this._processingTimeout&&clearTimeout(this._processingTimeout),this._processingTimeout=setTimeout(()=>{this.processBidsQueue()},100)}processBidsQueue({timeout:e}={}){let t=this._bidsQueue.items;if(this._bidsQueue.clear(),!t.length){this._logger.log("No items in bids queue");return}this._logger.log(["BidsQueue:Processing following bidObjects:",t]);let i=this._prebidManager.instance.adUnits,s=new Set,n=new Set,o=[],a=new Set(i.map(d=>d.code));return t.forEach(d=>{var u;if(!((u=d.sizes)!=null&&u.length))return;n.add(d.code),a.has(d.code)||o.push(d);let c=this._gamManager.getSlot({elementId:d.code});c&&s.add(c)}),s=Array.from(s),n=Array.from(n),On({adUnits:o}),this.requestBids({elementIds:n,slots:s,timeout:e})}_initializeState(){this.requestReference={bidTimer:null,requestNum:Number(freestar.bidRequestNum)||0},this._freestar.requestReference=this.requestReference}requestBids({elementIds:e,slots:t,timeout:i,callback:s,sendAdserverSignal:n}={}){var d;if(this._adBlock.adBlockerDetected){this._logger.log("AdBlocker detected, skip requesting bids");return}let o=this._validateElements({elementIds:e});if(!(o!=null&&o.length))return;this._logPerformanceMark();let a=this._initializeRequestConfig({elementIds:o,slots:t,timeout:i,callback:s,sendAdserverSignal:n});n instanceof Promise&&this._trackEarlyBids(o),(d=freestar==null?void 0:freestar.config)!=null&&d.setNonPersonalizedAds?this._handleNonPersonalizedAds(a):this._initiateAuction(a)}handleNoBids({auctionData:e}){let{bidsReceived:t,noBids:i}=e,s=this._getAdUnitCodesWithNoBids({bidsReceived:t,noBids:i});this._setNoBidTargeting({adUnitCodesWithNoBids:s,isTimeout:!1})}_initializeRequestConfig({elementIds:e,slots:t,timeout:i,callback:s,sendAdserverSignal:n}){let o=i||this._dispensaryData.fsdata.timeout;return{elementIds:e,slots:t,failSafeTimeout:o,callback:s,sendAdserverSignal:n,requestManager:{prebid:!1,aps:!1,adserverRequestSent:!1},amazonSlots:this._setupAmazonSlots(t)}}_setupAmazonSlots(e){if(!j().isGAMEnabled())return[];let t=this._amazonManager.setupAmazonSlots(e);return Array.isArray(t)?t:[]}_validateElements({elementIds:e}){return!e||!e.length?this._getAllValidPlacements():Array.isArray(e)?e:[e]}_getAllValidPlacements(){return this._dispensaryData.fsdata.placements.flatMap(e=>e.validAdSizes&&!e.stickyFooter&&!e.pushdownUnit&&e.sideWallType===0&&document.getElementById(e.name)?e.name:[])}_initiateAuction(e){this._requestBidsFromVendors(e),this._setFailsafeTimeout(e)}_requestBidsFromVendors(e){let{elementIds:t,sendAdserverSignal:i}=e;this.requestReference.requestNum+=1,this._requestAmazonBids(e),this._requestPrebidBids(e),i instanceof Promise&&this._trackEarlyBids(t)}_setFailsafeTimeout(e){let{failSafeTimeout:t}=e;this.requestReference.bidTimer=window.setTimeout(()=>{j().isGAMEnabled()&&(this._logger.log(` (${this.requestReference.requestNum}) TIMEOUT!`),this._setNoBidTargeting({isTimeout:!0}),this._handleAdServerSignal(e))},t)}_requestPrebidBids(e){let{elementIds:t,failSafeTimeout:i}=e,s={timeout:i||3e3,bidsBackHandler:n=>{this._logger.log([` (${this.requestReference.requestNum}) prebid bid responses:`,n]),e.requestManager.prebid=!0,this._handleBidderBack("prebid",e)}};t&&(s.adUnitCodes=t),this._prebidManager.instance.que.push(()=>{this._prebidManager.instance.requestBids(s)})}_requestAmazonBids(e){let{amazonSlots:t,failSafeTimeout:i}=e;if(!j().isGAMEnabled()||!this._amazonManager.isEnabled||!t.length){this._logger.log("Amazon bidding is not applicable or no valid amazon Slots"),e.requestManager.aps=!0,this._handleBidderBack("aps",e);return}this._logger.log(["Requesting bids from Amazon:",t]),this._amazonManager.instance.fetchBids({slots:t,timeout:i||3e3},n=>{this._amazonManager.track(n),this._logger.log([` (${this.requestReference.requestNum}) aps bids:`,n]),e.requestManager.aps=!0,this._handleBidderBack("aps",e)})}_handleBidderBack(e,t){let{requestManager:i}=t;this._freestar.debug&&this._freestar.debug>24&&e==="prebid"&&setTimeout(()=>Gd(),1500),this._logger.log([`(${this.requestReference.requestNum}) Bidder back:`,e]),this._allBiddersBack(i)&&j().isGAMEnabled()&&(t.sendAdserverSignal instanceof Promise?this._handleAdServerSignal(t):this._handleAdServerRequest(t))}_allBiddersBack(e){return e.prebid&&(j().isGAMEnabled()?e.aps:!0)}_handleAdServerSignal(e){let{sendAdserverSignal:t,elementIds:i}=e;t instanceof Promise?t.then(()=>{this._handleAdServerRequest(e)}).catch(()=>{this._logger.log(`Adserver request cancelled for: ${i.toString()}`)}):this._handleAdServerRequest(e)}_handleAdServerRequest(e){let{requestManager:t}=e;t.adserverRequestSent||(this.requestReference.bidTimer&&(clearTimeout(this.requestReference.bidTimer),this.requestReference.bidTimer=null),t.adserverRequestSent=!0,this._logger.log([` (${this.requestReference.requestNum}) Sending adserver request!`]),this._sendAdServerRequest(e))}_sendAdServerRequest(e){let{elementIds:t}=e;this._gamManager.instance.cmd.push(()=>{let i={activeIds:[],activeSlots:[]};if(Array.isArray(t)&&t.length){this._logger.log([` (${this.requestReference.requestNum}) Refresh Only:`,t]),this._amazonManager.isEnabled&&this._amazonManager.instance.setDisplayBids(t);let s=this._dynamicPlacementFlooring(t);i.activeIds=s.activeIds,i.activeSlots=s.activeSlots}else this._logger.log(` (${this.requestReference.requestNum}) Refresh All!`),this._amazonManager.isEnabled&&this._amazonManager.instance.setDisplayBids(),i.activeIds=this._staticPlacementFlooring();this._setTestTargeting(),i.activeSlots.length&&(i.activeIds.length&&this._prebidManager.instance.setTargetingForGPTAsync(i.activeIds),this._gamManager.logTargeting(i.activeSlots),this._gamManager.refreshWithCorrelatorControl(i.activeSlots)),e.callback&&e.callback()})}_setTestTargeting(){let e=kd();e&&(this._logger.log(["Part of an A/B test... ",e]),this._gamManager.setGlobalTargeting("fs_test_variant_id",String(e.testGroup)))}_setNoBidTargeting({adUnitCodesWithNoBids:e,isTimeout:t}){this._gamManager.getSlots().forEach(i=>{if(t)i.setTargeting("fsbid","timeout");else if(e){let s=i.getAdUnitPath(),n=Zc({adUnitPath:s});n&&e.includes(n.name)&&i.setTargeting("fsbid","0")}})}_placementFlooring({placementName:e,domId:t}){let i=!0,s,n,o=this._prebidManager.instance.getBidResponses()[t],a=Z({name:ie({slotId:e})});return!o||!a||(n=Di(o.bids,function(d){return Number(d.cpm)}),s=a[`floor${this._deviceInfo.device.type.charAt(0).toUpperCase()+this._deviceInfo.device.type.slice(1)}`],Nr(s)&&s>0&&(n!=null&&n.cpm)&&n.cpm<s&&(i=!1)),i}_fetchPlacementName(e){return this._freestar.dynamicSlotLibrary[e]||e}_dynamicPlacementFlooring(e){let t={activeIds:[],activeSlots:[]};return e.forEach(i=>{let s=this._gamManager.getSlot({elementId:i});s&&t.activeSlots.push(s),this._placementFlooring({placementName:this._fetchPlacementName(i),domId:i})&&t.activeIds.push(i)}),t}_staticPlacementFlooring(){let e=[];return this._gamManager.getSlots().forEach(t=>{var s;let i=t.getSlotElementId();(s=this._freestar.bidsWon)!=null&&s[i]&&!this._freestar.bidsWon[i]&&(this._freestar.bidsWon[i].evaluated=!0,this._placementFlooring({placementName:this._fetchPlacementName(i),domId:i})&&e.push(i))}),e}_getAdUnitCodesWithNoBids({bidsReceived:e}){let t=this._prebidManager.instance.adUnits.reduce((i,s)=>(i[s.code]=!1,i),{});return e&&e.forEach(i=>{i.cpm>0&&(t[i.adUnitCode]=!0)}),Object.keys(t).filter(i=>!t[i])}_createAuctionStartEvent(){Te({name:"auctionStarted",detail:!0})}_logPerformanceMark(){this._performanceLogger.logMark({markerName:be.pubfigPrebidFsRequestBids})}_trackEarlyBids(e){this._logger.log(["Refreshing early bids",e])}_handleNonPersonalizedAds(e){this._logger.log(` (${this.requestReference.requestNum}) set to skip pre auctions, sending GAM request.`),e.sendAdserverSignal instanceof Promise?e.sendAdserverSignal.then(()=>this._sendAdServerRequest(e)).catch(()=>{this._logger.log(`Adserver request cancelled for: ${e.elementIds.toString()}`)}):this._sendAdServerRequest(e)}};T.class(Cn,{token:l.BIDS_MANAGER,defaultAlias:"bidsManager",dependencies:[l.LOGGER,l.ANALYTICS,l.DEVICE_INFO,l.PERFORMANCE_LOGGER,l.GAM_MANAGER,l.PREBID_MANAGER,l.AD_BLOCK,l.FREESTAR,l.DISPENSARY_DATA,l.AMAZON_MANAGER],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,r.bidsQueue=r.bidsQueue||new vn,new Cn(r)})});var Dn=class{constructor({prebidManager:e,adUnitManager:t,logger:i,eventBus:s,ancillary:n,dispensaryData:o}){this._dispensaryData=o,this._prebidManager=e,this._adUnitManager=t,this._ancillary=n,this._eventBus=s,this._dispensaryData=o,this._logger=i,this._logger.setContext(l.NATIVE_RENDER_MANAGER)}get isEnabled(){return this._dispensaryData.getValue("enableNativeRender")!==!1}getHighestBid(e,t=[]){if(!this.isEnabled)return null;let i=this._prebidManager.instance.getBidResponsesForAdUnitCode(e);if(i.bids&&i.bids.length>0){let s=i.bids.filter(n=>n.status!=="rendered"&&jf(n)&&!t.includes(X(n.bidderCode)));if(s.length>0)return s.sort((n,o)=>o.cpm-n.cpm),s[0]}return null}getAdUnit(e){return this._adUnitManager.getAdUnitBySlotElementId(e)}_sendEvents(e,t,i){this._eventBus.emit(Ps,{elementId:t,bid:i})}renderAd(e,t){return y(this,null,function*(){if(!this.isEnabled){this._logger.log("Native render is not enabled");return}let i=document.getElementById(t);if(i.style.display==="none"&&!this._dispensaryData.fsdata.collapseEmptyDivs)return;i.style.display==="none"&&(i.style.display="");let s=this.getAdUnit(t);if(!s){console.warn(`[nativeRender-renderAd] AdUnit not found for elementId: ${t}`);return}if(s.renderMap.has(e.adId))return;s.renderMap.set(e.adId,!0),yield this.clearExistingAd(t),e.isNativeRender=!0;let n=this.createAdElement(e);i.appendChild(n),this.executeRenderAd(e.adId),this._ancillary.create({id:t,placement:s.placement,container:n}),this._sendEvents(s,t,e)})}clearExistingAd(e){return new Promise(t=>{this._ancillary.hide(e),hr(e),this._eventBus.emit(yc,{elementId:e}),t()})}createAdElement(e){return F({id:ur,children:[F({type:"iframe",id:`_fs-ad-${e.adId||e.amzniid}`,attributes:[{width:e.width||"100%",height:e.height||"100%",frameBorder:"0",marginHeight:"0",marginWidth:"0",scrolling:"no"}]})]})}executeRenderAd(e){let t=document.querySelector(`#_fs-ad-${e}`).contentWindow;t.adId=e,this._prebidManager.instance.renderAd(t.document,e),this._logger.log(`rendered #_fs-ad-${e} natively`)}};T.class(Dn,{token:l.NATIVE_RENDER_MANAGER,dependencies:[l.PREBID_MANAGER,l.LOGGER,l.EVENT_BUS,l.ANCILLARY,l.DISPENSARY_DATA],factory:e=>y(void 0,[e],function*({dependencies:r}){return yield r.prebidManager.ready,new Dn(L(A({},r),{adUnitManager:te}))})});var hi="REFRESH";var Qf={root:null,threshold:.5},Jf=1e3,Zf=.49,Xf=3e3,eu=300,tu=["stickyFooter","sideWall","pushdown","dynamicAd","stickyRail"],Ja="Ad refresh is disabled for this geo.";var ir=class{constructor({logger:e,freestar:t},i){e.setContext(hi),t.refreshLibrary={},t.refreshSlots=[],e.log(i!=null?i:Ja),["refresh","refreshAll"].forEach(s=>{this[s]=()=>{e.warning(i!=null?i:Ja)}}),["refreshAllVisible","resetCapCounter","disableForItem","enableForItem","disable","enable","pause","resume","setDirectAdRefresh"].forEach(s=>{this[s]=()=>{e.log(i!=null?i:"Ad refresh is disabled.")}})}};function Hp(r){return{bidder:X(r.bidder),creativeId:r.creativeId,cpm:r.cpm,mediaType:r.mediaType,evaluated:!1,ad:r.ad,time:Date.now()}}function qp(r){let{adUnitCode:e}=r;e&&(freestar.bidsWon[e]=Hp(r))}function iu(){fsprebid.que.push(function(){fsprebid.onEvent(Es,r=>qp(r))})}var rr="Bid Adjustment Log : ";function ru({bidder:r,cpm:e,siteAdjustment:t,networkAdjustment:i}){(t||i&&freestar.adjustments.isLogged)&&(freestar.log(rr,"bidder : ",r),freestar.log(rr,"cpm : ",JSON.stringify(e)),t&&freestar.log(rr,"siteAdjustment : ",t),i&&freestar.log(rr,"networkAdjustment : ",i))}function su({cpm:r,siteAdjustment:e,networkAdjustment:t,bid:i}){(r&&e||t)&&(freestar.adjustments.isLogged&&freestar.log(rr,"final cpm value : ",r),i.rawCpm=i.cpm,i.adjustedCpm=r,freestar.adjustments.bids.push(Qe(i)))}function nu(){freestar.adjustments.isLogged&&fsprebid.onEvent(Bt,function(r){let e=freestar.adjustments.bids.find(t=>t.requestId===r.requestId);e&&(freestar.log("Bid Adjustment Log: bid response after adjustment",r),freestar.log("Bid Adjustment Log: original bid",e))})}var Pn=class{constructor(){this.ext={fs_company:window.freestar.fsdata&&window.freestar.fsdata.companyId||"unknown"}}};var Za=class{constructor(){this.data=[{name:ii(),ext:{taxonomyname:"iab_content_taxonomy"},segment:af()}]}},Xa=class{constructor(){this.fs_optimized=this.getIsOptimized(window.freestar),this.fs_site=window.freestar.fsdata&&window.freestar.fsdata.siteId||"unknown"}getIsOptimized({config:e={}}){return e&&e.pageSpeedOptimized?e.pageSpeedOptimized:!1}},ed=class{constructor(){this.data=new Xa}},Nn=class{constructor(e=""){this.name=window.freestar.fsdata.path||"",this.domain=window.freestar.fsdata.domain||"",this.cat=window.freestar.fsdata.categories||[],this.sectioncat=window.freestar.fsdata.categories||[],this.pagecat=window.freestar.fsdata.categories||[],this.page=window.location.href||"",this.mobile=e===Ve?1:0,this.ref=document.referrer||"",this.content=new Za,this.ext=new ed,this.publisher=new Pn}};var Mn=class{constructor(){this.id=window.freestar.msg.fpc||""}isValid(){return this.id&&this.id.length&&this.id!==Cr}};var xn=class{clean(){for(let e in this)typeof this[e]=="string"&&this[e].length===0&&delete this[e]}};var pi=class extends xn{constructor(){super(),this.region=this.getRegion(),this.city=this.getCity(),this.country=this.getCountry(),this.ext={},this.clean()}getLocObj(){return window.freestar.locData?window.freestar.locData:!1}getRegion(){return this.region!==void 0?this.region:this.getLocObj().state||""}getCity(){return this.city!==void 0?this.city:this.getLocObj().city||""}validateCountryISO(e){return e.length===2?e:!1}getCountry(){return this.country!==void 0&&this.validateCountryISO(this.country)?this.country:this.getLocObj().iso&&this.validateCountryISO(this.getLocObj().iso)?this.getLocObj().iso:""}};var td=class{constructor(){this.types={unknown:0,mobile:1,desktop:2,ctv:3,phone:4,tablet:5,connectedDevice:6,"set-top-box":7}}getType(){if(window.freestar.deviceInfo&&window.freestar.deviceInfo.device){if(window.freestar.fsdata.siteId===6324||window.freestar.fsdata.siteId===7327)return this.types.ctv;let{type:e="unknown"}=window.freestar.deviceInfo.device;if(e&&this.types[e])return this.types[e]}return this.types.unknown}},Ln=class{constructor(){this.ua=this.fetchFromDeviceInfo("ua"),this.geo=new pi({}),this.dnt=this.getUserDNTStatus(),this.devicetype=new td().getType(),this.make=this.getMobileDeviceInfo("vendor"),this.model=this.getMobileDeviceInfo("model"),this.os=this.getOSInfo("name"),this.osv=this.getOSInfo("version")}getUserDNTStatus(){return window.freestar.msg.fpc===Cr?1:0}getOSInfo(e){return this.fetchFromDeviceInfo("os")[e]||""}fetchFromDeviceInfo(e){return window.freestar&&window.freestar.deviceInfo&&window.freestar.deviceInfo[e]?window.freestar.deviceInfo[e]:""}getMobileDeviceInfo(e){return this.fetchFromDeviceInfo("device")[e]||""}};var id=class{constructor(){window.freestar.fsdata.topLevelStoredRequestId&&(this.storedrequest={id:window.freestar.fsdata.topLevelStoredRequestId})}},Bn=class{constructor(){this.prebid=new id}};var ou=Rt(br()),kn=class{constructor(e=""){let t=window.freestar.config.ortb2||{};this.site=this.merge(t.site,new Nn(e)),this.user=this.merge(t.user,new Mn),this.device=this.merge(t.device,new Ln),this.geo=this.merge(t.geo,new pi),this.ext=this.merge(t.ext,new Bn);let{enableClientBlocking:i,enableClientCategoryBlocking:s,badv:n,bcat:o}=window.freestar.fsdata.ortb||{};i&&(this.badv=n),s&&(this.bcat=o)}merge(e={},t){return(0,ou.default)(t,e)}};var au={maxTopicCaller:3,bidders:[{bidder:"pubmatic",iframeURL:"https://ads.pubmatic.com/AdServer/js/topics/topics_frame.html",expiry:7},{bidder:"openx",iframeURL:"https://pa.openx.net/topics_frame.html",expiry:7}]};function du(r){var e,t;if(r!=null&&r.adUnitCode){let i=null,s=!1;try{i=(t=(e=freestar.refreshLibrary)==null?void 0:e[r.adUnitCode])==null?void 0:t.dataRefreshId}catch(n){freestar.log(1,`Error: ${n}`)}if(i){let n=0,o=RegExp(i,"g");return freestar.refreshSlots.forEach((a,d)=>{o.test(a.refreshId)&&(n=d,s=!0)}),freestar.refreshSlots.splice(n,1),s}return s}else return!1}var Pe={},sr=[],rd=null;Pe.initiate=()=>{var r=window.fsprebid||{};return r.que=r.que||[],r.retries=0,r};function zp({bidder:r,cpm:e,siteAdjustment:t,networkAdjustment:i,placement:s,bid:n}){ru({bidder:r,cpm:e,siteAdjustment:t,networkAdjustment:i,placement:s,bid:n});let o=e,a=B("manipulate-cpm"),d=B("manipulate-bidder");if(a&&d&&r===d||a)return a;function c({adj:f,value:p}){let h=(100-f)/100,m=Number(p*h).toFixed(8);return parseFloat(m)}function u({bidder:f,placement:p}){let h=p.networks.filter(function(m){if(f===m.slug&&m.placementLevelBidAdjustment&&m.placementLevelBidAdjustment>0)return m})[0];return h?h.placementLevelBidAdjustment:0}if(i&&i>0&&(o=c({adj:i,value:o})),t&&t>0&&(o=c({adj:t,value:o})),r&&s&&s.networks&&s.networks.length){let f=u({bidder:r,placement:s});f&&f>0&&(o=c({adj:f,value:o}))}return su({cpm:o,siteAdjustment:t,networkAdjustment:i,bid:n}),o}var Be={};function Yp({network:r}){let{id:e}=r,t=r.networkBidAdjustment||0;if(freestar.networkMap&&e){let i=freestar.networkMap[e];t=i&&i.bidAdjustment&&Number(i.bidAdjustment)&&i.bidAdjustment>0?i.bidAdjustment:r.networkBidAdjustment||0}return t}function lu(r){Be[r.slug]||(Be[r.slug]={bidCpmAdjustment:function(e,t){let i=Z({name:ie({slotId:t.adUnitCode})}),s=zp({bidder:r.slug,cpm:e,siteAdjustment:r.bidAdjustment,networkAdjustment:Yp({network:r}),placement:i,bid:t});return s||e}})}Pe.setNetworks=()=>{rd=new ft,iu(),freestar.fsdata.networks.forEach(e=>{Qa(e),lu(e)}),freestar.fsdata.placements.filter(e=>e.networks.length).forEach(function(e){e.networks.forEach(t=>{Qa(t),lu(t)})})};Pe.getBidderSettings=()=>{let r=Ca({freestar});Be.standard={alwaysUseBid:!1,adserverTargeting:[{key:r.bidder,val:function(e){return X(e.bidderCode)}},{key:r.adid,val:function(e){return e.adId}},{key:r.pb,val:function(e){return freestar.fsdata.priceGranularity==="medium"?e.pbMg:freestar.fsdata.priceGranularity==="high"?e.pbHg:freestar.fsdata.priceGranularity==="auto"?e.pbAg:freestar.fsdata.priceGranularity==="dense"?e.pbDg:e.adUnitCode&&e.cpm&&e.cpm>2&&freestar.gamMap[e.adUnitCode]&&freestar.gamMap[e.adUnitCode]===!0?rf({cpm:e.cpm}):e.pbCg}},{key:r.size,val:function(e){return e.size}},{key:r.format,val:function(e){return e.mediaType}},{key:"custom_bidder_size",val:function(e){return[X(e.bidder),e.size].join("_")}},{key:"freestar_domain",val:function(){return freestar.fsdata.domain||location.domain}},{key:"freestar_path",val:function(){return location.pathname}},{key:r.auction_id,val:function(e){return`${e.auctionId}`}},{key:r.source,val:function(e){return e.source}}]},(freestar.fsDfpId||freestar.fsDevDfpId||freestar.fsdata.useFsAdserverTargetingKeys)&&Be.standard.adserverTargeting.push({key:"fspbg",val:"fs_universal"}),Be.concert&&(Be.concert.storageAllowed=!0),Be.criteo&&(Be.criteo.storageAllowed=!0),Be.taboola&&(Be.taboola.storageAllowed=!0)};Pe.setBidderSettings=()=>{fsprebid.bidderSettings=Be};var $p=()=>{if(window.freestar.fsdata.priceGranularity)if(window.freestar.fsdata.priceGranularity.length>6)try{return JSON.parse(freestar.fsdata.priceGranularity)}catch(e){window.freestar.log(10,`Error parsing priceGranularity ${e}`)}else return window.freestar.fsdata.priceGranularity;return{buckets:window.freestar.fsDfpId||window.freestar.fsDevDfpId||window.freestar.fsdata.useFsAdserverTargetingKeys?lo.v2:lo.v1}};Pe.setEventListeners=()=>{nu(),fsprebid.onEvent(_s,function(e){freestar.performanceLogger.logMark({markerName:be.pubfigPrebidAuctionInit}),e.adUnitCodes.forEach(t=>{freestar.bidsWon[t]&&delete freestar.bidsWon[t]})}),fsprebid.onEvent(Bt,function(e){var i;let t=freestar.adjustments.bids.find(s=>s.requestId===e.requestId);e.rawCpm=(i=t==null?void 0:t.cpm)!=null?i:e.cpm});let r=[l.ANALYTICS,l.BID_WON_ANALYTICS_EVENT_FACTORY];if(freestar.allowBidResponseCollection&&r.push(l.BID_RESPONSE_ANALYTICS_EVENT_FACTORY),Promise.all(r.map(e=>z.instance.resolve(e))).then(([e,t,i])=>{fsprebid.onEvent(Bt,s=>{s.adUnitCode&&qo({bidder:X(s.bidderCode),adUnitCode:s.adUnitCode}),du(s),i&&e.track(i.create(s))}),fsprebid.onEvent(Es,s=>{s.adUnitCode&&qo({bidder:X(s.bidderCode),adUnitCode:s.adUnitCode});let n=du(s);s.bidderRefresh=n,e.track(t.create(s))})}),z.instance.resolve(l.ANALYTICS).then(e=>{var t;fsprebid.onEvent(Xl,i=>{setTimeout(()=>{i.forEach(s=>{e.track(new $s(s))})},50)}),(t=window.freestar.fsdata.ortb)!=null&&t.enableClientBlockingLogs&&window.fsprebid.onEvent(ec,i=>{e.track(new $({eventName:i.rejectionReason?i.rejectionReason.toUpperCase().replace(/ /g,"_"):"UNKNOWN",eventType:"BID_REJECTED",data:i}))})}),freestar.allowBidRequestedCollection){let e=[l.ANALYTICS,l.BID_REQUESTED_ANALYTICS_EVENT_FACTORY];Promise.all(e.map(t=>z.instance.resolve(t))).then(([t,i])=>{fsprebid.onEvent(Zl,s=>{t.track(i.create(s))})})}};Pe.setSChain=()=>{let{companyId:r="",schain:e}=window.freestar.fsdata,t=an(r,e==null?void 0:e.type,e==null?void 0:e.bidderOverrides);t&&window.fsprebid.setBidderConfig({bidders:Wf(rd),config:{schain:{validation:"strict",config:t}}},!0)};function jp({enableSendAllBids:r,useTargetingKeys:e}){let t={};return e&&(t.allowTargetingKeys=["key1"]),r||(t.alwaysIncludeDeals=!0),t}Pe.settingConfig=(r,e,t)=>{var f,p,h,m,S,b,g,_;let i=$p(),s=freestar.fsdata.useFsAdserverTargetingKeys||B("use-fs-adserver-targeting-keys"),n=window.freestar.deviceInfo&&window.freestar.deviceInfo.device.type||"",o=!!((p=(f=window.freestar)==null?void 0:f.fsdata)!=null&&p.enableSendAllBidsToAdServer),a={performanceMetrics:!1,targetingControls:jp({enableSendAllBids:o,useTargetingKeys:s}),ortb2:new kn(n),rubicon:{singleRequest:!0},bidderTimeout:window.freestar.fsdata.timeout||1500,userSync:{aliasSyncEnabled:!0,auctionDelay:100,enableOverride:!1,filterSettings:{all:{bidders:"*",filter:"include"}},userIds:[],syncDelay:100,syncEnabled:!0,syncsPerBidder:8,topics:au},enableTIDs:!0,enableSendAllBids:o,priceGranularity:i,bidderSequence:"random",pageUrl:`${window.location.protocol}//${window.location.host}`,useBidCache:!0,minBidCacheTTL:60,eventHistoryTTL:60,gptPreAuction:{enabled:!0,customPbAdSlot:function(M,x=`/${_t}`){let{appendDivIdToGpid:q=!0}=freestar.fsdata,V=x;return q&&(V+="/"+M),freestar.log({title:"GPID"},"Payload is:",V),V},mcmEnabled:!0},firstPartyData:{skipEnrichments:!0},cache:{url:"https://prebid.adnxs.com/pbc/v1/cache",ignoreBidderCacheKey:!0}};a.userSync.userIds=t.prebidNonRealTimeProvidersConfig,e.getBypassFirstAuction()||(e.getS2sBidders(rd).forEach(x=>{sr.includes(x)||sr.push(x)}),sr.length&&(window.freestar.log(49,"Setting s2sconfig..."),a.s2sConfig={accountId:"d0cd3243-716f-4f9c-b074-f72637de26f3",enabled:!0,bidders:sr,timeout:window.freestar.fsdata.timeout,adapter:"prebidServer",endpoint:"https://s2s.t13.io/openrtb2/auction",syncEndpoint:"https://s2s.t13.io/cookie_sync",cookieSet:!1,cookiesetUrl:"",allowUnknownBidderCodes:!0})),t.realtimeProviders.prebidAnalyticProviders.forEach(M=>{r.enableAnalytics(M)}),dn(window.freestar.locData)&&(a.consentManagement=a.consentManagement||{},a.consentManagement.gdpr={cmpApi:"iab",timeout:1200,allowAuctionWithoutConsent:!1},(m=(h=window.freestar)==null?void 0:h.consentLibrary)!=null&&m.gpp&&(a.consentManagement=a.consentManagement||{},a.consentManagement.gpp={cmpApi:"iab",timeout:1200})),Pi(window.freestar.locData)&&((b=(S=window.freestar)==null?void 0:S.consentLibrary)!=null&&b.gpp?(a.consentManagement=a.consentManagement||{},a.consentManagement.gpp={cmpApi:"iab",timeout:1200}):(_=(g=window.freestar)==null?void 0:g.consentLibrary)!=null&&_.usp&&(a.consentManagement=a.consentManagement||{},a.consentManagement.usp={cmpApi:"iab",timeout:1200}));let{enableClientBlocking:d,enableClientCategoryBlocking:c,enableClientBlockingUnknown:u}=window.freestar.fsdata.ortb||{};(d||c)&&(a.bidResponseFilter={cat:{enforce:c,blockUnknown:!!u},adv:{enforce:d,blockUnknown:!!u},attr:{enforce:!1,blockUnknown:!1}}),r.setConfig(a)};Pe.analytics=r=>{r.enableAnalytics([{provider:"freestar",options:{}}])};Pe.enableTIDs=()=>{window.fsprebid.setConfig({enableTIDs:!0})};Pe.enableRTDProviders=r=>{fsprebid.mergeConfig({realTimeData:{auctionDelay:50,dataProviders:r.realtimeProviders.getRtdProvidersConfig()}})};Pe.updateTimeouts=({bidderTimeout:r,s2sTimeout:e})=>{let t={bidderTimeout:r};sr.length&&(t.s2sConfig={timeout:e||r*.75}),window.fsprebid.setConfig(t),window.freestar.fsdata.timeout=r};var cu=Pe;var Un=({elementId:r})=>document.getElementById(r)&&r.indexOf("_fs-sf")===-1;var Gn=class{constructor({logger:e,delayMs:t=0}){this._logger=e,this._delayMs=t,this._queue=[],this._isProcessing=!1,this._processingTimeouts=new Set,this._queuedElementIds=new Set}enqueue(e){if(this._queuedElementIds.has(e.elementId)){this._logger.log(`Skipping duplicate queue entry for ${e.elementId}`);return}this._queue.push(e),this._queuedElementIds.add(e.elementId),this._logger.log(`Queued refresh for ${e.elementId}. Queue size: ${this._queue.length}`),this._isProcessing||this._processQueue()}_processQueue(){return y(this,null,function*(){if(!this._isProcessing){for(this._isProcessing=!0;this._queue.length>0;){let e=this._queue[0];try{this._logger.log(`Processing refresh for ${e.elementId}`),e.refreshFn(),this._queue.length>0&&this._delayMs>0&&(this._logger.log(`Delaying refresh for ${e.elementId} for ${this._delayMs}ms`),yield this._delay(this._delayMs)),this._queue.shift(),this._queuedElementIds.delete(e.elementId)}catch(t){this._logger.error(`Error processing refresh for ${e.elementId}:`,t),this._queuedElementIds.delete(e.elementId),this._queue.shift()}}this._isProcessing=!1}})}_delay(e){return new Promise(t=>{let i=setTimeout(()=>{this._processingTimeouts.delete(i),t()},e);this._processingTimeouts.add(i)})}clear(){this._queue=[],this._queuedElementIds.clear(),this._isProcessing=!1,this._processingTimeouts.forEach(e=>{clearTimeout(e)}),this._processingTimeouts.clear(),this._logger.log("Refresh queue cleared")}get size(){return this._queue.length}get isProcessing(){return this._isProcessing}};var Fn=class{constructor({renderBidMidwayManager:e,logger:t,dispensaryData:i,refreshers:s,globalRefreshUserIDsState:n,gamManager:o,freestar:a,win:d,eventBus:c,refreshLibrary:u}){E(this,"_counterEventsConfig",[{thresholdPercentageFrom:.75,thresholdPercentageTo:.85,handler:({elementId:e,refreshLibraryItem:t})=>{t.checkingForBid=!1,!(t.hasPrefetchCalled||!t.canBeRefreshed()||!t.isVisibilityThresholdMet())&&(t.hasPrefetchCalled=!0,this._prefetchBids({elementId:e,refreshLibraryItem:t}))}},{thresholdPercentageFrom:.8,handler:({elementId:e,refreshLibraryItem:t})=>{if(!xt({siteId:this._dispensaryData.fsdata.siteId,placement:t.placement})&&!Ut(t.placement)){let i=(t.timesRefreshed||0)+1;gt().prefetchFloorsData({placement:t.placement,slotId:e,timesRefreshed:i})}}},{thresholdPercentageFrom:.8,handler:({refreshLibraryItem:e})=>{var t;this._globalRefreshUserIDsState.allowed()&&((t=e.refreshUserIds)!=null&&t.requiresRefresh)&&(e.refreshUserIds.refresh(),this._globalRefreshUserIDsState.updateLastRefreshTime())}},{thresholdPercentageFrom:1,handler:({elementId:e,refreshLibraryItem:t})=>{!t.canBeRefreshed()||!t.isVisibilityThresholdMet()||(this._refresh({elementId:e,refreshLibraryItem:t}),t.hasPrefetchCalled=!1,t.refreshUserIds.reset())}}]);E(this,"_isTimeoutUpdatedForSubsequentAuctions",!1);E(this,"_handleIntersection",e=>{e.forEach(t=>{let{isIntersecting:i,intersectionRatio:s}=t,{id:n}=t.target;this._refreshLibrary.updateLibraryItem({slotId:n,attributes:{intersectionRatio:i?s:0}}),this._eventBus.emit(Tc,{id:n,isIntersecting:i,intersectionRatio:s})})});E(this,"_checkRefreshCap",()=>{let[e]=Object.values(this._refreshLibrary.items),{slotsCombinedRefreshCap:t}=this._dispensaryData.fsdata;if(!e||t===0)return;let i=t||eu;e.constructor.totalRefreshes>=i&&(this._logger.log(`Max refresh cap reached. Total Refreshes: ${e.constructor.totalRefreshes}, Cap: ${i}`),this._refreshLibrary.toggleRefreshForAll({disableRefresh:!0}))});this._renderBidMidwayManager=e,this._gamManager=o,this._window=d,this._freestar=a,this._eventBus=c,this._refreshLibrary=u,this._dispensaryData=i,this._logger=t,this._logger.setContext(hi),this._logger.setLevel(50),this._currentUrl=d.location.href,this._globalRefreshUserIDsState=n,this._observedElements=new Set,this._intervalId=null,this._freestar.refreshSlots=this.refreshSlots=[],this._refreshers=s,this._refreshQueue=new Gn({logger:this._logger,delayMs:this._dispensaryData.fsdata.refreshQueueDelay||0}),this._subscribeToEvents(),this._attachIntersectionObserver(),this._populateCounterEventsConfig(),this._startPolling()}_populateCounterEventsConfig(){var e;this._dispensaryData.fsdata.enableMidwayRender!==!1&&((e=this._counterEventsConfig)==null||e.unshift({thresholdPercentageFrom:.5,thresholdPercentageTo:.75,handler:({elementId:t,refreshLibraryItem:i})=>{i.checkingForBid||!i.canBeRefreshed()||!i.isVisibilityThresholdMet()||(i.checkingForBid=!0,this._renderBidMidwayManager.renderAd({elementId:t}))}}))}disableForItem({slotId:e,placementName:t}){this._refreshLibrary.toggleRefreshForItem({slotId:e,placementName:t,disableRefresh:!0})}enableForItem({slotId:e,placementName:t}){this._refreshLibrary.toggleRefreshForItem({slotId:e,placementName:t,disableRefresh:!1})}disable(){this._refreshLibrary.toggleRefreshForAll({disableRefresh:!0}),this._refreshQueue.clear()}enable(){this._refreshLibrary.toggleRefreshForAll({disableRefresh:!1})}pause(){this._refreshLibrary.updateAllItems({attributes:{pauseRefresh:!0}})}resume(){this._refreshLibrary.updateAllItems({attributes:{pauseRefresh:!1}})}addToLibrary({elementId:e}){let t=this._refreshLibrary.addToLibrary({elementId:e});if(!t)return;let i=this._window.document.getElementById(t.observedElementId);return i||(i=this._createObservedElement({targetElementId:e,observedElementId:t.observedElementId})),this._addToObserver(i),t}_createObservedElement({targetElementId:e,observedElementId:t}){let i=this._window.document.getElementById(e),s=this._window.document.createElement("div");return s.id=t,s.style.width="1px",s.style.height="0px",i.after(s),s}refresh({elementIds:e}={}){this._logger.log(["freestar.refresh: ",e]),e=e!=null?e:this._gamManager.instance.pubads().getSlots().map(({getSlotElementId:t})=>t()),e.forEach(t=>{if(!Un({elementId:t}))return;let i=this._refreshLibrary.getRefreshLibraryItem({slotId:t});i||(i=this.addToLibrary({elementId:t})),i&&this._refresh({elementId:t,refreshLibraryItem:i})})}refreshAll(){this._logger.log("freestar.refreshAllSlots");let e=this._gamManager.instance.pubads().getSlots();e==null||e.forEach(t=>{let i=t.getSlotElementId(),s=this._refreshLibrary.getRefreshLibraryItem({slotId:i});s!=null&&s.canBeRefreshed()&&this._refresh({elementId:i,refreshLibraryItem:s})})}refreshAllVisible(){let e=this._gamManager.instance.pubads().getSlots();e==null||e.forEach(t=>{let i=t.getSlotElementId(),s=this._refreshLibrary.getRefreshLibraryItem({slotId:i});s!=null&&s.isVisibilityThresholdMet()&&(s!=null&&s.canBeRefreshed())&&this._refresh({elementId:i,refreshLibraryItem:s})})}removeFromLibrary({elementId:e}){this._refreshLibrary.removeFromLibrary({elementId:e}),this._observedElements.delete(e);let t=this._window.document.getElementById(e);!this._observer||!t||this._observer.unobserve(t)}_eventMatchesDirectAdRefresh(e){return["advertiserId","campaignId","lineItemId","creativeId"].some(t=>{let i=e[t];return i!=null&&this._dispensaryData.fsdata.directAdRefreshTargeting.includes(i.toString())?(this._logger.log(1,`found ${t} ${i} in directAdRefreshTargeting, setting refresh ${this._dispensaryData.fsdata.directAdRefreshRate}.`),!0):!1})}setDirectAdRefresh(e){let t=this._dispensaryData.fsdata.directAdRefreshRate;this._refreshLibrary.updateLibraryItem({slotId:e,attributes:{refreshTime:t>0?t:-1,disableRefresh:t<=0}})}_subscribeToEvents(){this._gamManager.instance.pubads().addEventListener(mt,e=>{var t,i;try{this._dispensaryData.fsdata.customDirectAdRefresh&&this._eventMatchesDirectAdRefresh(e)&&this.setDirectAdRefresh(e.slot.getSlotElementId())}catch(s){}try{let s=e==null?void 0:e.slot,n=(t=s==null?void 0:s.getSlotElementId)==null?void 0:t.call(s),o=((i=s==null?void 0:s.getTargeting)==null?void 0:i.call(s,"fsrefresh"))||[],a=parseInt(o[0]||"0",10);n&&a>0&&this._eventBus.emit(wc,{elementId:n,refreshCount:a})}catch(s){}}),this._gamManager.instance.pubads().addEventListener(si,e=>{hr(e.slot.getSlotElementId())}),this._eventBus.subscribe(ni,({payload:{elementId:e,elementIds:t}})=>{t||(t=[e]),t.forEach(i=>{this.addToLibrary({elementId:i})})}),this._eventBus.subscribe(Ns,({payload:{elementId:e}})=>{this.removeFromLibrary({elementId:e})}),this._eventBus.subscribe(Ms,()=>{this._clearLibrary()}),this._eventBus.subscribe(xs,({payload:{elementId:e}})=>{this._refreshLibrary.updateLibraryItem({slotId:e,attributes:{hasIntersectLazyAd:!0}})})}_clearLibrary(){this._refreshLibrary.clearLibrary(),this._refreshQueue.clear()}_addToObserver(e){this._observer&&(this._observer.observe(e),this._observedElements.add(e.id))}_attachIntersectionObserver(){"IntersectionObserver"in this._window&&(this._observer=new this._window.IntersectionObserver(this._handleIntersection,Qf))}_startPolling(){this._intervalId||(this._intervalId=this._window.setInterval(()=>{var i,s;if(this._observedElements.forEach(n=>{if(!this._refreshLibrary.getRefreshLibraryItem({slotId:n})){this._observedElements.delete(n);let o=this._window.document.getElementById(n);o&&this._observer.unobserve(o)}}),this._window.document.hidden)return;let e=this._dispensaryData.fsdata.enableRefreshOutOfFocus===void 0?!0:!!this._dispensaryData.fsdata.enableRefreshOutOfFocus;if(!this._window.document.hasFocus()&&!e)return;let t=!1;(this._currentUrl!==this._window.location.href||this._placementsChangedViaUrl!==this._refreshLibrary.count)&&(t=!0,this._placementsChangedViaUrl=this._refreshLibrary.count,this._currentUrl=this._window.location.href);for(let n in this._refreshLibrary.items){let o=this._window.document.getElementById(n);if(!(o!=null&&o.id))continue;let a=this._refreshLibrary.getRefreshLibraryItem({slotId:n});a!=null&&a.canIncrementCounter()&&(a.incrementCounter(),this._counterEventsConfig.forEach(({thresholdPercentageFrom:d,thresholdPercentageTo:c,handler:u})=>{let f=a.refreshTime*d,p=c?a.refreshTime*c:null;a.refreshCounter>=f&&(!p||a.refreshCounter<p)&&u({refreshLibraryItem:a,elementId:n})}),(!this._observedElements.has(n)||t)&&(this._observedElements.add(n),(i=this._observer)==null||i.unobserve(o),(s=this._observer)==null||s.observe(o)))}},Jf))}_prefetchBids(i){return y(this,arguments,function*({elementId:e,refreshLibraryItem:t}){this._isTimeoutUpdatedForSubsequentAuctions||(cu.updateTimeouts({bidderTimeout:Xf}),this._isTimeoutUpdatedForSubsequentAuctions=!0);let s=t.placement,n=this._gamManager.instance.pubads().getSlots().find(o=>o.getSlotElementId()===e);n==null||n.setTargeting("fs_uuid",de()),t.isCounterStopped=!0,s&&!xt({siteId:this._dispensaryData.fsdata.siteId,placement:s})&&!Ut(s)&&(t.timesRefreshed+=1,yield gt().getFloorsData({placement:s,slotId:e,callback:({result:o})=>{t.timesRefreshed-=1,o&&n&&(Object.keys(o).forEach(a=>{n.setTargeting(a,o[a])}),freestar.log({title:"FLOORS"},e,"Refreshed floors value.",o))}})),j().refreshData(),t.isCounterStopped=!1;for(let o of this._refreshers)if(o.shouldRefresh({elementId:e,placement:s,refreshLibraryItem:t})){o.fetchBids({elementId:e,placement:s,refreshLibraryItem:t}),this._logger.log(`Making bid ahead of time ${e}`);break}})}_refresh({refreshLibraryItem:e,elementId:t}){this._refreshQueue.enqueue({elementId:t,refreshLibraryItem:e,refreshFn:()=>this._executeRefresh({elementId:t,refreshLibraryItem:e})})}_executeRefresh(i){return y(this,arguments,function*({refreshLibraryItem:e,elementId:t}){let s=e.placement;e.refreshCounter=1,e.timesRefreshed+=1;for(let n of this._refreshers)if(n.shouldRefresh({elementId:t,placement:s,refreshLibraryItem:e})){n.refresh({elementId:t,placement:s,refreshLibraryItem:e});break}this._checkRefreshCap()})}resetCapCounter(){let[e]=Object.values(this._refreshLibrary.items);e&&(e.constructor.totalRefreshes=0,this._logger.log("Resetting refresh cap counter"))}};T.class(Fn,{token:l.AD_REFRESHER,dependencies:[{token:l.WINDOW,alias:"win"},l.FREESTAR,l.DISPENSARY_DATA,l.EVENT_BUS,l.LOGGER,l.RENDER_BID_MIDWAY,l.GLOBAL_REFRESH_USER_IDS_STATE,l.GAM_MANAGER,l.REFRESH_LIBRARY,l.DEFAULT_REFRESHER,{token:l.SUPERFLEX_REFRESHER,optional:!0},{token:l.STICKY_FOOTER_REFRESHER,optional:!0},l.AD_BLOCK],factory:e=>y(void 0,[e],function*({dependencies:r}){if(r.adBlock.adBlockerDetected)return new ir(r,"Ad refresh is disabled when Ad blocker is on");let{isRefreshAllowed:t}=j().determineAdRefreshBehavior();if(!t)return new ir(r);let i=[r.defaultRefresher];return r.stickyFooterRefresher&&i.unshift(r.stickyFooterRefresher),r.superflexRefresher&&i.unshift(r.superflexRefresher),new Fn(L(A({},r),{refreshers:i}))})});var Vn=class{constructor(){this.requiresRefresh=!0}reset(){this.requiresRefresh=!0}refresh(){this.requiresRefresh=!1,window.fsprebid.refreshUserIds()}};var qn=class qn{constructor({placement:e,elementId:t,refreshAttributes:i={},siteRefreshRate:s,freestar:n,logger:o,win:a=window,enableRefreshCounterOutOfView:d,collapseEmptyDivs:c}={}){let{refreshTime:u,isCounterStopped:f,refreshCounter:p,disableRefresh:h,pauseRefresh:m,intersectionRatio:S,checkingForBid:b,timesRefreshed:g,hasPrefetchCalled:_,hasIntersectLazyAd:M,refreshUserIds:x}=i;if(this._freestar=n,this._logger=o,this.placement=e,this.placementName=e.name,this._siteRefreshRate=s,this.refreshTime=u||this._getPlacementAdRefreshRate(),this.isCounterStopped=f!=null?f:!1,this.checkingForBid=b!=null?b:!1,this.hasPrefetchCalled=_!=null?_:!1,this.pauseRefresh=m!=null?m:!1,this.refreshCounter=p!=null?p:0,this.intersectionRatio=S!=null?S:0,this._timesRefreshed=g!=null?g:0,this.hasIntersectLazyAd=M!=null?M:!1,this.elementId=t,this.observedElementId=c?`${t}_tracker`:t,this.enableRefreshCounterOutOfView=d!=null?d:!0,typeof h!="boolean"){this.disableRefresh=!1;let q=a.document.getElementById(t);(Number(q==null?void 0:q.getAttribute("data-refresh-time"))===-1||e.outOfPage===!0)&&(this.disableRefresh=!0)}else this.disableRefresh=h;this.refreshUserIds=x!=null?x:new Vn}canBeRefreshed(){var e,t;return!((e=this.placement)!=null&&e.lazyAd&&!this.hasIntersectLazyAd&&((t=this.placement.selectedSize)==null?void 0:t.lazyLoadViewportHeight)>0||this.disableRefresh||this.pauseRefresh)}toggleRefresh(e){this.disableRefresh=e,this.refreshTime=e?0:this._getPlacementAdRefreshRate()}setRefreshCounter(e){this.refreshCounter=e}setRefreshTime(e){this.refreshTime=e||this._getPlacementAdRefreshRate()}isVisibilityThresholdMet(){return this.intersectionRatio>Zf}incrementCounter(){if(!(this.refreshCounter>=this.refreshTime)){if(isNaN(this.refreshCounter)){this.refreshCounter=1;return}this.refreshCounter+=1}}canIncrementCounter(){var t;return((t=this.placement)==null?void 0:t.lazyAd)&&!this.hasIntersectLazyAd?(this.refreshCounter=0,!1):this.disableRefresh||this.isCounterStopped||this.refreshTime<=0||this.refreshCounter<0||!this.enableRefreshCounterOutOfView&&!this.isVisibilityThresholdMet()?!1:(this._logger.log(`${this.elementId} ${this.refreshCounter}`),!0)}_getPlacementAdRefreshRate(){let{ignoreSiteRefresh:e,adRefreshRate:t}=this.placement,i=e?t:this._siteRefreshRate;return this._getConfigOverrides({refreshRate:i})}_getConfigOverrides({refreshRate:e}){var t;if(!this._freestar.config.products)return e;for(let i of tu){if(!((t=this._freestar.config.products)!=null&&t[i])||!kt({placement:this.placement,type:`${i}Options`}))continue;let{refreshDisabled:n,refreshInterval:o}=this._freestar.config.products[i];if(n)return 0;if(o>15)return o}return e}get timesRefreshed(){return this._timesRefreshed}set timesRefreshed(e){qn.totalRefreshes+=e-this._timesRefreshed,this._timesRefreshed=e}};E(qn,"totalRefreshes",0);var Hn=qn;var sd=class{constructor({logger:e,dispensaryData:t,freestar:i,win:s}){this._window=s,this._dispensaryData=t,this._logger=e,this._logger.setContext(hi),this._logger.setLevel(50),this._freestar=i,this._freestar.refreshLibrary=this.items={}}get count(){return this.items.length}get globalRefreshCount(){let[e]=Object.values(this.items);return(e==null?void 0:e.totalRefreshes)||0}getRefreshLibraryItem({slotId:e,placementName:t}){var i;return(i=this.items[e])!=null?i:Object.values(this.items).find(s=>s.placementName===t||s.observedElementId===e)}addToLibrary({elementId:e}){var d;if(!Un({elementId:e}))return;let{adRefreshRate:t,enableRefreshCounterOutOfView:i,placements:s}=this._dispensaryData.fsdata,n=ie({freestar:this._freestar,slotId:e}),o=s.find(c=>c.name===n);if(!o||((d=o.interstitialOptions)==null?void 0:d.active)===!0){this._logger.log(`Cannot find placement for AD slot: ${e}`,{level:20});return}let a=new Hn({placement:o,elementId:e,refreshAttributes:this.items[e],siteRefreshRate:t,freestar:this._freestar,logger:this._logger,win:this._window,enableRefreshCounterOutOfView:i,collapseEmptyDivs:this._dispensaryData.fsdata.collapseEmptyDivs});return Object.assign(this.items,{[e]:a}),this.items[e]}removeFromLibrary({elementId:e}){this.items[e]&&delete this.items[e]}toggleRefreshForAll({disableRefresh:e}){var t;for(let i in this.items)(t=this.items[i])==null||t.toggleRefresh(e)}toggleRefreshForItem({slotId:e,placementName:t,disableRefresh:i}){let s=this.getRefreshLibraryItem({slotId:e,placementName:t});s==null||s.toggleRefresh(i)}updateAllItems({attributes:e}){for(let t in this.items){let i=this.items[t];Object.assign(i,e)}}updateLibraryItem({slotId:e,placementName:t,attributes:i}){let s=this.getRefreshLibraryItem({slotId:e,placementName:t});s&&Object.assign(s,i)}clearLibrary(){for(let e in this.items)this.removeFromLibrary({elementId:e})}};T.class(sd,{token:l.REFRESH_LIBRARY,dependencies:[{token:l.WINDOW,alias:"win"},l.FREESTAR,l.LOGGER,l.DISPENSARY_DATA]});var nd={LANDSCAPE:"landscape",MOBILE:"mobile"},fu=1e3;var nr=({width:r,height:e})=>r>e?nd.LANDSCAPE:nd.MOBILE;var od=class{constructor({dispensaryData:e,freestar:t,eventBus:i,adRefresher:s,gamManager:n,adSlotsManager:o,win:a=window}){this._dispensaryData=e,this._freestar=t,this._adRefresher=s,this._eventBus=i,this._gamManager=n,this._adSlotManager=o,this._win=a,this.orientation=this._currentDeviceOrientation,this._shouldRecreateSlots=this._dispensaryData.fsdata.reorientationRefresh&&!this._freestar.config.disableReorientation&&[Ve,jr].indexOf(this._freestar.deviceInfo.device.type)>-1,this._shouldRecreateSlots&&!t.config.alwaysRefresh&&(t.config.alwaysRefresh=e.fsdata.placements.map(({name:d})=>d)),this._subscribeToEvents()}_subscribeToEvents(){this._win.visualViewport.addEventListener("resize",Lr(()=>{this.orientation!==this._currentDeviceOrientation&&(this.orientation=this._currentDeviceOrientation,this._eventBus.emit(bc,{orientation:this.orientation}),this._onOrientationChange())},fu))}_recreateSlot(e){this._adSlotManager.deleteAdSlots([e.name]);let t=this._gamManager.createSlot({placement:e,id:e.name});$i(t,e.name,{fs_ad_product:he(e),fs_ad_optimization:Je(e)})}_onOrientationChange(){Jc(),this._shouldRecreateSlots&&this._recreateSlots()}_recreateSlots(){let e=[],t=this._freestar.config.removeRefresh||[],i=this._freestar.config.alwaysRefresh||[];this._dispensaryData.fsdata.placements.forEach(s=>{document.getElementById(s.name)&&(this._freestar.config.enabled_slots&&this._freestar.config.enabled_slots.indexOf(s.name)>-1&&!s.stickyFooter&&t.indexOf(s.name)===-1?(this._recreateSlot(s),e.push(s.name)):i.indexOf(s.name)>-1&&(this._recreateSlot(s),e.push(s.name)))}),e.length&&this._adRefresher.refresh({elementIds:e})}get _currentDeviceOrientation(){let e=this._win.innerWidth||this._win.document.documentElement.clientWidth,t=this._win.innerHeight||this._win.document.documentElement.clientHeight;return nr({width:e,height:t})}};T.class(od,{token:l.DEVICE_ORIENTATION_TRACKER,dependencies:[l.WINDOW,l.FREESTAR,l.DISPENSARY_DATA,l.EVENT_BUS,l.AD_REFRESHER,l.GAM_MANAGER,l.AD_SLOTS_MANAGER]});var ad=class{constructor({logger:e,adRefresher:t,dispensaryData:i,freestar:s,win:n=window}){E(this,"keyboardIsOpen",!1);E(this,"resizeDelay",1e3);var o,a,d,c;!i.fsdata.pauseRefreshOnVirtualKeyboard||[Ve,jr].indexOf(s.deviceInfo.device.type)===-1||(this._freestar=s,this._adRefresher=t,this._logger=e,this._logger.setContext(l.VIRTUAL_KEYBOARD_REFRESH_CONTROL),this._win=n,this.initialOrientation=nr({width:(a=(o=this._win)==null?void 0:o.visualViewport)==null?void 0:a.clientWidth,height:(c=(d=this._win)==null?void 0:d.visualViewport)==null?void 0:c.clientHeight}),this.maxViewportHeight=this._getMaxViewportHeight(),this._attachListeners())}_attachListeners(){this._win.visualViewport.addEventListener("resize",e=>this.onResizeDelayed(e))}_getMaxViewportHeight(){let e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="1px",e.style.height="100svh",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetHeight;return e.remove(),t}onResizeDelayed(){this.keyboardIsOpen?(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this._onResize()},this._freestar.keyboardRefreshControlDelay||this.resizeDelay)):(clearTimeout(this.resizeTimeout),this._onResize())}_onResize(){var i,s;let e=this._win.visualViewport.height,t=nr({width:(i=document==null?void 0:document.documentElement)==null?void 0:i.clientWidth,height:(s=document==null?void 0:document.documentElement)==null?void 0:s.clientHeight});t!==this.initialOrientation?(this.initialOrientation=t,this.maxViewportHeight=this._getMaxViewportHeight()):e>this.maxViewportHeight&&(this.maxViewportHeight=e),e<.9*this.maxViewportHeight?this.keyboardIsOpen||(this.keyboardIsOpen=!0,this.onKeyboardOpen()):this.keyboardIsOpen&&(this.keyboardIsOpen=!1,this.onKeyboardClose())}onKeyboardOpen(){this._logger.log("Keyboard opened, pausing ad refresh."),this._adRefresher.pause()}onKeyboardClose(){this._logger.log("Keyboard closed, resuming ad refresh."),this._adRefresher.resume()}};T.class(ad,{token:l.VIRTUAL_KEYBOARD_REFRESH_CONTROL,dependencies:[l.LOGGER,l.AD_REFRESHER,l.DISPENSARY_DATA,l.FREESTAR,{token:"window",alias:"win"}]});function uu({placement:r,product:e=void 0,callback:t=void 0,timeout:i=!1,timestamp:s=!1}){this.placement=r,this.product=e,this.productKey=e+"Options",this.timeout=i,this.timestamp=s,this.resetIteration=()=>{this.iteration=0,sessionStorage.setItem(this.key,this.iteration.toString()),freestar.log(1,"Frequency Cap : reset iteration")},this.cleanUpIfTimedOut=()=>{this.timeout&&Date.now()-this.timestamp>=this.timeout&&(this.resetIteration(),this.timestamp=Date.now())},this.incrementIteration=()=>{this.iteration++,sessionStorage.setItem(this.key,this.iteration.toString())},this.subtractIteration=()=>{freestar.log(1,"Frequency Cap : iteration will remove this attempt as an iteration. Setting new sessionStorage item value."),this.iteration--,sessionStorage.setItem(this.key,this.iteration.toString())},this.fetchCap=()=>this.placement[this.productKey]&&r[this.productKey].cap>0?r[this.productKey].cap:-1,this.fetchIteration=()=>{let n=sessionStorage.getItem(this.key);return Number(n)?Number(n):0},this.allowProduct=()=>this.cap>0?this.iteration>=this.cap?(freestar.log(1,`Frequency Cap: iteration of ${this.iteration} is higher than cap of ${this.cap}. ${this.product} will not run again until the ${this.timeout?"timeout":"session"} ends.`),!1):(freestar.log(1,`Frequency Cap: iteration of ${this.iteration+1} is lower than or equal to the cap of ${this.cap}. Continue with ${this.product}.`),!0):!1,this.cap=this.fetchCap(),this.key=`fs.${this.product}.${this.placement.name}.frequencycap`,this.iteration=this.fetchIteration(),this.callback=t}var or="rbm",xM=`fs.${or}`,hu=["ttd","ttdfsx","ttds2s"],dd="RENDER BID MIDWAY V1.0.0",pu={title:dd,styles:"background: black; color: white; border-radius: 3px; padding: 3px"};var gu=1;var ar={blockedSiteIDs:[1575,1910,1748,1841,6326,2410,1783,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1690,1691,1692,1693,1694,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1985,2095,2132,2170,2232,2244,2511,5491,1756,2372,1556,2086,2087,2192,2193,2194,2195,2196,2197,2198,2199,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2351,2352,2353,2354,2355,2356,2357,2358,2359,2360,2361,2362,2363,2364,2365,2366,2367,2394,2395,2396,2397,2398,2399,2400,2401,2402,2403,2404,2405,2426,3516,5344,3107,3108,3109,3110,3111,3234,6152,6603,1556,1495,6302],default:{percentage:.4},siteSpecific:[{activeSiteIds:[6615,6125,533],percentage:.5},{activeSiteIds:[5926,5927,5928,5929,5930,5931,5932,5933,5934,5935,5936,5937,5938,5939,5940,5941,5942,5943,5944,5960],percentage:2},{activeSiteIds:[7185],percentage:.4,timeout:60*1e3*5}]},mu=()=>{let r=JSON.parse(G({key:`fs.${or}`}))||{};if(!ar.blockedSiteIDs.includes(freestar.fsdata.siteId)&&typeof r.inTest=="undefined"){let e=ar.siteSpecific.filter(s=>{if(s.activeSiteIds.includes(freestar.fsdata.siteId))return s}).shift(),t=(e==null?void 0:e.percentage)||ar.default.percentage,i=Math.random();r.inTest=i<t,e!=null&&e.timeout&&(r.timeout=e==null?void 0:e.timeout,r.timestamp=Date.now()),ee({key:`fs.${or}`,value:r,type:k.object})}return r.inTest&&r.side===1&&freestar.log(pu,"Session is participating in test..."),B(`fs-use-${or}`)||r.inTest},_u=()=>ar.siteSpecific.filter(e=>{if(e.activeSiteIds.includes(freestar.fsdata.siteId))return e}).shift()||ar.default;var ld=class{constructor({placement:e,nativeRenderManager:t,prebid:i=null,logger:s,analytics:n}){this.placement=e,this.prebid=i,this._analytics=n,this._logger=s,this._nativeRenderManager=t,this.placement.rbmOptions={cap:gu};let o=_u();this.frequencyCapManager=new uu({placement:this.placement,product:"rbm",timeout:o==null?void 0:o.timeout,timestamp:o==null?void 0:o.timestamp})}renderAd(){if(!this.prebid||(this.frequencyCapManager.cleanUpIfTimedOut(),this._logger.log([this.prebid.code,`Can render an ad? ${this.frequencyCapManager.allowProduct()}`]),!this.frequencyCapManager.allowProduct()))return;let e=this._nativeRenderManager.getHighestBid(this.prebid.code,hu);this._logger.log([this.prebid.code,`Found an ad?? ${!!e}`]),e&&this._nativeRenderManager.renderAd(e,this.prebid.code).then(()=>{this.frequencyCapManager.incrementIteration();let{adId:t}=e;this._analytics.track(new $({eventName:"RENDER_BID_MIDWAY",eventType:"SUCCESS",data:{adId:t}}))}).catch(t=>{this._logger.log([this.prebid.code,`Error native rendering prebid ad: ${t}`])})}},cd=class{constructor({nativeRenderManager:e,logger:t,analytics:i}){this._nativeRenderManager=e,this._logger=t,this._analytics=i,this._logger.setContext(dd),this.trackers={}}renderAd({elementId:e}){if(mu())try{if(!this._nativeRenderManager.isEnabled){this._logger.log("Native render is not enabled");return}let t=this.getAdUnit(e);if(!t){this._logger.log(`No adUnit found for elementId: ${e}`);return}let{placement:i,prebid:s}=t;if(!(i!=null&&i.name)){this._logger.log(`Invalid placement for elementId: ${e}`);return}this.ensureTracker(i,s),this.trackers[i.name].renderAd()}catch(t){this._logger.log(`Error in renderAd: ${t.message}`)}}getAdUnit(e){return this.adUnitManager||(this.adUnitManager=te),this.adUnitManager.getAdUnitBySlotElementId(e)||this.adUnitManager.getAdUnitByPrebidCode(e)}ensureTracker(e,t){this.trackers[e.name]||(this.trackers[e.name]=new ld({placement:e,prebid:t,nativeRenderManager:this._nativeRenderManager,logger:this._logger,analytics:this._analytics}))}};T.class(cd,{token:l.RENDER_BID_MIDWAY,dependencies:[l.NATIVE_RENDER_MANAGER,l.LOGGER,l.ANALYTICS]});var Kp=6e3,fd=class{constructor(){this.lastRefreshTime=0}allowed(){return Date.now()-this.lastRefreshTime>Kp}updateLastRefreshTime(){this.lastRefreshTime=Date.now()}};T.class(fd,{token:l.GLOBAL_REFRESH_USER_IDS_STATE});var zn=class{constructor(){E(this,"_bidRequestLibrary",new Map)}getSignal(e){return this._bidRequestLibrary.has(e)&&(this._bidRequestLibrary.get(e).reject(),this._bidRequestLibrary.delete(e)),new Promise((t,i)=>{this._bidRequestLibrary.set(e,{resolve:t,reject:i})})}getPendingRequest(e){return this._bidRequestLibrary.has(e)?()=>{this._bidRequestLibrary.get(e).resolve(),this._bidRequestLibrary.delete(e)}:null}shouldRefresh(){return!0}fetchBids(){}refresh(){}};var ud=class extends zn{constructor({gamManager:e,logger:t,freestar:i,rebidManager:s,bidsManager:n}){super(),this._gamManager=e,this._freestar=i,this._logger=t,this._rebidManager=s,this._bidsManager=n}fetchBids({elementId:e,refreshLibraryItem:t}){let i=this.getSignal(e);t.dataRefreshId=de(),this._freestar.refreshSlots.push({refreshId:t.dataRefreshId});let s=this._gamManager.instance.pubads().getSlots().find(n=>n.getSlotElementId()===e);this._bidsManager.requestBids({elementIds:[e],slots:[s],sendAdserverSignal:i})}refresh({elementId:e,refreshLibraryItem:t}){var n;this._logger.log(`freestar.refresh ${e}`),this._rebidManager.reset({elementId:e}),t.setRefreshTime();let i=this._gamManager.instance.pubads().getSlots().find(o=>o.getSlotElementId()===e);i.setTargeting("fsrefresh",`${(n=t.timesRefreshed)!=null?n:0}`);let s=this.getPendingRequest(e);typeof s=="function"?s():(t.dataRefreshId=de(),this._freestar.refreshSlots.push({refreshId:t.dataRefreshId}),this._bidsManager.requestBids({elementIds:[e],slots:[i]}))}};T.class(ud,{token:l.DEFAULT_REFRESHER,dependencies:[l.FREESTAR,l.LOGGER,l.REBID_MANAGER,l.GAM_MANAGER,l.BIDS_MANAGER]});var hd=class{constructor({bidsManager:e,analytics:t,gamManager:i,logger:s}){this._bidsManager=e,this._gamManager=i,this._analytics=t,this._logger=s,this._logger.setContext(l.REBID_MANAGER),this._idealAdStackManager=j(),this.map={}}getStatus({adUnitCode:e=null}){if(e)return this.getStatusByAdUnitCode({adUnitCode:e})}getStatusByAdUnitCode({adUnitCode:e}){return this.map[e]}isAbleToRebid({elementId:e}){return this.map[e]?this.map[e].count<1:!0}isValidPlacement({placement:e=!1}){return e&&!e.interstitialOptions.active}rebid({elementId:e,slot:t}){this._logger.log(`Rebidding for ${e}`),this._bidsManager.requestBids({elementIds:[e],slots:t})}handleAdBlocked({elementId:e}){if(!this._idealAdStackManager.isRebidAllowed()){this._logger.log(`DAS rebid rules prevent rebid for blocked ad on ${e}`);return}if(!this.isAbleToRebid({elementId:e})){this._logger.log(`Blocked ad rebid attempts exceeded for ${e}`);return}this.track({elementId:e});let t=Z({name:ie({slotId:e})}),i=this._gamManager.instance.pubads().getSlots().find(s=>s.getSlotElementId()===e);i&&this.updateKeyValues({slot:i,data:{[K.REBID]:String(this.map[e].count)}}),gt().getFloorsData({placement:t,slotId:e,callback:({result:s})=>{this._logger.log(`Floors called for rebid for blocked ad on ${t.name}`),s&&i.updateTargetingFromMap(s),this.rebid({elementId:e,slot:i})},isRebid:!0})}handleNoBidScenario(e,t){let{slot:i}=e,s=Z({name:ie({slotId:t})});if(this._analytics.track(new $({eventName:`EVENT_IS_EMPTY_CAN_REBID=${this.isValidPlacement({placement:s})&&this.isAbleToRebid({elementId:t})}`,eventType:"REBID",data:{event:e}})),!!this.isValidPlacement({placement:s})){if(this.isAbleToRebid({elementId:t})){this.track({elementId:t}),this.updateKeyValues({slot:i,data:{[K.REBID]:String(this.map[t].count)}}),gt().getFloorsData({placement:s,slotId:t,callback:({result:n})=>{this._logger.log(`Floors called for rebid for blocked ad on ${s.name}`),n&&i.updateTargetingFromMap(n),this.rebid({elementId:t,slot:i})},isRebid:!0});return}this._logger.log(`Rebid attempts exceeded ${t}`),this.reset({elementId:t})}}resetRebidStatus(e){this.map[e]&&(this.reset({elementId:e}),this._logger.log(`Rebid successful ${e}`))}reset({elementId:e}){let t=this._gamManager.getSlot({elementId:e});t&&this.updateKeyValues({slot:t,data:{[K.REBID]:"0"}}),delete this.map[e]}track({elementId:e,type:t="EMPTYRESPONSE"}){this.map[e]||(this.map[e]={count:0,type:t}),this.map[e].count+=1}updateKeyValues({slot:e,data:t}){e.updateTargetingFromMap(t)}};T.class(hd,{token:l.REBID_MANAGER,dependencies:[l.BIDS_MANAGER,l.ANALYTICS,l.LOGGER,l.GAM_MANAGER]});var Eu={sampleInterval:6e4,maxSnapshots:180,warningThresholdMb:200,criticalThresholdMb:500,minLeakThreshold:512e3};var yt=r=>{let e=["B","KB","MB","GB"],t=r,i=0;for(;t>=1024&&i<e.length-1;)t=t/1024,i++;return`${t.toFixed(2)} ${e[i]}`};var Yn=class{constructor(e){this._logger=e.logger,this._logger.setContext(l.MEMORY_MONITOR),this._analytics=e.analytics,this._deviceInfo=e.deviceInfo,this._geoInfo=e.geoInfo,this._refreshLibrary=e.refreshLibrary;let i=!!G({key:Ne}),s=window.performance&&window.performance.memory,n=i||Math.random()<=.05;if(!s||!n){this.enabled=!1,this.intervalId=null;return}this.enabled=!0,this.snapshots=[],this.intervalId=null,this.options=A({},Eu)}start(){this.enabled&&(this._takeSnapshot(),this.intervalId||(this.intervalId=setInterval(()=>this._takeSnapshot(),this.options.sampleInterval)))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}_getDisplayedAdsCount(){var i;let e=Object.keys(((i=window==null?void 0:window.freestar)==null?void 0:i.refreshLibrary)||{}).length||0,t=this._refreshLibrary.globalRefreshCount;return e+t}_getMemoryUsage(){let{usedJSHeapSize:e=0,totalJSHeapSize:t=0,jsHeapSizeLimit:i=0}=window.performance&&window.performance.memory||{};return{usedJSHeapSize:e,totalJSHeapSize:t,jsHeapSizeLimit:i}}_takeSnapshot(){let e=this._getMemoryUsage(),t=Date.now();if(this.snapshots.length>0){let i=this.snapshots[this.snapshots.length-1],s=(t-i.timestamp)/1e3,n=e.usedJSHeapSize-i.usedJSHeapSize,o=1024*1024,a=n/s/o,d=a*60;this._trackGrowthRate({currentUsage:e.usedJSHeapSize,previousUsage:i.usedJSHeapSize,memoryDiff:n,growthRatePerSecond:a,growthRatePerMinute:d,timeDiffSeconds:s})}this.snapshots.push(A({timestamp:t},e)),this.snapshots.length>this.options.maxSnapshots&&this.snapshots.shift(),e.usedJSHeapSize>this.options.criticalThresholdMb*1024*1024?this._handleCriticalMemory(e):e.usedJSHeapSize>this.options.warningThresholdMb*1024*1024&&this._handleWarningMemory(e)}_trackGrowthRate({currentUsage:e,previousUsage:t,memoryDiff:i,growthRatePerSecond:s,growthRatePerMinute:n,timeDiffSeconds:o}){let a=this._formatDeviceInfo(),d=this._getDisplayedAdsCount(),c=new $({eventName:"MEMORY_MONITOR",eventType:"GROWTH_RATE",data:{currentUsage:e,previousUsage:t,memoryDiff:i,growthRatePerSecond:s.toFixed(2),growthRatePerMinute:n.toFixed(2),timeDiffSeconds:o,currentUsageFormatted:yt(e),deviceInfo:a,timestamp:Date.now(),adsCount:d}});this._analytics.track(c)}_detectMemoryLeak(){if(this.snapshots.length<3)return null;let e=this.snapshots.slice(-3),t=[];for(let s=1;s<e.length;s++){let n=e[s-1],o=e[s],a=(o.timestamp-n.timestamp)/1e3,c=(o.usedJSHeapSize-n.usedJSHeapSize)/a;t.push(c)}return t.every(s=>s>this.options.minLeakThreshold)?{averageGrowthRate:t.reduce((s,n)=>s+n,0)/t.length,lastSnapshot:this.snapshots[this.snapshots.length-1]}:null}getReport(){if(this.snapshots.length===0)return null;let e=this.snapshots[this.snapshots.length-1],t=this.snapshots[0],i=e.usedJSHeapSize-t.usedJSHeapSize,s=(e.timestamp-t.timestamp)/1e3;return{currentUsage:yt(e.usedJSHeapSize),totalGrowth:yt(i),growthRate:yt(i/s)+"/s",snapshots:this.snapshots,potentialLeak:this._detectMemoryLeak()}}_handleWarningMemory(e){this._logger.log(`Memory usage warning: ${yt(e.usedJSHeapSize)}`)}_handleCriticalMemory(e){this._logger.log(`Critical memory usage: ${yt(e.usedJSHeapSize)}`);let t=this._formatDeviceInfo(),i=this._getDisplayedAdsCount();this._analytics.track(new $({eventName:"MEMORY_MONITOR",eventType:"CRITICAL",data:{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit,formattedUsed:yt(e.usedJSHeapSize),deviceInfo:t,timestamp:Date.now(),adsCount:i}}))}_formatDeviceInfo(){var t,i,s,n,o,a,d,c;let e=(t=this._geoInfo)==null?void 0:t.iso;return{browser:{name:(i=this._deviceInfo.browser)==null?void 0:i.name,version:(s=this._deviceInfo.browser)==null?void 0:s.version},device:{type:(n=this._deviceInfo.device)==null?void 0:n.type,os:(o=this._deviceInfo.os)==null?void 0:o.name,osVersion:(a=this._deviceInfo.os)==null?void 0:a.version},engine:{name:(d=this._deviceInfo.engine)==null?void 0:d.name,version:(c=this._deviceInfo.engine)==null?void 0:c.version},geo:{country:e}}}};T.class(Yn,{token:l.MEMORY_MONITOR,defaultAlias:"memoryMonitor",dependencies:[l.LOGGER,l.FREESTAR,l.ANALYTICS,l.DEVICE_INFO,l.GEO_INFO,l.REFRESH_LIBRARY],factory:({dependencies:r})=>new Yn(r)});var bt=class{getElement(){throw new Error("Method not implemented.")}destroy(){}get enabled(){return!0}};var Wp="fsbranding",$n=class extends bt{constructor({placement:e,dispensaryData:t,win:i=window}){super(),this._win=i,this._placement=e,this._dispensaryData=t}get enabled(){return!!this.getLogoUrl(this._placement)}getElement(){return this.enabled?F({type:"a",style:{color:"#999"},attributes:{href:this.getLink(this._placement),target:"_blank",rel:"noreferrer"},textContent:"Freestar.com"},this._win.document):null}getLogoUrl(){var s,n,o;let e=B(Wp,this._win);if((s=this._placement)!=null&&s.freestarBrandingDisabled&&!e)return null;let{branding:t}=this._dispensaryData.fsdata,i=ji(t);return e&&(i=ji(se.GREEN)),(o=(n=this._placement)==null?void 0:n.stickyFooterOptions)!=null&&o.active?i:[se.GREEN_FOOTER_ONLY,se.GRAYSCALE_FOOTER_ONLY].includes(t)?null:i}getLink(e){let t=he(e);return`https://ads.${wr}/?${new URLSearchParams({[yi]:"branding",[Ai]:t,[Si]:this._dispensaryData.fsdata.domain,[bi]:e.name}).toString()}`}},pd=class extends $n{getElement(){let e=this.getLogoUrl(this._placement);return e?F({type:"div",classList:["__fs-branding"],children:[F({type:"a",attributes:{href:this.getLink(this._placement),target:"_blank",rel:"noreferrer"},children:[F({type:"img",src:e,attributes:{alt:"freestar",width:"14",height:"14"}},this._win.document)]},this._win.document)]},this._win.document):null}},gd=class{constructor({dispensaryData:e,win:t}){this._dispensaryData=e,this._win=t}createLink(e){return new $n(this._getParams(e))}createIcon(e){return new pd(this._getParams(e))}getGlobalBranding(){let{branding:e}=this._dispensaryData.fsdata;return!e||[se.NO_BRANDING,se.GRAYSCALE_FOOTER_ONLY,se.GREEN_FOOTER_ONLY].includes(e)?null:e}_getParams(e){return{placement:e,dispensaryData:this._dispensaryData,win:this._win}}};T.class(gd,{token:l.BRANDING,dependencies:[l.DISPENSARY_DATA,{token:l.WINDOW,alias:"win"}]});var md="Report This Ad",Qp="fsreportad",jn=class extends bt{constructor({id:t,placement:i,confiantReportThisAdEnabled:s,idealAdStackManager:n,confiant:o,win:a=window}){super();E(this,"_report",t=>{t.preventDefault(),t.stopPropagation(),this._confiant.reportSingleAd(this._id)});this.placement=i,this._confiantReportThisAdEnabled=s,this._confiant=o,this._id=t,this._win=a,this._idealAdStackManager=n,this._abortController=new AbortController,this._createElement()}getElement(){return this._element}destroy(){var t;this._abortController.abort(),(t=this._element)==null||t.remove(),this._element=null}_createElement(){throw new Error("Method not implemented.")}get enabled(){var i,s;return B(Qp,this._win)?!0:(s=(i=this.placement)==null?void 0:i.adQualityOptions)!=null&&s.disabled?!1:!!(gc()==="CONFIANT"&&this._confiantReportThisAdEnabled&&this._idealAdStackManager.allowConfiant())}},_d=class extends jn{_createElement(){this.enabled&&(this._element=F({type:"button",classList:["fs-report-ad-button"],attributes:{"aria-label":md},innerHTML:md},this._win.document),this._element.addEventListener("click",this._report,{signal:this._abortController.signal}))}},Ed=class extends jn{_createElement(){if(!this.enabled)return null;let e=F({type:"button",classList:["fs-report-ad-button-icon"],attributes:{"aria-label":md}},this._win.document);e.addEventListener("click",this._report,{signal:this._abortController.signal}),this._element=F({children:[e]},this._win.document)}},Id=class{constructor({dispensaryData:e,win:t,idealAdStackManager:i,adQualityManager:s}){var n,o;this._confiant=s.provider,this._win=t,this._idealAdStackManager=i,this._confiantReportThisAdEnabled=(o=(n=e.fsdata)==null?void 0:n.adQualityOptions)==null?void 0:o.confiantReportThisAdEnabled}createTextButton(e,t){return new _d(this._getParams(e,t))}createIconButton(e,t){return new Ed(this._getParams(e,t))}_getParams(e,t){return{id:e,placement:t,confiant:this._confiant,confiantReportThisAdEnabled:this._confiantReportThisAdEnabled,win:this._win,idealAdStackManager:this._idealAdStackManager}}};T.class(Id,{token:l.REPORT_AD,dependencies:[l.DISPENSARY_DATA,l.IDEAL_AD_STACK_MANAGER,{token:l.WINDOW,alias:"win"},l.AD_QUALITY_MANAGER]});var Kn=class extends bt{constructor(e=window){super(),this._win=e}getElement(){return F({classList:["fs-branding-spacer"]},this._win.document)}},Sd=class{constructor(e=[]){this._element=null,this._components=e}getElement(){return this._element}hide(){this._element&&(this._element.style.visibility="hidden")}show(){this._element&&(this._element.style.visibility="visible")}destroy(){var e;this._components.forEach(t=>t.destroy()),(e=this._element)==null||e.remove(),this._element=null,this._components=[]}},Ad=class extends Sd{constructor(e=[],t=window){super(e);let i=this._components.flatMap(s=>s!=null&&s.enabled?s:[]);!i.length||i.every(s=>s instanceof Kn)||(this._element=F({classList:["__fs-ancillary"],style:{visibility:"hidden"},children:i.map(s=>s.getElement())},t.document))}},yd=class{constructor({freestar:e,gamManager:t,branding:i,reportAd:s,win:n}){this._freestar=e,this._gamManager=t,this._branding=i,this._reportAd=s,this._win=n,this._items=new Map,this._handleSlotEvents()}_handleSlotEvents(){this._gamManager.instance.pubads().addEventListener(mt,e=>{let t=e.slot.getSlotElementId(),i=this._win.document.getElementById(t),s=i==null?void 0:i.querySelector(`#${CSS.escape(t)} > div[id*="google_ads_iframe_"]`);this.create({id:t,placement:Z({name:ie({slotId:t})}),container:s})}),this._gamManager.instance.pubads().addEventListener(si,e=>{let t=e.slot.getSlotElementId();this.hide(t)})}create({id:e,placement:t,container:i}){var u,f;if([e,t,i,this.isEnabled({id:e,placement:t})].some(p=>!p))return;let s=this._items.get(e),n=i.querySelector("__fs-ancillary");if(s&&n){s.show();return}s==null||s.hide(),s==null||s.destroy(),n==null||n.remove();let o=(u=this._branding)==null?void 0:u.createIcon(t),a=(f=this._reportAd)==null?void 0:f.createTextButton(e,t),d=new Ad([o,new Kn(this._win),a],this._win);if(n=d.getElement(),!n)return;this._items.set(e,d),i.appendChild(n);let[c]=i.getElementsByTagName("iframe")||[];c&&Kf(c).then(()=>{d.show()}).catch(()=>{freestar.log(20,"Not applying ancillary, target Iframe is too small",c)})}get(e){return this._items.get(e)||null}show(e){let t=this._items.get(e);t&&t.show()}hide(e){let t=this._items.get(e);t&&t.hide()}isEnabled({id:e,placement:t}){if(t&&(gs(t)||of(t.sizes||[])))return!1;if(e){let i=this._win.document.getElementById(e);return(i==null?void 0:i.getAttribute(Bd))!=="false"}return!0}};T.class(yd,{token:l.ANCILLARY,dependencies:[l.GAM_MANAGER,l.BRANDING,l.REPORT_AD,{token:l.WINDOW,alias:"win"}]});function Iu(r={},e={}){return!!(r.isCoppaInventory||e.isCOPPA)}var Wn="amazon",Tt="apstag",Su="//c.amazon-adsystem.com/aax2/apstag.js",Au="0ab198dd-b265-462a-ae36-74e163ad6159";var bd=class{constructor({freestar:e,dispensaryData:t,win:i=window,idealAdStackManager:s,analytics:n,logger:o}){this._freestar=e,this._dispensaryData=t,this._idealAdStackManager=s(),this._window=i,this._instance=null,this.isEnabled=!1,this._analytics=n,this._bids={},this._seen=new Set,this._logger=o}get instance(){if(!this._instance)throw new Error("Amazon is disabled or haven't been initiated.");return this._instance}init(){return y(this,null,function*(){return new Promise(e=>{var t;if(this._idealAdStackManager.getBypassFirstAuction())e(this);else{let i=this._dispensaryData.fsdata.networks.find(({slug:s})=>s===Wn);if(i&&!Iu(this._freestar.coppa,this._freestar.config)){let{clientServer:s}=this._idealAdStackManager.getConfig();if(s[Wn]!=="off"){let n=i.sizes.find(o=>o.params.publisherId);this._freestar.amazonPublisherId=Mr((t=n==null?void 0:n.params)==null?void 0:t.publisherId)?n.params.publisherId:Au,this._loadAmazonBidder(e)}else e(this)}else e(this)}})})}track(e){return y(this,null,function*(){let t=Date.now();for(let i of e){if(i.amznbid==="1"||i.amznbid==="2")continue;let s=te.getAdUnitBySlotElementId(i.slotID);if(!s)continue;let{placement:n,slot:o}=s;if(n.dfpId.includes(_t)&&!this._bids[i.amzniid]){let a=o.getTargeting("fs-auuid");if(!Array.isArray(a)||a.length===0||!a[0])continue;let d=a[0],u=(yield z.instance.resolve(l.AUCTION_MANAGER)).getAuctionByFsAuctionId(d);this._bids[i.amzniid]=A({responseTimestamp:t,requestTimestamp:u.timestamp||null,fsAuctionId:d},i)}}for(let[i,s]of Object.entries(this._bids))s!=null&&s.responseTimestamp&&t-s.responseTimestamp>=30*1e3&&delete this._bids[i]})}_handleBidWonEvent(e){let{amzniid:t}=e||{};if(!t)return;let i=this._bids[t];if(!i)return;let s=te.getAdUnitBySlotElementId(i.slotID);if(!s)return;let{placement:n,slot:o}=s;if(!n||!o)return;let{name:a}=n;if(!this._dispensaryData.locData)return;let{iso:d}=this._dispensaryData.locData,{fsAuctionId:c,amznp:u,amznbid:f,slotID:p,requestTimestamp:h,responseTimestamp:m}=i,S=o.getTargeting("floors_id"),b=Array.isArray(S)&&S.length>0?S[0]:null,g=new Xs({bidder:u,adUnitCode:a,isRefresh:this._freestar.refreshLibrary&&this._freestar.refreshLibrary[a]?this._freestar.refreshLibrary[a].timesRefreshed>0:!1,countryCode:d,auctionId:c,fsuuid:It({slotId:p,slot:s.slot,googletag:this._window.googletag}),bidFloor:b,hashedCpm:f,requestTimestamp:h,responseTimestamp:m},fe.IMMEDIATE);this._analytics.track(g)}_getRenderImp(){return new Proxy(this._window[Tt].renderImp,{apply:(t,i,s)=>{try{let n=null;if(s[1]?n=s[1]:s[0]&&typeof s[0]=="object"&&"amzniid"in s[0]&&(n=s[0].amzniid),n){if(this._seen.has(n)||this._handleBidWonEvent({amzniid:n}),this._seen.size>=1e3){let o=this._seen.values().next().value;this._seen.delete(o)}this._seen.add(n)}return t.apply(i,s)}catch(n){let o=new $({eventType:"amazonRenderImpError",eventName:"amazon_render_imp_error",data:{message:n.message,stack:n.stack}},fe.IMMEDIATE);this._analytics.track(o),this._freestar.log(1,`Amazon renderImp error: ${n.message}`)}}})}_loadAmazonBidder(e){var t,i,s,n,o;if(!this._window[Tt]){let a=(d,c)=>{this._window[Tt]._Q.push([d,c])};this._window[Tt]={init:function(){a("i",arguments)},fetchBids:function(){a("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]}}(o=this._window[Tt])==null||o.init({pubID:this._freestar.amazonPublisherId,adServer:"googletag",schain:this._generateAmazonSchain(this._dispensaryData.fsdata.companyId,(i=(t=this._dispensaryData.fsdata.schain)==null?void 0:t.type)!=null?i:Me,(n=(s=this._dispensaryData.fsdata.schain)==null?void 0:s.bidderOverrides)!=null?n:[])},()=>{this.isEnabled=!0,this._window[Tt].renderImp=this._getRenderImp(),this._instance=this._window[Tt],e(this)}),ge(Su,null,null,null,!0,void 0,!1,a=>{var d;(d=this._logger)==null||d.log(["Amazon script loading failed with error:",a]),e(this)})}_generateAmazonSchain(e,t,i){let s=i&&i.length&&i.includes(nl);if(!(t===Me&&!s)&&!(t===vt&&s))return an(e,t,i)}_isAmazonAd(e){var t;return(t=e.bidders)==null?void 0:t.some(({bidder:i})=>i===Wn)}_formatAps(e){var d;let{name:t,dfpId:i,sizeMappings:s,selectedSize:n}=e,o=n!=null?n:s.find(c=>Xe()>=c.viewport.size[0]),a=(d=o==null?void 0:o.size)!=null?d:[];return a=a.filter(c=>c[0]!==35843),Qe({slotID:t,slotName:i,sizes:a})}_getPlacementByDfpId(e){return this._dispensaryData.fsdata.placements.find(({dfpId:t})=>t===e)}_getAllAmazonSlots(){return this._dispensaryData.fsdata.placements.filter(e=>this._isAmazonAd(e)&&Qc(e)).map(e=>this._formatAps(e))}setupAmazonSlots(e){let t=[];return e&&!Array.isArray(e)&&(e=[e]),e?e.forEach(i=>{let s=null;try{s=this._freestar.dynamicSlotLibrary[i.getSlotElementId()],s&&(s=Z({name:s})),s||(s=this._dispensaryData.fsdata.placements.find(({slotId:n})=>i.getSlotElementId()===n)),s||(s=this._getPlacementByDfpId(i.getAdUnitPath()))}catch(n){freestar.log(1,`Error: ${n}`)}if(s&&this._isAmazonAd(s)){let n=i.getSizes().filter(o=>typeof o!="string").map(({width:o,height:a})=>[o,a]);if(n.length){let o={slotID:i.getSlotElementId(),slotName:i.getAdUnitPath(),sizes:n};t.push(Qe(o))}}}):t=this._getAllAmazonSlots(),t}};T.object({token:l.AMAZON_MANAGER,dependencies:[{token:l.WINDOW,alias:"win"},l.FREESTAR,l.DISPENSARY_DATA,l.ANALYTICS,l.LOGGER],factory:({dependencies:r})=>new bd(L(A({},r),{idealAdStackManager:j})).init()});var Qn=class{constructor({logger:e,win:t=window}){E(this,"adBlockerDetected",!1);E(this,"_imageCheck",(...t)=>y(this,[...t],function*(e=atob("aHR0cHM6Ly9hLnB1Yi5uZXR3b3JrL2NvcmUvaW1ncy8xLnBuZw")){return new Promise(i=>{let s=encodeURIComponent(new Date().toISOString().split("Z")[0]),n=this._document.createElement("img");n.src=`${e}?x=${s}`,n.onload=()=>y(this,null,function*(){yield this._redirectCheck(e),n.remove(),i()}),n.onerror=()=>{this.adBlockerDetected=!0,this._logger.log("AdBlock detected: image load error"),n.remove(),i()},this._document.body.appendChild(n)})}));e.setContext(l.AD_BLOCK),this._logger=e,this._document=t.document,this._window=t}init(){return y(this,null,function*(){try{yield Promise.all([this._hiddenElementCheck(),this._imageCheck(),this._makeTestRequest()])}catch(e){this._logger.log("AdBlock initialization error:",e)}return this})}_makeTestRequest(e=atob("aHR0cHM6Ly93d3cuZ29vZ2xldGFnc2VydmljZXMuY29tL3RhZy9qcy9ncHQuanM=")){return fetch(e,{method:"HEAD",mode:"no-cors",cache:"no-store"}).then(()=>{}).catch(()=>{this._logger.log("AdBlock detected: test request failed"),this.adBlockerDetected=!0})}_hiddenElementCheck(){return y(this,null,function*(){this._document.body||(yield new Promise(n=>this._document.addEventListener("DOMContentLoaded",n)));let e=["YWQ=","YmFubmVyLWFk","YmFubmVyX2Fk","YmFubmVyLWFkLWNvbnRhaW5lcg==","YWQtc2lkZXJhaWw=","c3RpY2t5YWRz","aW1wcnRudC1jbnQ="],t=this._document.createElement("div");t.textContent=Math.random().toString(),t.setAttribute(atob("ZGF0YS1mcmVlc3Rhci1hZA=="),Math.random().toString());for(let n=0;n<e.length;n++)t.classList.add(atob(e[n]));t.style.display="block",this._document.body.appendChild(t);let i=this._window.getComputedStyle(t),s=i==null?void 0:i.display;t.remove(),s==="none"&&(this._logger.log("AdBlock detected: hidden element"),this.adBlockerDetected=!0)})}_redirectCheck(e){return y(this,null,function*(){try{let t=yield fetch(e),i=t==null?void 0:t.redirected,s=t==null?void 0:t.url;(i||(s?s!==e:!1))&&(this._logger.log("AdBlock detected: redirect check"),this.adBlockerDetected=!0)}catch(t){this._logger.log("AdBlock detected: redirect check error",t),this.adBlockerDetected=!0}})}};T.class(Qn,{token:l.AD_BLOCK,dependencies:[l.LOGGER,{token:l.WINDOW,alias:"win"}],factory:({dependencies:r})=>new Qn(r).init()});var gi=class gi{constructor({logger:e,freestar:t,gamManager:i}){this._freestar=t,this._logger=e,this._gamManager=i,this._logger.setContext(l.AD_SLOTS_MANAGER),this._logger.setLevel(Q.CORE)}createAdSlot(a){return y(this,arguments,function*({placement:e,slotId:t,targeting:i={},placementName:s=null,newElement:n={},element:o=null}){let d=e.dfpId;if(s=s!=null&&s.length?s:e.name,o){this._processElement({el:o,slotId:t,placementName:s,placement:e,targeting:i,newElement:n,originalPlacementDfpId:d});return}try{let{isFound:c,element:u}=yield ds({id:t});if(!c){this._logger.log(`[createAdSlot] Element not found for slotId: ${t}`,{level:Q.CORE});return}this._processElement({el:u,slotId:t,placementName:s,placement:e,targeting:i,newElement:n,originalPlacementDfpId:d})}catch(c){this._logger.log(`[createAdSlot] Error getting element for slotId: ${t}, error: ${c}`,{level:Q.CORE})}})}_processElement({el:e,slotId:t,placementName:i,placement:s,targeting:n,newElement:o,originalPlacementDfpId:a}){if(!e){this._logger.log(`[_processElement] Element not found for slotId: ${t}`,{level:Q.CORE});return}if(!i){this._logger.log(`[_processElement] PlacementName is empty for slotId: ${t}`,{level:Q.CORE});return}if(this._configureElement(e,t,i),s=Z({name:i}),!s){this._logger.log(`[_processElement] Placement not found for placementName: ${i}, slotId: ${t}`,{level:Q.CORE});return}this._freestar.dynamicSlots.push(t),this._setVideoPlayerSize(e,s),s.sizes&&s.sizes.length||s.fluidAd?this._createGamSlot({slotId:t,placement:s,targeting:n,newElement:o,originalPlacementDfpId:a,placementName:i,el:e}):this._logger.log(`[_processElement] No valid sizes or fluidAd for placement: ${i}, slotId: ${t}`,{})}_configureElement(e,t,i){e.setAttribute("name",i),this._freestar.newAdSlotIds.push(t)}_setVideoPlayerSize(e,t){let i=this._getLargestVideoSize(t);if(i.length===0)return;let s=i[0],o=this._getPlayerSizesForWidth(s)[0];this._appendVideoAttributeToElement(e,o)}_getPlayerSizesForWidth(e){return e>=gi.AD_SIZE_WIDTH_THRESHOLD?Rr:vr}_appendVideoAttributeToElement(e,[t,i]){let s=e.getAttribute("data-freestar-ad")||"";e.setAttribute("data-freestar-ad",`${s} __${t}x${i}`)}_getLargestVideoSize(e){var i,s;if((i=e.selectedSize)!=null&&i.mediaTypes.includes("video"))return this._getFilteredAndSortedSizes(e.selectedSize.size)[0]||[];let t=(s=e.sizeMappings)==null?void 0:s.find(n=>n.mediaTypes.includes("video")&&Xe()>=n.viewport.size[0]);return t?this._getFilteredAndSortedSizes(t.size):[]}_getFilteredAndSortedSizes(e){return e.sort(Yt).filter(t=>!gi.INVALID_SIZE_IDS.includes(t[0]))}_createGamSlot({slotId:e,placement:t,targeting:i,newElement:s,originalPlacementDfpId:n,el:o}){let a=this._gamManager.getSlot({elementId:e}),d=this._resolveChannelAndDfpId(t,s,n);if(d!==t.dfpId&&(this._logger.log(`[_createGamSlot] DfpId changed from ${t.dfpId} to ${d} for slotId: ${e}`,{level:this._logger.constructor.VERBOSE}),a&&window.googletag.destroySlots&&(this._logger.log(`[_createGamSlot] Destroying existing slot due to dfpId change for slotId: ${e}`,{level:this._logger.constructor.VERBOSE}),a=void 0)),!a)if(a=this._gamManager.createSlot({placement:t,slotConfig:{targeting:i},sizes:t.sizes,id:o.id,specialDfpId:d}),a)this._logger.log(`[_createGamSlot] Created new GAM slot for slotId: ${e}, dfpId: ${d}`,{level:this._logger.constructor.VERBOSE});else{this._logger.log(`[_createGamSlot] Failed to create GAM slot for slotId: ${e}, dfpId: ${d}`,{level:Q.CORE});return}a&&this._applySlotTargeting(a,e,t,i)}_resolveChannelAndDfpId(e,t,i){let s=this._freestar.config.channel,n=this._freestar.config.channel,o=i||e.dfpId;return e.dfpId.indexOf("{{channel}}")>-1?s="{{channel}}":e.dfpId.indexOf(this._freestar.config.channel)>-1?s=this._freestar.config.channel:e.dfpId.indexOf(this._freestar.config.orignalChannel)>-1&&(s=this._freestar.config.orignalChannel),n&&(t.path||s)&&(o=e.dfpId.replace(n,t.path||s)),o}_applySlotTargeting(e,t,i,s){var o,a;s=L(A({},s),{fs_ad_product:he(i),fs_ad_optimization:Je(i),fsrefresh:(o=s==null?void 0:s.fsrefresh)!=null?o:"0",fsrebid:(a=s==null?void 0:s.fsrebid)!=null?a:"0"}),$i(e,t,typeof s!="undefined"&&Object.keys(s).length?s:void 0)}};E(gi,"AD_SIZE_WIDTH_THRESHOLD",500),E(gi,"INVALID_SIZE_IDS",[35843]);var Td=gi;T.class(Td,{token:l.AD_SLOT_SERVICE,defaultAlias:"adSlotService",dependencies:[l.FREESTAR,l.GAM_MANAGER,l.LOGGER]});var Jp={},yu=({element:r,placement:e})=>{Yi({placementName:e.name,slotId:r.id});let{lazyLoadViewportHeight:t}=e.selectedSize,i=Jp[t];i||(i=new IntersectionObserver((s,n)=>{s.forEach(o=>{if(lf(o)){let a=ie({slotId:o.target.id});a&&(freestar.newAdSlots([{placementName:a,slotId:o.target.id,source:"lazyAd"}]),z.instance.resolve(l.EVENT_BUS).then(d=>{d.emit(xs,{elementId:o.target.id})}),n.unobserve(o.target))}})},{root:null,rootMargin:`${t}% 0px ${t}% 0px`})),i.observe(r)};function bu(r,e){var s;if(!((s=r==null?void 0:r.sizes)!=null&&s.length))return null;let t=e.getSlot({elementId:r.code});if(!t)return null;let i=!fsprebid.adUnits.find(n=>n.code===r.code);return i&&On({adUnits:[r]}),{elementId:r.code,slot:t,needsAdUnit:i}}var wd=class{constructor({logger:e,freestar:t,bidsManager:i,eventBus:s,gamManager:n,adSlotService:o,win:a=window,stickyAd:d,fsdata:c,config:u,nativeRenderManager:f}){this._freestar=t,this._adSlotService=o,this._eventBus=s,this._logger=e,this._bidsManager=i,this._gamManager=n,this._win=a,this._fsdata=c,this._config=u,this._stickyAdManager=d,this._nativeRenderManager=f,this._logger.setContext(l.AD_SLOTS_MANAGER),this._logger.setLevel(Q.CORE)}newAdSlots(e,t=null,i){let s="newAdSlots";this._logger.log([`${s} invoked`,...arguments],{level:this._logger.constructor.CORE,context:s}),Yc(this._freestar);let n=jc(e,s,this._logger);if(n.length===0)return;let{placements:o}=$c({channel:t,logTitle:s,config:this._config,placements:this._fsdata.placements,logger:this._logger});return this._fsdata.placements=o,this._notifySlotCreation(n),this._processNewElements(n,i)}_notifySlotCreation(e){if(!Array.isArray(e)){this._logger.error("_notifySlotCreation called with invalid elements",e);return}this._eventBus.emit(ni,{elementIds:e.map(({slotId:t})=>t)})}_processNewElements(e,t){return y(this,null,function*(){let i=e.filter(s=>!this._freestar.enabledSlotsCalled.includes(s.slotId)).map(s=>this._createSingleSlot(s,t));yield Promise.all(i)})}_createSingleSlot(e,t){return y(this,null,function*(){let{placementName:i,slotId:s,targeting:n}=e,o=this._win.document.getElementById(s),a=Z({name:i});a&&(yield this._adSlotService.createAdSlot({placement:a,slotId:s,targeting:n,newElement:e,element:o}),this._handleSlotCreated(o,s,a,e,t))})}_handleSlotCreated(e,t,i,s,n){let o=this._gamManager.getSlot({elementId:t});e&&o&&(this._requestBids({placement:i,element:e,newElement:s,sendAdserverSignal:n}),this._freestar.newAdSlotsCalled.push(e.id),this._handleStickyAds(s,i,t))}_handleStickyAds(e,t,i){var s,n;typeof e.skipSAU=="undefined"&&(s=this._stickyAdManager)!=null&&s.isSlidingUnit({placement:t})&&((n=this._stickyAdManager)==null||n.attachSlidingUnit({adUnit:t,slotId:i}))}_requestBids({placement:e,element:t,newElement:i,sendAdserverSignal:s}){var o;let n=Ta(e);n&&(n.code=t.id,s?this._handleDirectBidding(n,s):i.source==="lazyAd"?this._enqueueBid(n):((o=e.selectedSize)==null?void 0:o.lazyLoadViewportHeight)>0?yu({element:t,placement:e}):this._enqueueBid(n))}_enqueueBid(e){this._bidsManager.enqueueBids({bidObjects:[e]})}_handleDirectBidding(e,t){let i=bu(e,this._gamManager);i&&this._bidsManager.requestBids({elementIds:[i.elementId],slots:[i.slot],sendAdserverSignal:t})}deleteAdSlots(e){if(e===void 0){this._logger.log("deleteAdSlots invoked and all slots will be destroyed"),this._gamManager.instance.pubads().getSlots().map(i=>i.getSlotElementId()).forEach(i=>this._nativeRenderManager.clearExistingAd(i)),this._gamManager.instance.destroySlots(),this._eventBus.emit(Ms);return}Array.isArray(e)||(e=[e]),this._logger.log(`deleteAdSlots invoked and the following ID(s) will be destroyed: ${e}`),this._removeAdUnits({list:e})}_removeAdUnits({list:e}){let t=e.map(s=>te.getAdUnitBySlotElementId(s)),i=[];t.forEach(s=>{var o;let{placement:n}=s;if((o=n==null?void 0:n.sizeMappings)!=null&&o.some(a=>a.superflex)){let a=[...this._win.document.querySelectorAll(`[name="${n.name}"]`)];i=i.concat(a.flatMap(d=>d.id.includes("fs-sf")?te.getAdUnitBySlotElementId(d.id)||[]:[]))}}),e.forEach(s=>{this._gamManager.destroySlot({elementId:s}),this._nativeRenderManager.clearExistingAd(s)}),i.forEach(s=>{this._gamManager.destroySlot({elementId:s.slot.getSlotElementId()})})}};T.class(wd,{token:l.AD_SLOTS_MANAGER,defaultAlias:"adSlotsManager",dependencies:[l.AD_QUALITY_MANAGER,l.WINDOW,l.FREESTAR,l.BIDS_MANAGER,l.AD_SLOT_SERVICE,l.EVENT_BUS,l.GAM_MANAGER,l.LOGGER,l.FS_DATA,l.CONFIG_MANAGER,l.PREBID_MANAGER,l.NATIVE_RENDER_MANAGER,{token:l.STICKY_AD,optional:!0}]});var Tu=Rt(br());var mi=class{constructor({dispensaryData:e,window:t,freestar:i,logger:s,analytics:n,prebidManager:o,rebidManager:a}){this._dispensaryData=e,this._win=t,this._freestar=i,this._logger=s,this._analytics=n,this._prebidManager=o,this._rebidManager=a}init(){return y(this,null,function*(){var e;yield this._loadScript(),(e=this._logger)==null||e.log("module initialized")})}get adQualityConfig(){let{adQualityOptions:e}=this._dispensaryData.fsdata||{};return e}get url(){throw new Error("buildUrl method must be implemented by subclass")}_loadScript(e,t){return y(this,null,function*(){var i,s;if(this.adQualityConfig&&this.adQualityConfig.vendor===e&&(this.adQualityConfig.desktopEnabled||this.adQualityConfig.mobileEnabled)){try{yield pr(this.url)}catch(n){(i=this._logger)==null||i.log(["Script loading failed with error:",n]);return}(s=this._logger)==null||s.log(`Inserted ${e} script`),t&&t()}})}_sendMessage({args:e}){this._analytics&&Ki&&this._analytics.track(new Ki(e))}_rebidBlockedAd({elementId:e}){this._rebidManager.handleAdBlocked({elementId:e})}_dfpBlockProcess({elementId:e,blockingVendor:t}){let i={blockingType:"dfp",isBlocked:!0,adUnitCode:e,blockingVendor:t};this._sendMessage({args:i})}_prebidSentAnalytics(e){let t=Object.keys(e).reduce((s,n)=>(n!=="adserverTargeting"&&n!=="ad"&&(s[n]=e[n]),s),{}),i=(0,Tu.default)({blockingType:"prebid",isBlocked:!0,bidCpm:t.cpm},t);this._sendMessage({args:i})}_handleEvent(){throw new Error("_handleEvent method must be implemented by subclass")}};var _i=class r extends mi{constructor(t){super(t);E(this,"prebidNameSpace","fsprebid");E(this,"_handleEvent",t=>{var s,n;let{data:i}=t;if(i.message==="CONFIANT_CALLBACK"&&i.isBlocked===1){let o=i.impressionData||{},a=((s=o.prebid)==null?void 0:s.s)||((n=o.dfp)==null?void 0:n.s);if(!a){this._logger.log("domId not found in impressionData");return}o.prebid?this._prebidBlockProcess(o):this._dfpBlockProcess({elementId:a,blockingVendor:Jn}),this._rebidBlockedAd({elementId:a})}});this._logger.setContext("Confiant"),this._logger.setLevel(50)}init(){return y(this,null,function*(){this._shouldInitialize()&&this._buildBasicConfiantObject(),yield Ii(r.prototype,this,"init").call(this)})}_shouldInitialize(){return this.adQualityConfig&&this.adQualityConfig.vendor==="CONFIANT"&&(this.adQualityConfig.desktopEnabled||this.adQualityConfig.mobileEnabled)}get url(){return`https://cdn.confiant-integrations.net/${this.adQualityConfig.vendorId}/gpt_and_prebid/config.js`}_loadScript(){return y(this,null,function*(){yield Ii(r.prototype,this,"_loadScript").call(this,"CONFIANT",()=>{this._subscribe()})})}_buildBasicConfiantObject(){this._win.confiant=this._win.confiant||{},this._win.confiant.prebidNameSpace=this.prebidNameSpace,this._win.confiant.callback=(t,i,s,n,o,a)=>{this._win.postMessage({message:"CONFIANT_CALLBACK",isBlocked:s,impressionData:a})}}_prebidBlockProcess(t){let{adId:i}=t.prebid,s=this._win.fsprebid.getAllWinningBids().find(n=>n.adId===i);s&&(this._prebidSentAnalytics(L(A({},s),{blockingVendor:Jn})),this._prebidBlockExcludeBidderSet({bidResponse:s}))}_prebidBlockExcludeBidderSet({bidResponse:t}){let i=G(ws);i.includes(t.bidder)||i.push(t.bidder),ee({key:Wo,value:i,type:k.array}),this._removeBidder(t)}_removeBidder({bidder:t}){this._prebidManager.instance.adUnits.forEach(i=>{i.bids=i.bids.filter(s=>X(s.bidder)!==X(t))})}_subscribe(){this._win&&this._handleEvent&&this._win.addEventListener("message",this._handleEvent.bind(this))}reportSingleAd(t){try{this._win.confiant.services().reportSingleAd(t)}catch(i){alert("Unable to report the ad: "+i.toString())}}};var wu="com.mediatrust.mediafilter";var Ei=class r extends mi{constructor(e){super(e),this._logger.setContext("TheMediaTrust"),this._setMediafilterConfiguration()}get url(){return`https://scripts.mf.webcontentassessor.com/scripts/${this.adQualityConfig.vendorId}`}_loadScript(){return y(this,null,function*(){yield Ii(r.prototype,this,"_loadScript").call(this,"THE_MEDIA_TRUST",this._subscribe.bind(this))})}_setMediafilterConfiguration(e={eventMessages:!0,eventLevels:[3]}){this._win.mediafilterConfiguration={setup:e}}_handleEvent(e){var t,i;if(this._isAdvertisementBlocked(e)){let s=(i=(t=e.detail.dataset.eventInstance.adObject)==null?void 0:t.getSlotElementId)==null?void 0:i.call(t),n=this._extractAdId(e);this._isNativeRenderBlock(e)?s=this._handleNativeRenderBlock(e,s):this._isPrebidThroughGoogleAdBlock(n)?this._handlePrebidThroughGoogleAdBlock(n):this._handleGoogleAdRenderBlock(s),this._rebidBlockedAd({elementId:s})}}_isAdvertisementBlocked(e){return e.detail.message==="Advertisement Blocked"}_extractAdId(e){let t=e.detail.dataset.eventInstance.securityViolationHTML.match(/ucTagData\.adId\s*=\s*["']([^"']+)["'];/);return t?t[1]:null}_isNativeRenderBlock(e){return e.detail.dataset.eventInstance.adObject.adType==="prebid"}_isPrebidThroughGoogleAdBlock(e){return!!e}_handleNativeRenderBlock(e,t){let i=e.detail.dataset.eventInstance.windowInstance.adId,s=this._prebidBlockProcess(i);return this._shouldUseAdUnitCode(t)&&(t=s.adUnitCode),t}_shouldUseAdUnitCode(e){return!e}_handlePrebidThroughGoogleAdBlock(e){this._prebidBlockProcess(e)}_handleGoogleAdRenderBlock(e){this._dfpBlockProcess({domId:e,blockingVendor:Zn})}_prebidBlockProcess(e){let t=Object.values(fsprebid.getBidResponses()).flatMap(i=>i.bids||[]).find(i=>i.adId===e);return this._prebidSentAnalytics(L(A({},t),{blockingVendor:Zn})),t}_subscribe(){this._win.addEventListener(wu,this._handleEvent.bind(this))}};var Jn="CONFIANT",Zn="THE_MEDIA_TRUST",Ru={[Jn]:{factory:_i},[Zn]:{factory:Ei}};var dr=class{constructor(e){this._win=e.window,this._freestar=e.freestar,this._dispensaryData=e.dispensaryData,this._logger=e.logger,this._logger.setContext("AdQualityManager"),this._logger.setLevel(50),this._analytics=e.analytics,this._prebidManager=e.prebidManager,this._rebidManager=e.rebidManager,this._isInitialized=!1}init(){return y(this,null,function*(){if(!j().allowConfiant()){this._logger.log("AdQualityManager: Confiant not allowed by IdealAdStack settings");return}if(this._isInitialized){this._logger.log("AdQualityManager already initialized");return}let e=this._getAdQualityConfig();if(!e){this._logger.log("No ad quality configuration found, skipping initialization");return}if(!e.vendor){this._logger.log("Ad quality vendor not specified in configuration");return}try{yield this._initializeProvider(e),this._isInitialized=!0,this._logger.log("AdQualityManager initialized successfully")}catch(t){this._logger.log("Failed to initialize AdQualityManager:",t)}})}_initializeProvider(e){return y(this,null,function*(){let t=Ru[e.vendor];if(!(t!=null&&t.factory)){this._logger.log(`Unsupported ad quality vendor: ${e.vendor}`);return}let i={window:this._win,freestar:this._freestar,dispensaryData:this._dispensaryData,logger:this._logger,analytics:this._analytics,prebidManager:this._prebidManager,rebidManager:this._rebidManager},s=new t.factory(i);yield s.init(),this.provider=s})}_getAdQualityConfig(){var e;return((e=this._dispensaryData.fsdata)==null?void 0:e.adQualityOptions)||null}};T.class(dr,{token:l.AD_QUALITY_MANAGER,defaultAlias:"adQualityManager",dependencies:[l.WINDOW,l.FREESTAR,l.DISPENSARY_DATA,l.LOGGER,l.ANALYTICS,l.PREBID_MANAGER,l.REBID_MANAGER],factory:e=>y(void 0,[e],function*({dependencies:r}){yield r.prebidManager.ready;let t=new dr(A({},r));return yield t.init(),t})});var Rd=class{constructor({dispensaryData:e,win:t=window}){this._dispensaryData=e,this._window=t}validate(){let{onlyAllowedDomains:e,allowedDomains:t,urlBlocklist:i}=this._dispensaryData.fsdata;if(e&&(t!=null&&t.length)&&!this._isDomainAllowed)throw new Error("The current domain is not in the allowed domains list, exiting...");if(i!=null&&i.length&&!this._isUrlAllowed)throw new Error("The current URL is in the blocked url list, exiting...")}get _isDomainAllowed(){return this._dispensaryData.fsdata.allowedDomains.some(e=>(e.indexOf("*.")===0&&(e=e.slice(2)),this._window.top.location.host.indexOf(e)!==-1))}get _isUrlAllowed(){let e=/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+$/,t=f=>{try{return new URL(f),!0}catch(p){return!1}},i=f=>{let p=f.split("/");return e.test(p[0])},{href:s,pathname:n,host:o,search:a}=this._window.top.location,d=(f,p)=>f.includes("/*")?s.includes(f.replace("/*","")):p,c=f=>f.split("/")[0].includes("*"),u=f=>f[f.length-1]==="/"?f.substring(0,f.length-1):f;return!this._dispensaryData.fsdata.urlBlocklist.find(f=>{if(t(f))return d(f,u(s)===u(f));if(i(f))return d(f,u(o+n+a)===u(f));if(c(f)){let p=f.split("/"),h=p[0],m=p.slice(1).join("/"),S=m.length>0,b=o.includes(h.replace("*",""));if(!b)return!1;if(!S)return b;let g=u(o+n+a),_=u(m);return _.includes("/*")?s.includes(_.replace("/*","")):g.includes(_)}else return n.includes(f)})}};T.class(Rd,{token:l.URL_VALIDATOR,dependencies:[l.DISPENSARY_DATA,{token:l.WINDOW,alias:"win"}]});T.object({token:l.CONFIG_MANAGER,dependencies:[l.FREESTAR],defaultAlias:"config",factory:({dependencies:r})=>{var t,i,s;let e=(i=(t=r.freestar)==null?void 0:t.configManager)!=null?i:{};return(s=r.freestar)==null||delete s.configManager,e}});T.object({token:l.DISPENSARY_DATA,defaultAlias:"dispensaryData",dependencies:[l.FREESTAR],factory:({dependencies:r})=>{let{freestar:e}=r,t=e.dispensaryData||{};return delete e.dispensaryData,t}});(function(){return y(this,null,function*(){var i,s,n,o;if(Il(),Al(),freestar.modulesLoaded.pubfig)return;freestar.modulesLoaded.pubfig=!0;let e=new Gr({freestar:window.freestar});freestar.performanceLogger=e,e.logMark({markerName:be.pubfigLoaded,isFreestarDataCollectorInitialized:!1});let t=new Kr({freestar:window.freestar,window});t.initManager(),freestar.userInfoManager=t;try{He().checkForAlternativeInstances({isTest:!1,onAlternativeInstanceFound:()=>{e.resetPerformanceLogger(),freestar.fsdata=null,freestar.modulesLoaded.pubfig=!1}}),e.logMark({markerName:be.pubfigInitRequestStart,isFreestarDataCollectorInitialized:!1});let{element:a}=yield ds({elementSelector:`script[src*="${kr}"]`,doc:window.document,frequency:10});freestar.sitePath==="freestar-com"&&(freestar.sitePath=Ur(a));let d=new Xr({freestar});yield d.load(),freestar.dispensaryData=d,freestar.cdep=d.cdep,freestar.fsdata=(i=d.fsdata)!=null?i:{},freestar.msg.fpc=(s=d.fpc)!=null?s:"",freestar.locData=(n=d.locData)!=null?n:{},freestar.networkMap=(o=d.networkMap)!=null?o:{},new Tn().checkForBot(),freestar.scriptsManager=new es({win:window,scripts:[new os,new as,new ns({dispensaryData:d}),new ts,new is,new ss]})}catch(a){return console.warn(`Warning: ${a.message}`),a}yl(),freestar.scriptsManager.loadScripts({id:["gam"]}),e.logMark({markerName:be.pubfigInitRequestEnd,compareTo:[be.pubfigInitRequestStart]}),Sl()})})();})();
